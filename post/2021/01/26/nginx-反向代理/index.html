<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx 反向代理 | 除非世界颠倒</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/Welcome/img/logo.svg">
    <meta name="description" content="螃蟹不能剥我的壳，笔记本不可能在写我，我不可能落在枫叶上雪花上，而你不可能想我 ...">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/Welcome/assets/css/0.styles.dc2e030a.css" as="style"><link rel="preload" href="/Welcome/assets/js/app.516fe79a.js" as="script"><link rel="preload" href="/Welcome/assets/js/8.d7055a2e.js" as="script"><link rel="preload" href="/Welcome/assets/js/1.ed48a7ee.js" as="script"><link rel="preload" href="/Welcome/assets/js/2.9a3f7cc9.js" as="script"><link rel="preload" href="/Welcome/assets/js/76.3613c476.js" as="script"><link rel="prefetch" href="/Welcome/assets/js/10.4c48ef06.js"><link rel="prefetch" href="/Welcome/assets/js/11.b879bea0.js"><link rel="prefetch" href="/Welcome/assets/js/12.fb12f646.js"><link rel="prefetch" href="/Welcome/assets/js/13.cbffec13.js"><link rel="prefetch" href="/Welcome/assets/js/14.b6f5f3af.js"><link rel="prefetch" href="/Welcome/assets/js/15.a2131606.js"><link rel="prefetch" href="/Welcome/assets/js/16.7c225af7.js"><link rel="prefetch" href="/Welcome/assets/js/17.40d10b01.js"><link rel="prefetch" href="/Welcome/assets/js/18.82c76934.js"><link rel="prefetch" href="/Welcome/assets/js/19.e7b2182d.js"><link rel="prefetch" href="/Welcome/assets/js/20.c46f9d92.js"><link rel="prefetch" href="/Welcome/assets/js/21.ea337a55.js"><link rel="prefetch" href="/Welcome/assets/js/22.547bbcbf.js"><link rel="prefetch" href="/Welcome/assets/js/23.ead5e6a4.js"><link rel="prefetch" href="/Welcome/assets/js/24.9e0e72ad.js"><link rel="prefetch" href="/Welcome/assets/js/25.fa8f4d05.js"><link rel="prefetch" href="/Welcome/assets/js/26.1bf3f67c.js"><link rel="prefetch" href="/Welcome/assets/js/27.ce57d01c.js"><link rel="prefetch" href="/Welcome/assets/js/28.cb29c565.js"><link rel="prefetch" href="/Welcome/assets/js/29.6907ddfb.js"><link rel="prefetch" href="/Welcome/assets/js/30.0be5fc4c.js"><link rel="prefetch" href="/Welcome/assets/js/31.6bde0d5c.js"><link rel="prefetch" href="/Welcome/assets/js/32.34f5889a.js"><link rel="prefetch" href="/Welcome/assets/js/33.2ca0ef80.js"><link rel="prefetch" href="/Welcome/assets/js/34.1717fdcc.js"><link rel="prefetch" href="/Welcome/assets/js/35.61737fc1.js"><link rel="prefetch" href="/Welcome/assets/js/36.7894ed75.js"><link rel="prefetch" href="/Welcome/assets/js/37.d90e4b65.js"><link rel="prefetch" href="/Welcome/assets/js/38.d1659e09.js"><link rel="prefetch" href="/Welcome/assets/js/39.caf6790b.js"><link rel="prefetch" href="/Welcome/assets/js/4.ffe2048e.js"><link rel="prefetch" href="/Welcome/assets/js/40.2504a486.js"><link rel="prefetch" href="/Welcome/assets/js/41.e7130bc9.js"><link rel="prefetch" href="/Welcome/assets/js/42.f7f7482f.js"><link rel="prefetch" href="/Welcome/assets/js/43.ac1c5fa2.js"><link rel="prefetch" href="/Welcome/assets/js/44.ef3652d5.js"><link rel="prefetch" href="/Welcome/assets/js/45.2c55d04e.js"><link rel="prefetch" href="/Welcome/assets/js/46.c4a65d3f.js"><link rel="prefetch" href="/Welcome/assets/js/47.8638023b.js"><link rel="prefetch" href="/Welcome/assets/js/48.72ce0eb1.js"><link rel="prefetch" href="/Welcome/assets/js/49.7cd3e27c.js"><link rel="prefetch" href="/Welcome/assets/js/5.2488397c.js"><link rel="prefetch" href="/Welcome/assets/js/50.a03b85bf.js"><link rel="prefetch" href="/Welcome/assets/js/51.589a3c46.js"><link rel="prefetch" href="/Welcome/assets/js/52.981c99fd.js"><link rel="prefetch" href="/Welcome/assets/js/53.fde74635.js"><link rel="prefetch" href="/Welcome/assets/js/54.2e2de828.js"><link rel="prefetch" href="/Welcome/assets/js/55.852d6024.js"><link rel="prefetch" href="/Welcome/assets/js/56.564b7e6b.js"><link rel="prefetch" href="/Welcome/assets/js/57.d15d395d.js"><link rel="prefetch" href="/Welcome/assets/js/58.ebd73e0e.js"><link rel="prefetch" href="/Welcome/assets/js/59.bea36105.js"><link rel="prefetch" href="/Welcome/assets/js/6.c8f2a0bc.js"><link rel="prefetch" href="/Welcome/assets/js/60.57e264e0.js"><link rel="prefetch" href="/Welcome/assets/js/61.81888b14.js"><link rel="prefetch" href="/Welcome/assets/js/62.d702fe6e.js"><link rel="prefetch" href="/Welcome/assets/js/63.1a728d38.js"><link rel="prefetch" href="/Welcome/assets/js/64.615fdf3a.js"><link rel="prefetch" href="/Welcome/assets/js/65.9bdbf700.js"><link rel="prefetch" href="/Welcome/assets/js/66.f4fbf76c.js"><link rel="prefetch" href="/Welcome/assets/js/67.6a2b7047.js"><link rel="prefetch" href="/Welcome/assets/js/68.4cde8bed.js"><link rel="prefetch" href="/Welcome/assets/js/69.08639d21.js"><link rel="prefetch" href="/Welcome/assets/js/7.72ca8d8f.js"><link rel="prefetch" href="/Welcome/assets/js/70.7fad46c9.js"><link rel="prefetch" href="/Welcome/assets/js/71.b87426aa.js"><link rel="prefetch" href="/Welcome/assets/js/72.7cbdc58c.js"><link rel="prefetch" href="/Welcome/assets/js/73.44891a19.js"><link rel="prefetch" href="/Welcome/assets/js/74.9fdab749.js"><link rel="prefetch" href="/Welcome/assets/js/75.d1888288.js"><link rel="prefetch" href="/Welcome/assets/js/77.c6781ffc.js"><link rel="prefetch" href="/Welcome/assets/js/78.4ce73b88.js"><link rel="prefetch" href="/Welcome/assets/js/79.d12ac054.js"><link rel="prefetch" href="/Welcome/assets/js/80.6738b1b4.js"><link rel="prefetch" href="/Welcome/assets/js/81.4373868b.js"><link rel="prefetch" href="/Welcome/assets/js/82.39b65938.js"><link rel="prefetch" href="/Welcome/assets/js/83.3a50d1b3.js"><link rel="prefetch" href="/Welcome/assets/js/84.bf35700b.js"><link rel="prefetch" href="/Welcome/assets/js/85.f76275c9.js"><link rel="prefetch" href="/Welcome/assets/js/86.485da767.js"><link rel="prefetch" href="/Welcome/assets/js/87.d19016fa.js"><link rel="prefetch" href="/Welcome/assets/js/9.73227006.js">
    <link rel="stylesheet" href="/Welcome/assets/css/0.styles.dc2e030a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="theme-container" class="theme-container post-container no-sidebar" data-v-60b9a85e><header class="navbar invert" data-v-60b9a85e><a href="/Welcome/" class="home-link router-link-active"><span class="site-name"> $ cd /home/ </span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/Welcome/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M489.2 287.9h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6V146.2c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-6-8-4.6-11.7-4.6v-38c8.3-2 17.1-3.4 25.7-3.4 10.9 0 20.9 4.3 31.4 4.3 4.6 0 27.7-1.1 27.7-8v-60c0-2.6-2-4.6-4.6-4.6-5.1 0-15.1 4.3-24 4.3-9.7 0-20.9-4.3-32.6-4.3-8 0-16 1.1-23.7 2.9v-4.9c5.4-2.6 9.1-8.3 9.1-14.3 0-20.7-31.4-20.8-31.4 0 0 6 3.7 11.7 9.1 14.3v111.7c-3.7 0-11.7-1.4-11.7 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32H128v-32c0-2.6-2-4.6-4.6-4.6H96c-2.6 0-4.6 2-4.6 4.6v178.3H54.8v-32c0-2.6-2-4.6-4.6-4.6H22.8c-2.6 0-4.6 2-4.6 4.6V512h182.9v-96c0-72.6 109.7-72.6 109.7 0v96h182.9V292.5c.1-2.6-1.9-4.6-4.5-4.6zm-288.1-4.5c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64zm146.4 0c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64z"/></svg>
  首页
</a></div><div class="nav-item"><a href="/Welcome/tags/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>
  时间轴 🏷️
</a></div><div class="nav-item"><a href="/Welcome/links/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg>
  链接 🌐
</a></div><div class="nav-item"><a href="/Welcome/docs/aboutMe/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M21 18H6a1 1 0 000 2h15v2H6a3 3 0 01-3-3V4a2 2 0 012-2h16v16zm-5-9V7H8v2h8z"/></svg>
  举杯 ❤
</a></div> <div class="nav-item"><a class="nav-link ov-parent ov-hover" style="cursor: pointer"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg>
      搜索
    </a></div></nav></div></header> <div class="sidebar-mask" data-v-60b9a85e></div> <aside class="sidebar" data-v-60b9a85e><div class="personal-info-wrapper" data-v-60b9a85e><div class="mobile-hero-avatar" data-v-60b9a85e><img src="https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/KaiYu-PicGo/202405241010613.png" alt="hero" data-v-60b9a85e></div> <p class="mobile-heading" data-v-60b9a85e>
          枫叶和雪花
        </p> <div class="sns-wrapper" data-v-60b9a85e><a href="https://github.com/LuJunandapai" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-59.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></svg></a><a href="https://www.twitter.com/Lu_isApai" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></svg></a><a href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-139.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"/></svg></svg></a><a href="https://www.linkedin.com/in/" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 01107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/></svg></svg></a><a href="https://www.zhihu.com/people/" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.344 17.963l-1.688 1.074-2.131-3.35c-.44 1.402-1.172 2.665-2.139 3.825-.402.483-.82.918-1.301 1.375-.155.147-.775.717-.878.82l-1.414-1.414c.139-.139.787-.735.915-.856.43-.408.795-.79 1.142-1.206 1.266-1.518 2.03-3.21 2.137-5.231H3v-2h4V7h-.868c-.689 1.266-1.558 2.222-2.618 2.857L2.486 8.143c1.395-.838 2.425-2.604 3.038-5.36l1.952.434c-.14.633-.303 1.227-.489 1.783H11.5v2H9v4h2.5v2H9.185l3.159 4.963zm3.838-.07L17.298 17H19V7h-4v10h.736l.446.893zM13 5h8v14h-3l-2.5 2-1-2H13V5z"/></svg></svg></a><a href="mailto:lu_yuelian@163.com" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></svg></a>  <a href="/rss.xml" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></svg></a></div> <hr data-v-60b9a85e></div> <nav class="nav-links"><div class="nav-item"><a href="/Welcome/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M489.2 287.9h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6V146.2c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-6-8-4.6-11.7-4.6v-38c8.3-2 17.1-3.4 25.7-3.4 10.9 0 20.9 4.3 31.4 4.3 4.6 0 27.7-1.1 27.7-8v-60c0-2.6-2-4.6-4.6-4.6-5.1 0-15.1 4.3-24 4.3-9.7 0-20.9-4.3-32.6-4.3-8 0-16 1.1-23.7 2.9v-4.9c5.4-2.6 9.1-8.3 9.1-14.3 0-20.7-31.4-20.8-31.4 0 0 6 3.7 11.7 9.1 14.3v111.7c-3.7 0-11.7-1.4-11.7 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32H128v-32c0-2.6-2-4.6-4.6-4.6H96c-2.6 0-4.6 2-4.6 4.6v178.3H54.8v-32c0-2.6-2-4.6-4.6-4.6H22.8c-2.6 0-4.6 2-4.6 4.6V512h182.9v-96c0-72.6 109.7-72.6 109.7 0v96h182.9V292.5c.1-2.6-1.9-4.6-4.5-4.6zm-288.1-4.5c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64zm146.4 0c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64z"/></svg>
  首页
</a></div><div class="nav-item"><a href="/Welcome/tags/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>
  时间轴 🏷️
</a></div><div class="nav-item"><a href="/Welcome/links/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg>
  链接 🌐
</a></div><div class="nav-item"><a href="/Welcome/docs/aboutMe/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M21 18H6a1 1 0 000 2h15v2H6a3 3 0 01-3-3V4a2 2 0 012-2h16v16zm-5-9V7H8v2h8z"/></svg>
  举杯 ❤
</a></div> <div class="nav-item"><a class="nav-link ov-parent ov-hover" style="cursor: pointer"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg>
      搜索
    </a></div></nav> <!----> </aside> <div class="content" data-v-60b9a85e><div class="post-header style-img" style="background-image:url(https://files.codelife.cc/wallhaven/full/zm/wallhaven-zmrmdo.png);" data-v-2c97064e><div class="header-mask" style="background:rgba(40, 57, 101, .4);" data-v-2c97064e></div> <div class="header-content" data-v-2c97064e><div class="tags" data-v-2c97064e><span class="tag" data-v-2c97064e>
        Linux
      </span><span class="tag" data-v-2c97064e>
        应用
      </span></div> <h1 class="title" data-v-2c97064e>
      Nginx 反向代理
    </h1> <h3 class="subtitle" data-v-2c97064e>
      在客户端看来，Nginx 服务端整体扮演了一个更大意义上的服务端的概念
    </h3> <div class="icons" data-v-2c97064e><div class="icon" data-v-2c97064e><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-2c97064e><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg> <span data-v-2c97064e>Lu Da Zhuang</span></div> <div class="icon" data-v-2c97064e><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-2c97064e><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg> <span data-v-2c97064e>2021-01-26</span></div> <div class="icon" data-v-2c97064e><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-2c97064e><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg> <span data-v-2c97064e>26 min</span></div></div></div></div> <main class="page"><!----> <div class="theme-content content__default"><h2 id="nginx-反向代理"><a href="#nginx-反向代理" class="header-anchor">#</a> Nginx 反向代理</h2> <h3 id="nginx-代理"><a href="#nginx-代理" class="header-anchor">#</a> Nginx 代理</h3> <p>在这种情况下，在客户端看来，<code>Nginx</code> + <code>服务端</code> 整体扮演了一个更大意义上的服务端的概念。</p> <p><strong>正向代理：</strong></p> <ul><li>如果把局域网外的Internet想象成一个巨大的资源库,</li> <li>则局域网中的客户端要访问Internet ,则需要通过代理服务器来访问,这种代理服务就称为正向代理。代理的是客户端</li></ul> <p><strong>反向代理：</strong></p> <ul><li>其实客户端对代理是无感知的,因为喜户端不需要任何配置就可以访问,</li> <li>我们只需要将请求发送到反向代理服务器,由反向代理服务器去选择目标服务器获取数据后,再返回给客户端,</li> <li>此时反向代理服务器和目标服务器对外就是一个服务器 ,暴露的是代理服务器地址,隐藏了真实服务器IP地址。代理的是服务器</li></ul> <h3 id="nginx-反向代理-案例"><a href="#nginx-反向代理-案例" class="header-anchor">#</a> Nginx  反向代理 案例:</h3> <p>1、后端工程：把一个springboot工程2个打包，分别指定运行端口8080和8081，在linux运行起来</p> <p>springboot工程：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token operator">+</span>port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
运行端口<span class="token number">8080</span>
</code></pre></div><p>2、nginx配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code>server {
    listen       80;
    server_name  www.woniu.com;
 
    location /api {
        proxy_pass  http://127.0.0.1:8080;
        rewrite &quot;^/api/(.*)$&quot; /$1 break;  
    } 
 	location / {
         root   html;
         index  index.html index.htm;
     }
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    } 
} 
</code></pre></div><p><strong>说明：</strong></p> <ul><li>当我们访问www.woniu.com时，默认请求nginx里面的html目录的index.html.</li> <li>当我们请求www.woniu.com/api/hello时，由于以/api开头，则匹配第一个location，然后请求http://127.0.0.1:8080服务器，</li> <li>那么问题来了，nginx转发的请求是http://127.0.0.1:8080/api/hello还是http://127.0.0.1:8080/api</li></ul> <p><strong>这里就要注意转发规则：</strong></p> <ul><li>大家可以看看这句话： rewrite &quot;^/user/(.*)$&quot; /$1 break;</li> <li>也就是路径重写  1代表第一个（）里面的内容，如果有第二.....多个括号，</li> <li>则同样的用2.....表示即可，这个正则表达式意思是说 以 api开头的被替换成/,( )里面的内容就是用$1占位符来表示，</li> <li>变相的把api截掉了</li></ul> <h2 id="nginx-window版"><a href="#nginx-window版" class="header-anchor">#</a> Nginx  Window版</h2> <ul><li><p>从<a href="">官网</a> (opens new window)](http://nginx.org/en/download.html)下载最新的文档版。例如：<code>nginx-1.18.0</code></p></li> <li><p>解压 <em><code>nginx-1.18.0.zip</code></em> 到本地目录。按惯例，路径中不要有中文，最好不要有空格。</p></li> <li><p>例如：<code>D:\ProgramFiles\nginx-1.18.0</code> 。</p></li> <li><p>解压后，可到看到如下内容：</p></li></ul> <div class="language-text extra-class"><pre class="language-text"><code>nginx-1.18.0
│── conf        配置文件目录
├── contrib
├── docs
├── html        类似 tomcat 的 webapps
├── logs        日志目录  access.log成功日志  error.log失败日志
├── temp
└── nginx.exe   启动程序
</code></pre></div><h3 id="启动-nginx"><a href="#启动-nginx" class="header-anchor">#</a> 启动 Nginx</h3> <p>启动 Nginx 的方式有 2 种：</p> <ol><li>直接双击 <code>nginx.exe</code>。双击后一个黑色的弹窗一闪而过。</li> <li>打开 cmd 命令窗口，切换到 nginx 解压目录下，输入命令 <code>nginx.exe</code> 或者 <code>start nginx</code> 。</li></ol> <p>检查 Nginx 是否启动成功的方式也有 2 种：</p> <ol><li><p>直接在浏览器地址栏输入网址 <a href="http://localhost/" target="_blank" rel="noopener noreferrer"><em>http://localhost:80</em> (opens new window)</a>。你会看到欢迎页面。</p></li> <li><p>在 cmd 命令窗口输入命令 <code>tasklist /fi &quot;imagename eq nginx.exe&quot;</code> 。你会看到类似如下页面：</p> <div class="language-text extra-class"><pre class="language-text"><code>映像名称    PID     会话名      会话#   内存使用
=========== ======= =========== ======= ============
nginx.exe   17220   Console     8       7,148 K
nginx.exe   17660   Console     8       7,508 K
</code></pre></div></li></ol> <h3 id="关闭-nginx"><a href="#关闭-nginx" class="header-anchor">#</a> 关闭 Nginx</h3> <p>如果使用 cmd 命令窗口启动 nginx，关闭 cmd 窗口是<strong>不能</strong>结束 nginx 进程的。</p> <p>可使用两种方法关闭 nginx：</p> <ol><li>输入 <code>nginx</code> 命令：<code>nginx -s stop</code>（快速停止 nginx）或 <code>nginx -s quit</code>（完整有序的停止 nginx）。</li> <li>使用 <code>taskkill</code> 命令： <code>taskkill /f /t /im nginx.exe</code></li></ol> <h2 id="nginx-linux版"><a href="#nginx-linux版" class="header-anchor">#</a> Nginx linux版</h2> <h3 id="nginx-环境依赖"><a href="#nginx-环境依赖" class="header-anchor">#</a> Nginx 环境依赖</h3> <p>1、需要安装gcc的环境。yum install gcc-c++</p> <p>2、第三方的开发包。</p> <p>PCRE:PCRE(Perl Compatible Regular Expressions)是一个Perl库，包括 perl 兼容的正则表达式库。nginx的http模块使用pcre来解析正则表达式，所以需要在linux上安装pcre库。pcre-devel是使用pcre开发的一个二次开发库。nginx也需要此库。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> -y pcre pcre-devel
</code></pre></div><p>zlib:zlib库提供了很多种压缩和解压缩的方式，nginx使用zlib对http包的内容进行gzip，所以需要在linux上安装zlib库。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> -y zlib zlib-devel
</code></pre></div><p>openssl:	OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用。nginx不仅支持http协议，还支持https（即在ssl协议上传输http），所以需要在linux安装openssl库。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> -y openssl openssl-devel
</code></pre></div><h3 id="nginx-安装步骤"><a href="#nginx-安装步骤" class="header-anchor">#</a> Nginx 安装步骤</h3> <p>把nginx的源码包上传到linux系统</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># tar zxvf nginx-1.8.0.tar.gz</span>
</code></pre></div><p>使用configure命令创建一makeFile文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./configure <span class="token punctuation">\</span>
--prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
--pid-path<span class="token operator">=</span>/var/run/nginx/nginx.pid <span class="token punctuation">\</span>
--lock-path<span class="token operator">=</span>/var/lock/nginx.lock <span class="token punctuation">\</span>
--error-log-path<span class="token operator">=</span>/var/log/nginx/error.log <span class="token punctuation">\</span>
--http-log-path<span class="token operator">=</span>/var/log/nginx/access.log <span class="token punctuation">\</span>
--with-http_gzip_static_module <span class="token punctuation">\</span>
--http-client-body-temp-path<span class="token operator">=</span>/var/temp/nginx/client <span class="token punctuation">\</span>
--http-proxy-temp-path<span class="token operator">=</span>/var/temp/nginx/proxy <span class="token punctuation">\</span>
--http-fastcgi-temp-path<span class="token operator">=</span>/var/temp/nginx/fastcgi <span class="token punctuation">\</span>
--http-uwsgi-temp-path<span class="token operator">=</span>/var/temp/nginx/uwsgi <span class="token punctuation">\</span>
--http-scgi-temp-path<span class="token operator">=</span>/var/temp/nginx/scgi
</code></pre></div><p>注意：启动nginx之前，上边将临时文件目录指定为/var/temp/nginx，需要在/var下创建temp及nginx目录</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment"># mkdir  -p  /var/temp/nginx/client </span>
<span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment">#make</span>
<span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment">#make install</span>
</code></pre></div><h3 id="启动-nginx-2"><a href="#启动-nginx-2" class="header-anchor">#</a> 启动 Nginx</h3> <blockquote><p>注意:  安装完成的源目录是在 /usr/local/nginx/sbin 里 并不是安装包的位置</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code>进入sbin目录
<span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment"># ./nginx </span>
关闭nginx：
<span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment"># ./nginx -s stop</span>
推荐使用：
<span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment"># ./nginx -s quit</span>
重启nginx：
<span class="token number">1</span>、先关闭后启动。
<span class="token number">2</span>、刷新配置文件：
<span class="token punctuation">[</span>root@localhost sbin<span class="token punctuation">]</span><span class="token comment"># ./nginx -s reload</span>
</code></pre></div><h3 id="访问-nginx"><a href="#访问-nginx" class="header-anchor">#</a> 访问 Nginx</h3> <p>默认是80端口。注意：是否关闭防火墙。</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token namespace">[root@localhost sbin]</span><span class="token comment"># systemctl stop firewalld.service</span>
</code></pre></div><h2 id="nginx-配置文件"><a href="#nginx-配置文件" class="header-anchor">#</a> Nginx 配置文件</h2> <ul><li>在 nginx.conf 的注释符号为： #；每个指令必须有分号结束</li></ul> <h3 id="全局块"><a href="#全局块" class="header-anchor">#</a> 全局块</h3> <div class="language-txt extra-class"><pre class="language-txt"><code>user  nobody; 表示配置用户，默认用户为nobody（nobody表示任何用户），该指令的作用是哪些用户可以启动worker进程。nginx在启动后是有多个进程相互协助工作的，默认是一个master主进程和一个worker工作进程。其中主进程负责接收客户端的请求，worker进程负责处理请求，响应结果。你也可以把前面的注释去掉，写上一个具体的用户 user root

worker_processes：工作进程的个数，默认为1，一般来说会设置成cpu核数的2倍；如果你设置一个数值为3，那么nginx在启动的时候会有3个workder进程和一个master主进程

error_log：nginx的日志级别配置， 默认为cri，级别从低到高为debug, info, notice, warn, error, crit ；如果你要调成notice日志级别，只要#error_log  logs/error.log  notice;前面的注释去掉即可，日志位置在安装nginx的时候就已经指定

pid：指定nginx进程运行文件存放地址
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
<span class="token comment">#error_log  logs/error.log  info;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>

</code></pre></div><h3 id="events块"><a href="#events块" class="header-anchor">#</a> events块</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code>events <span class="token punctuation">{</span>
	accept_mutex on<span class="token punctuation">;</span>   <span class="token comment">#设置网路连接序列化，防止惊群现象发生，默认为on</span>
	multi_accept on<span class="token punctuation">;</span>  <span class="token comment">#设置一个进程是否同时接受多个网络连接，默认为off</span>
    worker_connections  1024<span class="token punctuation">;</span>  <span class="token comment">#每个worker进程最大连接数，这个值最大可设置为：65535</span>
<span class="token punctuation">}</span>
<span class="token comment">##惊群现象：一个网路连接到来，多个睡眠的进程被同时叫醒，但只有一个进程能获得链接，这样会影响系统性能</span>
<span class="token comment">##单台nginx最大连接数为 worker_processes*worker_connections</span>
</code></pre></div><h3 id="http块"><a href="#http块" class="header-anchor">#</a> http块</h3> <p>可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置</p> <h3 id="server块"><a href="#server块" class="header-anchor">#</a> server块</h3> <p>配置虚拟主机的相关参数，一个http中可以有多个server</p> <h3 id="location块"><a href="#location块" class="header-anchor">#</a> location块</h3> <p>配置请求的路由，以及各种页面的处理情况</p> <h2 id="nginx-配置虚拟主机"><a href="#nginx-配置虚拟主机" class="header-anchor">#</a> Nginx 配置虚拟主机</h2> <p>就是在一台服务器启动多个网站。如何区分不同的网站：</p> <p>1、域名不同</p> <p>2、端口不同</p> <h3 id="通过端口区分不同虚拟机"><a href="#通过端口区分不同虚拟机" class="header-anchor">#</a> 通过端口区分不同虚拟机</h3> <h4 id="打开nginx的配置文件"><a href="#打开nginx的配置文件" class="header-anchor">#</a> 打开Nginx的配置文件</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># vim  conf/nginx.conf</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>
    <span class="token comment">#charset koi8-r;</span>
    <span class="token comment">#access_log  logs/host.access.log  main;</span>
    location / <span class="token punctuation">{</span>
    root   html<span class="token punctuation">;</span>
    index  index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>说明：一个server节点就是一个虚拟主机，html是nginx安装目录下的html目录(静态页面存放的位置,也可以使用绝对路径)，可以配置多个server，配置了多个虚拟主机</p></blockquote> <div class="language-powershell extra-class"><pre class="language-powershell"><code> server <span class="token punctuation">{</span>
        listen       81<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        <span class="token comment">#charset koi8-r;</span>
        <span class="token comment">#access_log  logs/host.access.log  main;</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   html<span class="token operator">-</span>81<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="重新加载配置文件"><a href="#重新加载配置文件" class="header-anchor">#</a> 重新加载配置文件</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token namespace">[root@localhost nginx]</span><span class="token comment"># sbin/nginx -s reload</span>
</code></pre></div><p>注意: <strong>一定要关闭防火墙</strong></p> <h3 id="通过域名区分虚拟主机"><a href="#通过域名区分虚拟主机" class="header-anchor">#</a> 通过域名区分虚拟主机</h3> <h4 id="什么是域名"><a href="#什么是域名" class="header-anchor">#</a> 什么是域名</h4> <p>域名就是网站。如www.baidu.com  www.taobao.com   <a href="http://www.jd.com" target="_blank" rel="noopener noreferrer">www.jd.com</a></p> <p>dns服务器：把域名解析为ip地址。保存的就是域名和ip的映射关系</p> <ul><li><p>一级域名：一串字符串中间一个点隔开，例如baidu.com。是互联网DNS等级之中的最高级的域，它保存于DNS根域的名字空间中</p></li> <li><p>二级域名：是一个一级域名以下的主机名，一串字符串中间两个“.”隔开，例如www.baidu.com。二级域名就是最靠近顶级域名左侧的字段</p></li> <li><p>三级域名：二级域名的子域名，特征是包含三个“.”，例如___.___.baidu.com ，___上可以填写任意内容，都属于三级域名</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code>我们接触的顶级域名<span class="token punctuation">(</span>一级域名<span class="token punctuation">)</span>又分为两类：一是国家和地区顶级域名，例如中国是cn；二是国际顶级域名，例如表示工商企业的<span class="token punctuation">.</span>com，表示非盈利组织的<span class="token punctuation">.</span>org，表示网络商的<span class="token punctuation">.</span>net，edu为学校单位，<span class="token punctuation">.</span>gov为政府机构等

一个域名对应一个ip地址，一个ip地址可以被多个域名绑定。
</code></pre></div><p>实验1：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>修改window的hosts文件：（C:\Windows\System32\drivers\etc）
注意：该文件如果配置域名和ip的映射关系，如果hosts文件中配置了域名和ip的对应关系，不需要走dns服务器。
</code></pre></div><div class="language-powershell extra-class"><pre class="language-powershell"><code>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>128<span class="token punctuation">.</span>129 www<span class="token punctuation">.</span>jd<span class="token punctuation">.</span>com
192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>128<span class="token punctuation">.</span>129 www<span class="token punctuation">.</span>163<span class="token punctuation">.</span>com
</code></pre></div><p>注意：如果修改后映射不生效，可参考以下解决办法：</p> <p>1.该文件保存时未使用ansi编码进行保存，解决办法：更改文件编码为ansi进行保存</p> <p>2.启用了DNS Client服务（该服务为DNS解析的缓存服务）解决办法：将该服务停用；如果该服务为自动启用，请改为手动启用</p> <h4 id="nginx的配置"><a href="#nginx的配置" class="header-anchor">#</a> <strong>Nginx的配置</strong></h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code>server <span class="token punctuation">{</span>
        listen       80<span class="token punctuation">;</span>
        server_name  www<span class="token punctuation">.</span>jd<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        <span class="token comment">#charset koi8-r;</span>
        <span class="token comment">#access_log  logs/host.access.log  main;</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   html<span class="token operator">-</span>jd<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 server <span class="token punctuation">{</span>
        listen       80<span class="token punctuation">;</span>
        server_name  www<span class="token punctuation">.</span>163<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        <span class="token comment">#charset koi8-r;</span>
        <span class="token comment">#access_log  logs/host.access.log  main;</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   html<span class="token operator">-</span>163<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="nginx-负载均衡"><a href="#nginx-负载均衡" class="header-anchor">#</a> Nginx  负载均衡</h2> <p>负载均衡（load balance）就是将负载分摊到多个操作单元上执行，从而提高服务的可用性和响应速度，带给用户更好的体验</p> <h3 id="负载均衡的配置"><a href="#负载均衡的配置" class="header-anchor">#</a> 负载均衡的配置</h3> <p>通过 Nginx 中的 <strong>upstream</strong> 指令可以实现负载均衡，再该指令中能够配置负载均衡服务器组</p> <p>目前负载均衡有 4 种典型的配置方式。分别是：</p> <table><thead><tr><th style="text-align:center;">#</th> <th style="text-align:left;">负载均衡方式</th> <th style="text-align:left;">特点</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:left;">轮询方式</td> <td style="text-align:left;">默认方式。每个请求按照时间顺序逐一分配到不同的后端服务器进行处理。如果有服务器宕机，会自动删除。</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:left;">权重方式</td> <td style="text-align:left;">利用 weight 指定轮循的权重比率，与访问率成正比。用于后端服务器性能不均衡的情况。</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:left;">ip_hash 方法</td> <td style="text-align:left;">每个请求按照访问 IP 的 hash 结果分配，这样可以使每个方可固定一个后端服务器，可以解决 Session 共享问题。</td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:left;">第三方模块</td> <td style="text-align:left;">取决于所采用的第三方模块的分配规则。</td></tr></tbody></table> <p>在 upstream 指定的服务器组中，若每个服务器的权重都设置为 1（默认值）时，表示当前的负载均衡是一般轮循方式</p> <h3 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h3> <p>编写后台（SpringBoot）项目，简单起见，以占用不同的端口的形式启动 2 次，并在返回的信息中返回各自所占用的端口号</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> port<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10086&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="负载方式"><a href="#负载方式" class="header-anchor">#</a> 负载方式</h3> <h4 id="_1-轮询"><a href="#_1-轮询" class="header-anchor">#</a> 1.轮询</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code>upstream xxx <span class="token punctuation">{</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:8080<span class="token punctuation">;</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:9090<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
upstream yyy <span class="token punctuation">{</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    location <span class="token operator">/</span>api <span class="token punctuation">{</span>
        proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span>xxx<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    location <span class="token operator">/</span>user <span class="token punctuation">{</span>
        proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span>yyy<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述的配置中有 2 点需要注意的：</p> <p>1、<strong>upstream</strong> 配置项在 <strong>http</strong> 配置项内，但是在 <strong>server</strong> 配置项外，它们 3 者整体结构如下（不要写错地方了）：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>http <span class="token punctuation">{</span>
    <span class="token comment"># 它们两者平级</span>
    server <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    upstream <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2、你所配置的 <strong>upstream</strong> 的 name 是自定义的，但是不要出现 <strong><code>-</code></strong> 号，否则会和 tomcat 有冲突。</p> <p>测试：你持续访问 <code>http://127.0.0.1/api/hello</code> 你会发现页面的内容会是交替出现 <code>8080</code> 端口和 <code>9090</code> 端口</p> <h4 id="_2-加权轮询"><a href="#_2-加权轮询" class="header-anchor">#</a> 2.加权轮询</h4> <p>加权轮循就是在轮循的基础上，为每个单点加上权值。权值越重的单点，承担的访问量自然也就越大。</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>upstream xxx <span class="token punctuation">{</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:8080 weight=1<span class="token punctuation">;</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:9090 weight=2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>按照上述配置，<code>9090</code> 端口的服务将承担 2/3 的访问量，而 <code>8080</code> 端口则承担 1/3 的访问量。</p> <p>将配置改为上述样子并重启 Nginx 后，再持续访问 <code>http://127.0.0.1/api/hello</code> 你会发现 <code>8080</code> 端口和 <code>9090</code> 端口会以 <code>1-2-1-2-...</code> 的次数交替出现。</p> <p>除了 <strong>weight</strong> 外，常见的状态参数还有：</p> <table><thead><tr><th style="text-align:left;">配置方式</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">max_fails</td> <td style="text-align:left;">允许请求失败次数，默认为 1 。通常和下面的 fail_timeout 连用。</td></tr> <tr><td style="text-align:left;">fail_timeout</td> <td style="text-align:left;">在经历了 max_fails 次失败后，暂停服务的时长。这段时间内，这台服务器 Nginx 不会请求这台 Server</td></tr> <tr><td style="text-align:left;">backup</td> <td style="text-align:left;">预留的备份机器。它只有在其它非 backup 机器出现故障时或者忙碌的情况下，才会承担负载任务。</td></tr> <tr><td style="text-align:left;">down</td> <td style="text-align:left;">表示当前的 server 不参与负载均衡。</td></tr></tbody></table> <p>例如：</p> <div class="language-text extra-class"><pre class="language-text"><code>upstream web_server {
    server 192.168.78.128 weight=1 max_fails=1 fail_timeout=30s;
    server 192.168.78.200 weight=2 max_fails=1 fail_timeout=30s;
    server 192.168.78.201 backup;
    server 192.168.78.210 down;
}
</code></pre></div><h4 id="_3-ip-hash-负载"><a href="#_3-ip-hash-负载" class="header-anchor">#</a> 3.ip_hash 负载</h4> <p>ip_hash 方式的负载均衡，是将每个请求按照访问 IP 的 hash 结果分配，这样就可以使来自同一个 IP 的客户端固定访问一台 Web 服务器，从而就解决了 Session 共享问题</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>upstream xxx <span class="token punctuation">{</span>
    ip_hash<span class="token punctuation">;</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:8080<span class="token punctuation">;</span>
    server 127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:9090<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用上例配置后，你会发现无论你请求多少次 <code>http://127.0.0.1/api/hello</code> 你所看到的端口始终是 <code>8080</code> 和 <code>9090</code> 中的某一个。</p> <h3 id="浏览器ip传递到后台"><a href="#浏览器ip传递到后台" class="header-anchor">#</a> 浏览器IP传递到后台</h3> <p>对于后台而言，它所面对的『<strong>客户端</strong>』就是 Nginx，后台看不见『<strong>客户端</strong>』浏览器。这就意味着，你如果你需要在后台获取客户端浏览器的 IP 地址，你需要明确指出让 Nginx 『<strong>额外地多携带</strong>』一些数据。</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>location <span class="token operator">/</span>api <span class="token punctuation">{</span>
    proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span>xxx<span class="token operator">/</span>api<span class="token punctuation">;</span>
    proxy_set_header X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>

    <span class="token comment"># proxy_set_header Cookie $http_cookie;</span>
    <span class="token comment"># proxy_set_header Host $http_host;</span>
    <span class="token comment"># proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 Spring Boot 的 Controller 中你有 2 种方式来获得这个额外的信息：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">index</span><span class="token punctuation">(</span>
        <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Real-IP&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> realIP2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> realIP1 <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Real-IP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="nginx-解决前后端跨域"><a href="#nginx-解决前后端跨域" class="header-anchor">#</a> Nginx 解决前后端跨域</h3> <p>Spring Boot 不提供任何动态页面、资源，只提供 JSON 格式数据</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>http <span class="token punctuation">{</span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  65<span class="token punctuation">;</span>  <span class="token comment"># TCP 连接存活 65 秒</span>
    server <span class="token punctuation">{</span>
        <span class="token comment"># Nginx 监听 localhost:80 端口</span>
        listen       80<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment"># 访问 URI 根路径时，返回 Nginx 根目录下的 html 目录下的 index.html 或 index.htm</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># URI 路径以 /api 开头的将转交给『别人』处理</span>
        location <span class="token operator">/</span>api <span class="token punctuation">{</span>
            proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span>localhost:8080<span class="token operator">/</span>api<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 出现 500、502、503、504 错误时，返回 Nginx 根目录下的 html 目录下的 50x.html 。</span>
        error_page   500 502 503 504  <span class="token operator">/</span>50x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>    
        location = <span class="token operator">/</span>50x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.html内容，放nginx运行</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/jquery-1.11.3.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">'http://192.168.128.128:80/api/hello'</span><span class="token punctuation">,</span> <span class="token comment">// 注意这里的 URL</span>
  type<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;跨域访问成功:&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;跨域失败!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>首先当我们访问192.168.128.128时。显示index.html首页内容。在首页加载时异步请求http://127.0.0.1:80/api/hello的请求，被Nginx 接收后，Nginx 会『帮』我们去访问 http://127.0.0.1:8080<code>的</code>/api/hello，并将结果再返回给客户端了浏览器</p> <h2 id="nginx-docker-部署"><a href="#nginx-docker-部署" class="header-anchor">#</a> Nginx Docker 部署</h2> <h3 id="创建docker容器"><a href="#创建docker容器" class="header-anchor">#</a> 创建Docker容器</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 拉取nginx镜像</span>
docker pull nginx
<span class="token comment"># 创建名为: My_nginx 的 Nginx 容器</span>
docker run -id --name<span class="token operator">=</span>My_nginx -p <span class="token number">9004</span>:80 nginx:latest
</code></pre></div><h3 id="修改配置"><a href="#修改配置" class="header-anchor">#</a> 修改配置</h3> <ul><li>进入容器后 修改配置 设置端口代理</li></ul> <h4 id="nginx-配置文件路径"><a href="#nginx-配置文件路径" class="header-anchor">#</a> Nginx 配置文件路径</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 配置文件</span>
/etc/nginx/nginx.conf  
<span class="token comment"># 设置端口代理配置文件</span>
/etc/nginx/conf.d/default.conf
<span class="token comment"># nginx容器默认的日志文件保存到/var/log/nginx目录下</span>
/var/log/nginx        
<span class="token comment">#nginx默认会去访问/usr/share/nginx/html下的index.html</span>
/usr/share/nginx/html       
</code></pre></div><h4 id="nginx-conf-详解"><a href="#nginx-conf-详解" class="header-anchor">#</a> nginx.conf 详解</h4> <ul><li>可将 server 部分拆开写入 default.conf 配置文件内</li></ul> <div class="language-powershell extra-class"><pre class="language-powershell"><code>http <span class="token punctuation">{</span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  65<span class="token punctuation">;</span>  <span class="token comment"># TCP 连接存活 65 秒</span>
    server <span class="token punctuation">{</span>
        <span class="token comment"># Nginx 监听 localhost:80 端口</span>
        listen       80<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment"># 访问 URI 根路径时，返回 Nginx 根目录下的 html 目录下的 index.html 或 index.htm</span>
        location <span class="token operator">/</span> <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># URI 路径以 /api 开头的将转交给『别人』处理</span>
        location <span class="token operator">/</span>api <span class="token punctuation">{</span>
            proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span>localhost:8080<span class="token operator">/</span>api<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># 出现 500、502、503、504 错误时，返回 Nginx 根目录下的 html 目录下的 50x.html 。</span>
        error_page   500 502 503 504  <span class="token operator">/</span>50x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>    
        location = <span class="token operator">/</span>50x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="default-conf-详解"><a href="#default-conf-详解" class="header-anchor">#</a> default.conf 详解</h4> <ul><li>location / 进行转发到前端打包文件目录</li> <li>location /api 转发代理到对应的后端地址</li> <li>/webSocket 转发webSocket 代理到对应的后端地址 注意同步前端配置</li></ul> <div class="language-powershell extra-class"><pre class="language-powershell"><code>server <span class="token punctuation">{</span>
    
    <span class="token comment"># Nginx 监听 localhost:80 端口</span>
    listen       80<span class="token punctuation">;</span>
    listen  <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80<span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>
    
    <span class="token comment"># 配置请求报文的最大值 上传文件</span>
    client_max_body_size 20m<span class="token punctuation">;</span>
    
    <span class="token comment"># WebSocket代理</span>
    location <span class="token operator">/</span>webSocket <span class="token punctuation">{</span>
        proxy_pass http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>180:3001<span class="token punctuation">;</span>
        proxy_http_version 1<span class="token punctuation">.</span>1<span class="token punctuation">;</span>
        proxy_set_header Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
        proxy_set_header Connection <span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># URI 路径以 /api 开头的将转交给『别人:175.178.126.61:1082』处理</span>
    location <span class="token operator">/</span>api <span class="token punctuation">{</span>
        proxy_pass  http:<span class="token operator">/</span><span class="token operator">/</span>175<span class="token punctuation">.</span>178<span class="token punctuation">.</span>126<span class="token punctuation">.</span>61:1082<span class="token punctuation">;</span> <span class="token comment"># 转发的后端地址</span>
        rewrite <span class="token string">&quot;^/api/(.*)$&quot;</span> <span class="token operator">/</span><span class="token variable">$1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token comment"># 进行路径的裁切</span>
        
        <span class="token comment"># 因为代理则会导致后端的request.getRemoteAddr()获取的ip为代理的地址 则需要获取真实的请求地址需配置</span>
        proxy_set_header X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span> <span class="token comment"># 自定义的请求头 X-Real-IP，其值为客户端的真实 IP 地址</span>
        proxy_set_header X<span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span> <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span> <span class="token comment"># 自定义的请求头 X-Forwarded-For，它通常包含了一个或多个 IP 地址，表示经过的代理服务器列表。$proxy_add_x_forwarded_for 将会把客户端的原始 IP 地址追加到这个列表中</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 访问 URI 根路径时，返回 Nginx 根目录下的 html 目录下的 index.html 或 index.htm</span>
    location <span class="token operator">/</span> <span class="token punctuation">{</span>
        root   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>Apai<span class="token operator">-</span>Html<span class="token punctuation">;</span>
        index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 出现 500、502、503、504 错误时，返回 Nginx 根目录下的 html 目录下的 50x.html</span>
    error_page   500 502 503 504  <span class="token operator">/</span>50x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    location = <span class="token operator">/</span>50x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
        root   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="vue-websocket-配置"><a href="#vue-websocket-配置" class="header-anchor">#</a> Vue WebSocket 配置</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 根据请求链接到后端 </span>
<span class="token comment">// 去掉 http://  websocket=ws://前端启动地址端口/webSocket根据这个进行代理转发/发送的后端数据</span>
<span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>websocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://'</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">'/webSocket/'</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span>

<span class="token comment">// vue.config.js 配置 webSocket 和 请求 转发代理 (仅在本地启动环境生效)</span>
<span class="token keyword">const</span> targetUrl <span class="token operator">=</span> <span class="token string">&quot;192.168.1.180:3001&quot;</span><span class="token punctuation">;</span>
proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;/webSocket&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">&quot;ws://&quot;</span> <span class="token operator">+</span> targetUrl<span class="token punctuation">,</span>
    ws<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/api&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>                          <span class="token comment">// 1 客户端发送的那些请求需要被代理服务器进行替换</span>
    target<span class="token operator">:</span> <span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> targetUrl<span class="token punctuation">,</span>                <span class="token comment">// 2 服务器的访问地址 target: &quot;http://127.0.0.1:9000&quot;,</span>
    changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>               <span class="token comment">// 3 是否跨域</span>
    pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;^/api&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;/&quot;</span>   <span class="token comment">// 4 客户端发送请求被代理的规则 /api/userList  -&gt; /userList</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="放入项目包"><a href="#放入项目包" class="header-anchor">#</a> 放入项目包</h3> <ul><li>将前端打包为文件夹 主文件: index.html</li> <li>放人我们配置的位置 例如: /usr/share/nginx/Apai-Html 文件夹下</li> <li>最后 刷新Nginx 的配置 和重启Nginx 服务即可</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 要刷新Nginx的配置文件，可以使用以下命令：</span>
docker <span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span>container_name<span class="token operator">&gt;</span> nginx -s reload
docker <span class="token builtin class-name">exec</span> 345f6fe1339a nginx -s reload
<span class="token comment"># 其中 &lt;container_name&gt; 是你的 Nginx Docker 容器的名称或 ID。</span>
<span class="token comment"># 如果需要重启 Nginx 服务器，可以使用以下命令：</span>
docker restart <span class="token operator">&lt;</span>container_name<span class="token operator">&gt;</span>
docker restart 345f6fe1339a
</code></pre></div><h3 id="参考副本"><a href="#参考副本" class="header-anchor">#</a> 参考副本</h3> <ul><li>PMS 系统的 nginx 的配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
#user  nobody<span class="token punctuation">;</span>
  ## Nginx 内核配置
  worker_processes <span class="token number">4</span><span class="token punctuation">;</span>
  worker_rlimit_nofile <span class="token number">65535</span><span class="token punctuation">;</span>


  events <span class="token punctuation">{</span>
  # 最大连接数
  worker_connections <span class="token number">3000</span><span class="token punctuation">;</span>
  #     use epoll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


  http <span class="token punctuation">{</span>
  include mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
  default_type application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

  sendfile on<span class="token punctuation">;</span>
  tcp_nopush on<span class="token punctuation">;</span>
  # 连接超时时间
  keepalive_timeout <span class="token number">60</span><span class="token punctuation">;</span>
  tcp_nodelay on<span class="token punctuation">;</span>
  client_header_buffer_size <span class="token number">4</span>k<span class="token punctuation">;</span>
  open_file_cache max<span class="token operator">=</span><span class="token number">102400</span> inactive<span class="token operator">=</span><span class="token number">20</span>s<span class="token punctuation">;</span>
  open_file_cache_valid <span class="token number">30</span>s<span class="token punctuation">;</span>
  open_file_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
  client_header_timeout <span class="token number">15</span><span class="token punctuation">;</span>
  client_body_timeout <span class="token number">15</span><span class="token punctuation">;</span>
  reset_timedout_connection on<span class="token punctuation">;</span>
  send_timeout <span class="token number">15</span><span class="token punctuation">;</span>
  server_tokens off<span class="token punctuation">;</span>
  client_max_body_size <span class="token number">10</span>m<span class="token punctuation">;</span>

  #开启压缩功能
  gzip on<span class="token punctuation">;</span>
  gzip_min_length <span class="token number">2</span>k<span class="token punctuation">;</span>
  gzip_buffers <span class="token number">4</span> <span class="token number">32</span>k<span class="token punctuation">;</span>
  gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
  gzip_comp_level <span class="token number">6</span><span class="token punctuation">;</span>
  gzip_types text<span class="token operator">/</span>plain text<span class="token operator">/</span>css text<span class="token operator">/</span>javascriptapplication<span class="token operator">/</span>json application<span class="token operator">/</span>javascript application<span class="token operator">/</span>x<span class="token operator">-</span>javascriptapplication<span class="token operator">/</span>xml<span class="token punctuation">;</span>
  gzip_vary on<span class="token punctuation">;</span>
  gzip_proxied any<span class="token punctuation">;</span>


  server <span class="token punctuation">{</span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
  server_name <span class="token number">192.168</span><span class="token number">.197</span><span class="token number">.128</span><span class="token punctuation">;</span>
  ## html 路径
  location <span class="token operator">/</span> <span class="token punctuation">{</span>
  root <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pmsPage<span class="token punctuation">;</span>
  index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  # 后台服务接口转发
  location <span class="token operator">/</span>pmsApi <span class="token punctuation">{</span>
  # rewrite <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">+</span>pms<span class="token operator">/</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token operator">/</span>$<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  include uwsgi_params<span class="token punctuation">;</span>
  proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.197</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">9525</span><span class="token operator">/</span>pms<span class="token punctuation">;</span>
  proxy_set_header Host $host<span class="token operator">:</span>$server_port<span class="token punctuation">;</span>
  proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Real<span class="token operator">-</span><span class="token constant">IP</span> $remote_addr<span class="token punctuation">;</span>
  proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
  proxy_buffer_size <span class="token number">1024</span>k<span class="token punctuation">;</span>
  proxy_buffers <span class="token number">16</span> <span class="token number">1024</span>k<span class="token punctuation">;</span>
  proxy_busy_buffers_size <span class="token number">2048</span>k<span class="token punctuation">;</span>
  proxy_temp_file_write_size <span class="token number">2048</span>k<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

  ## 解决 shiro 未登录重定向 <span class="token number">302</span>异常
  location <span class="token operator">/</span>pms <span class="token punctuation">{</span>
  # Shiro 未登录重定向配置
  include uwsgi_params<span class="token punctuation">;</span>
  proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.197</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">9525</span><span class="token operator">/</span>pms<span class="token punctuation">;</span>
  proxy_set_header Host $host<span class="token operator">:</span>$server_port<span class="token punctuation">;</span>
  proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Real<span class="token operator">-</span><span class="token constant">IP</span> $remote_addr<span class="token punctuation">;</span>
  proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
  proxy_buffer_size <span class="token number">1024</span>k<span class="token punctuation">;</span>
  proxy_buffers <span class="token number">16</span> <span class="token number">1024</span>k<span class="token punctuation">;</span>
  proxy_busy_buffers_size <span class="token number">2048</span>k<span class="token punctuation">;</span>
  proxy_temp_file_write_size <span class="token number">2048</span>k<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

  error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  location <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
  root html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code>这段配置是用来配置 <span class="token class-name">Nginx</span> 作为代理服务器时设置请求头的。下面是各个指令的解释：

proxy_set_header <span class="token class-name">Host</span> $host<span class="token operator">:</span>$server_port<span class="token punctuation">;</span>：

这个指令设置了 <span class="token class-name">Host</span> 请求头的值，它将被设置为客户端请求中的 $host，即客户端请求的主机名，后跟 <span class="token operator">:</span>，然后是 <span class="token class-name">Nginx</span> 服务器监听的端口号 $server_port。
proxy_set_header <span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Real</span><span class="token operator">-</span>IP $remote_addr<span class="token punctuation">;</span>：

这个指令设置了一个自定义的请求头 <span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Real</span><span class="token operator">-</span>IP，其值为客户端的真实 IP 地址，即 $remote_addr。
proxy_set_header <span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Forwarded</span><span class="token operator">-</span><span class="token class-name">For</span> $proxy_add_x_forwarded_for<span class="token punctuation">;</span>：

这个指令设置了另一个自定义的请求头 <span class="token class-name">X</span><span class="token operator">-</span><span class="token class-name">Forwarded</span><span class="token operator">-</span><span class="token class-name">For</span>，它通常包含了一个或多个 IP 地址，表示经过的代理服务器列表。$proxy_add_x_forwarded_for 将会把客户端的原始 IP 地址追加到这个列表中。
proxy_buffer_size <span class="token number">1024</span>k<span class="token punctuation">;</span>：

这个指令设置了用于存储从上游服务器接收到的响应的缓冲区大小。在这里设置为 <span class="token number">1024</span>KB，即 <span class="token number">1</span>MB。
proxy_buffers <span class="token number">16</span> <span class="token number">1024</span>k<span class="token punctuation">;</span>：

这个指令设置了用于存储从上游服务器接收到的响应的缓冲区的数量和大小。在这里设置为 <span class="token number">16</span> 个缓冲区，每个缓冲区大小为 <span class="token number">1024</span>KB。
proxy_busy_buffers_size <span class="token number">2048</span>k<span class="token punctuation">;</span>：

这个指令设置了 <span class="token class-name">Nginx</span> 在处理响应时，可以使用的缓冲区的最大大小。在这里设置为 <span class="token number">2048</span>KB，即 <span class="token number">2</span>MB。
proxy_temp_file_write_size <span class="token number">2048</span>k<span class="token punctuation">;</span>：

这个指令设置了临时文件的大小，用于存储从上游服务器接收到的响应，如果响应不能完全放入缓冲区中。在这里设置为 <span class="token number">2048</span>KB，即 <span class="token number">2</span>MB。
这些配置主要用于在 <span class="token class-name">Nginx</span> 作为代理服务器时设置请求头和响应缓冲区，以优化代理性能和保证正确的客户端 IP 地址传递。
</code></pre></div><h2 id="nginx-配置"><a href="#nginx-配置" class="header-anchor">#</a> Nginx 配置</h2> <h3 id="设置请求报文大小"><a href="#设置请求报文大小" class="header-anchor">#</a> 设置请求报文大小</h3> <ul><li>设置请求报文大小</li> <li>相对于上次的文件大小</li> <li>参考地址: https://developer.aliyun.com/article/897958</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>可以选择在http<span class="token punctuation">{</span> <span class="token punctuation">}</span>中设置：client_max_body_size <span class="token number">20</span>m<span class="token punctuation">;</span>
也可以选择在server<span class="token punctuation">{</span> <span class="token punctuation">}</span>中设置：client_max_body_size <span class="token number">20</span>m<span class="token punctuation">;</span>
还可以选择在location<span class="token punctuation">{</span> <span class="token punctuation">}</span>中设置：client_max_body_size <span class="token number">20</span>m<span class="token punctuation">;</span>
<span class="token comment">// 三者有区别</span>
设置到http<span class="token punctuation">{</span><span class="token punctuation">}</span>内，控制全局nginx所有请求报文大小
设置到server<span class="token punctuation">{</span><span class="token punctuation">}</span>内，控制该server的所有请求报文大小
设置到location<span class="token punctuation">{</span><span class="token punctuation">}</span>内，控制满足该路由规则的请求报文大小
</code></pre></div><h2 id="nginx-搭建文件服务器"><a href="#nginx-搭建文件服务器" class="header-anchor">#</a> Nginx 搭建文件服务器</h2> <h3 id="修改配置-2"><a href="#修改配置-2" class="header-anchor">#</a> 修改配置</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span> 
        location / <span class="token punctuation">{</span>
	    root   /opt/soft/<span class="token punctuation">;</span> <span class="token comment">#可以在这个目录放置一些软件包，供别人下载</span>
	    autoindex on<span class="token punctuation">;</span>             <span class="token comment">#开启索引功能  这句话很重要</span>
        autoindex_exact_size off<span class="token punctuation">;</span> <span class="token comment"># 关闭计算文件确切大小（单位bytes），只显示大概大小（单位kb、mb、gb）</span>
        autoindex_localtime on<span class="token punctuation">;</span>   <span class="token comment"># 显示本机时间而非 GMT 时间</span>
        charset utf-8<span class="token punctuation">;</span> <span class="token comment"># 避免中文乱码 </span>
        <span class="token comment"># root html;</span>
        <span class="token comment"># index  index.html index.htm;</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
</code></pre></div><h3 id="访问"><a href="#访问" class="header-anchor">#</a> 访问</h3> <ul><li>直接通过 IP + 端口 访问</li> <li>可以直接存储文件 IP + 端口 + 文件名 下载等</li> <li>如果安装本地 在局域网的其他人可实现共享文件的功能</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="pager"><a href="/Welcome/post/2021/02/11/elasticsearch-%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/" class="next">
    下一篇<br> <span>
      ElasticSearch 搜索引擎
    </span></a> <a href="/Welcome/post/2021/01/10/rabbitmq-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" class="previous">
    上一篇<br> <span>
      RabbitMQ 消息队列
    </span></a></div> <!----></main> <ul class="catalog" style="top:0px !important;" data-v-86932056><li class="level-2 toc-link-nginx-反向代理" data-v-86932056>Nginx 反向代理</li><li class="level-3 toc-link-nginx-代理" data-v-86932056>Nginx 代理</li><li class="level-3 toc-link-nginx-反向代理-案例" data-v-86932056>Nginx  反向代理 案例:</li><li class="level-2 toc-link-nginx-window版" data-v-86932056>Nginx  Window版</li><li class="level-3 toc-link-启动-nginx" data-v-86932056>启动 Nginx</li><li class="level-3 toc-link-关闭-nginx" data-v-86932056>关闭 Nginx</li><li class="level-2 toc-link-nginx-linux版" data-v-86932056>Nginx linux版</li><li class="level-3 toc-link-nginx-环境依赖" data-v-86932056>Nginx 环境依赖</li><li class="level-3 toc-link-nginx-安装步骤" data-v-86932056>Nginx 安装步骤</li><li class="level-3 toc-link-启动-nginx-2" data-v-86932056>启动 Nginx</li><li class="level-3 toc-link-访问-nginx" data-v-86932056>访问 Nginx</li><li class="level-2 toc-link-nginx-配置文件" data-v-86932056>Nginx 配置文件</li><li class="level-3 toc-link-全局块" data-v-86932056>全局块</li><li class="level-3 toc-link-events块" data-v-86932056>events块</li><li class="level-3 toc-link-http块" data-v-86932056>http块</li><li class="level-3 toc-link-server块" data-v-86932056>server块</li><li class="level-3 toc-link-location块" data-v-86932056>location块</li><li class="level-2 toc-link-nginx-配置虚拟主机" data-v-86932056>Nginx 配置虚拟主机</li><li class="level-3 toc-link-通过端口区分不同虚拟机" data-v-86932056>通过端口区分不同虚拟机</li><li class="level-4 toc-link-打开nginx的配置文件" data-v-86932056>打开Nginx的配置文件</li><li class="level-4 toc-link-重新加载配置文件" data-v-86932056>重新加载配置文件</li><li class="level-3 toc-link-通过域名区分虚拟主机" data-v-86932056>通过域名区分虚拟主机</li><li class="level-4 toc-link-什么是域名" data-v-86932056>什么是域名</li><li class="level-4 toc-link-nginx的配置" data-v-86932056>Nginx的配置</li><li class="level-2 toc-link-nginx-负载均衡" data-v-86932056>Nginx  负载均衡</li><li class="level-3 toc-link-负载均衡的配置" data-v-86932056>负载均衡的配置</li><li class="level-3 toc-link-准备工作" data-v-86932056>准备工作</li><li class="level-3 toc-link-负载方式" data-v-86932056>负载方式</li><li class="level-4 toc-link-_1-轮询" data-v-86932056>1.轮询</li><li class="level-4 toc-link-_2-加权轮询" data-v-86932056>2.加权轮询</li><li class="level-4 toc-link-_3-ip-hash-负载" data-v-86932056>3.ip_hash 负载</li><li class="level-3 toc-link-浏览器ip传递到后台" data-v-86932056>浏览器IP传递到后台</li><li class="level-3 toc-link-nginx-解决前后端跨域" data-v-86932056>Nginx 解决前后端跨域</li><li class="level-2 toc-link-nginx-docker-部署" data-v-86932056>Nginx Docker 部署</li><li class="level-3 toc-link-创建docker容器" data-v-86932056>创建Docker容器</li><li class="level-3 toc-link-修改配置" data-v-86932056>修改配置</li><li class="level-4 toc-link-nginx-配置文件路径" data-v-86932056>Nginx 配置文件路径</li><li class="level-4 toc-link-nginx-conf-详解" data-v-86932056>nginx.conf 详解</li><li class="level-4 toc-link-default-conf-详解" data-v-86932056>default.conf 详解</li><li class="level-4 toc-link-vue-websocket-配置" data-v-86932056>Vue WebSocket 配置</li><li class="level-3 toc-link-放入项目包" data-v-86932056>放入项目包</li><li class="level-3 toc-link-参考副本" data-v-86932056>参考副本</li><li class="level-2 toc-link-nginx-配置" data-v-86932056>Nginx 配置</li><li class="level-3 toc-link-设置请求报文大小" data-v-86932056>设置请求报文大小</li><li class="level-2 toc-link-nginx-搭建文件服务器" data-v-86932056>Nginx 搭建文件服务器</li><li class="level-3 toc-link-修改配置-2" data-v-86932056>修改配置</li><li class="level-3 toc-link-访问" data-v-86932056>访问</li></ul></div> <div class="search-page" data-v-60b9a85e><span class="search-close"><svg aria-hidden="true" width="34.56" height="34.56" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:2.16em;"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></span> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="menu-btn-container" data-v-413dbfb4 data-v-60b9a85e><div class="menu-btn-wrapper" data-v-413dbfb4><div class="menu-btn" data-v-413dbfb4><div class="menu-btn-icon" style="display:;" data-v-413dbfb4><span data-v-413dbfb4></span> <span data-v-413dbfb4></span> <span data-v-413dbfb4></span></div> <div class="menu-text" style="display:none;" data-v-413dbfb4>
        0
      </div> <svg class="menu-svg" data-v-413dbfb4><circle cx="50%" cy="50%" r="48%" class="menu-border" style="stroke-dasharray:0% 314.15926%;" data-v-413dbfb4></circle></svg></div> <div class="menu-btn-child-wrapper" data-v-413dbfb4><a role="button" aria-label="Toggle light" title="Toggle light" class="toggle-mode menu-btn-child" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></a> <div class="menu-btn-child" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div> <div class="menu-btn-child" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div> <div class="menu-btn-child menu-toc-btn" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div> <div class="menu-btn-child menu-btn-sidebar" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div> <div class="footer-wrapper footer" data-v-2f609db5 data-v-60b9a85e><span data-v-2f609db5>
      &copy; <a href="https://lujunandapai.github.io/" target="_blank">是阿派啊! </a> 2000 - 2024
      <br>
      祝我们 - <a href="https://gitee.com/LuisApai" target="_blank">平安喜乐</a> &
      <a href="https://github.com/LuJunandapai" target="_blank">万事顺遂</a>
    </span></div></div><div class="global-ui"></div></div>
    <script src="/Welcome/assets/js/app.516fe79a.js" defer></script><script src="/Welcome/assets/js/8.d7055a2e.js" defer></script><script src="/Welcome/assets/js/1.ed48a7ee.js" defer></script><script src="/Welcome/assets/js/2.9a3f7cc9.js" defer></script><script src="/Welcome/assets/js/76.3613c476.js" defer></script>
  </body>
</html>
