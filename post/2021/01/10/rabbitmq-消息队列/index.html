<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ æ¶ˆæ¯é˜Ÿåˆ— | é™¤éä¸–ç•Œé¢ å€’</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/Welcome/img/logo.svg">
    <meta name="description" content="èƒèŸ¹ä¸èƒ½å‰¥æˆ‘çš„å£³ï¼Œç¬”è®°æœ¬ä¸å¯èƒ½åœ¨å†™æˆ‘ï¼Œæˆ‘ä¸å¯èƒ½è½åœ¨æ«å¶ä¸Šé›ªèŠ±ä¸Šï¼Œè€Œä½ ä¸å¯èƒ½æƒ³æˆ‘ ...">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/Welcome/assets/css/0.styles.dc2e030a.css" as="style"><link rel="preload" href="/Welcome/assets/js/app.e8bc5df0.js" as="script"><link rel="preload" href="/Welcome/assets/js/8.d7055a2e.js" as="script"><link rel="preload" href="/Welcome/assets/js/1.ed48a7ee.js" as="script"><link rel="preload" href="/Welcome/assets/js/2.9a3f7cc9.js" as="script"><link rel="preload" href="/Welcome/assets/js/53.a4f3a63f.js" as="script"><link rel="prefetch" href="/Welcome/assets/js/10.4c48ef06.js"><link rel="prefetch" href="/Welcome/assets/js/11.619e1f41.js"><link rel="prefetch" href="/Welcome/assets/js/12.fb12f646.js"><link rel="prefetch" href="/Welcome/assets/js/13.cbffec13.js"><link rel="prefetch" href="/Welcome/assets/js/14.b6f5f3af.js"><link rel="prefetch" href="/Welcome/assets/js/15.2b6b3813.js"><link rel="prefetch" href="/Welcome/assets/js/16.c25cd06e.js"><link rel="prefetch" href="/Welcome/assets/js/17.741abdae.js"><link rel="prefetch" href="/Welcome/assets/js/18.1857465f.js"><link rel="prefetch" href="/Welcome/assets/js/19.e7b2182d.js"><link rel="prefetch" href="/Welcome/assets/js/20.c46f9d92.js"><link rel="prefetch" href="/Welcome/assets/js/21.c2766c95.js"><link rel="prefetch" href="/Welcome/assets/js/22.82fce2f4.js"><link rel="prefetch" href="/Welcome/assets/js/23.22112d8e.js"><link rel="prefetch" href="/Welcome/assets/js/24.8c2202b2.js"><link rel="prefetch" href="/Welcome/assets/js/25.b3249194.js"><link rel="prefetch" href="/Welcome/assets/js/26.7c4f2165.js"><link rel="prefetch" href="/Welcome/assets/js/27.3d6b05e9.js"><link rel="prefetch" href="/Welcome/assets/js/28.fe697630.js"><link rel="prefetch" href="/Welcome/assets/js/29.0406e15c.js"><link rel="prefetch" href="/Welcome/assets/js/30.f0f201a1.js"><link rel="prefetch" href="/Welcome/assets/js/31.4053195b.js"><link rel="prefetch" href="/Welcome/assets/js/32.5f975a79.js"><link rel="prefetch" href="/Welcome/assets/js/33.7562e8e6.js"><link rel="prefetch" href="/Welcome/assets/js/34.f6c69931.js"><link rel="prefetch" href="/Welcome/assets/js/35.be505946.js"><link rel="prefetch" href="/Welcome/assets/js/36.ab297cfb.js"><link rel="prefetch" href="/Welcome/assets/js/37.c952dbf2.js"><link rel="prefetch" href="/Welcome/assets/js/38.a0051e15.js"><link rel="prefetch" href="/Welcome/assets/js/39.b2af4395.js"><link rel="prefetch" href="/Welcome/assets/js/4.ffe2048e.js"><link rel="prefetch" href="/Welcome/assets/js/40.2fe9f945.js"><link rel="prefetch" href="/Welcome/assets/js/41.0ae8523d.js"><link rel="prefetch" href="/Welcome/assets/js/42.416e3c19.js"><link rel="prefetch" href="/Welcome/assets/js/43.d924e89c.js"><link rel="prefetch" href="/Welcome/assets/js/44.d90cf605.js"><link rel="prefetch" href="/Welcome/assets/js/45.06a7f7fd.js"><link rel="prefetch" href="/Welcome/assets/js/46.722536b8.js"><link rel="prefetch" href="/Welcome/assets/js/47.5f8b0915.js"><link rel="prefetch" href="/Welcome/assets/js/48.413199b8.js"><link rel="prefetch" href="/Welcome/assets/js/49.72350747.js"><link rel="prefetch" href="/Welcome/assets/js/5.2488397c.js"><link rel="prefetch" href="/Welcome/assets/js/50.1a36553e.js"><link rel="prefetch" href="/Welcome/assets/js/51.0f7ac807.js"><link rel="prefetch" href="/Welcome/assets/js/52.d8f87041.js"><link rel="prefetch" href="/Welcome/assets/js/54.08cf2058.js"><link rel="prefetch" href="/Welcome/assets/js/55.f8328f91.js"><link rel="prefetch" href="/Welcome/assets/js/56.da6b1ee6.js"><link rel="prefetch" href="/Welcome/assets/js/57.5678d35a.js"><link rel="prefetch" href="/Welcome/assets/js/58.d6c5e361.js"><link rel="prefetch" href="/Welcome/assets/js/6.c8f2a0bc.js"><link rel="prefetch" href="/Welcome/assets/js/7.72ca8d8f.js"><link rel="prefetch" href="/Welcome/assets/js/9.73227006.js">
    <link rel="stylesheet" href="/Welcome/assets/css/0.styles.dc2e030a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="theme-container" class="theme-container post-container no-sidebar" data-v-60b9a85e><header class="navbar invert" data-v-60b9a85e><a href="/Welcome/" class="home-link router-link-active"><span class="site-name"> $ cd /home/ </span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/Welcome/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M489.2 287.9h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6V146.2c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-6-8-4.6-11.7-4.6v-38c8.3-2 17.1-3.4 25.7-3.4 10.9 0 20.9 4.3 31.4 4.3 4.6 0 27.7-1.1 27.7-8v-60c0-2.6-2-4.6-4.6-4.6-5.1 0-15.1 4.3-24 4.3-9.7 0-20.9-4.3-32.6-4.3-8 0-16 1.1-23.7 2.9v-4.9c5.4-2.6 9.1-8.3 9.1-14.3 0-20.7-31.4-20.8-31.4 0 0 6 3.7 11.7 9.1 14.3v111.7c-3.7 0-11.7-1.4-11.7 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32H128v-32c0-2.6-2-4.6-4.6-4.6H96c-2.6 0-4.6 2-4.6 4.6v178.3H54.8v-32c0-2.6-2-4.6-4.6-4.6H22.8c-2.6 0-4.6 2-4.6 4.6V512h182.9v-96c0-72.6 109.7-72.6 109.7 0v96h182.9V292.5c.1-2.6-1.9-4.6-4.5-4.6zm-288.1-4.5c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64zm146.4 0c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64z"/></svg>
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/Welcome/tags/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>
  æ ‡ç­¾ ğŸ·ï¸
</a></div><div class="nav-item"><a href="/Welcome/links/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg>
  é“¾æ¥ ğŸŒ
</a></div><div class="nav-item"><a href="/Welcome/docs/aboutMe/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M21 18H6a1 1 0 000 2h15v2H6a3 3 0 01-3-3V4a2 2 0 012-2h16v16zm-5-9V7H8v2h8z"/></svg>
  ä¸¾æ¯ â¤
</a></div> <div class="nav-item"><a class="nav-link ov-parent ov-hover" style="cursor: pointer"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg>
      æœç´¢
    </a></div></nav></div></header> <div class="sidebar-mask" data-v-60b9a85e></div> <aside class="sidebar" data-v-60b9a85e><div class="personal-info-wrapper" data-v-60b9a85e><div class="mobile-hero-avatar" data-v-60b9a85e><img src="/Welcome/img/avatar.jpeg" alt="hero" data-v-60b9a85e></div> <p class="mobile-heading" data-v-60b9a85e>
          æ«å¶å’Œé›ªèŠ±
        </p> <div class="sns-wrapper" data-v-60b9a85e><a href="https://github.com/LuJunandapai" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-59.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></svg></a><a href="https://www.zhihu.com/people/you-ren-a-21-4" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.344 17.963l-1.688 1.074-2.131-3.35c-.44 1.402-1.172 2.665-2.139 3.825-.402.483-.82.918-1.301 1.375-.155.147-.775.717-.878.82l-1.414-1.414c.139-.139.787-.735.915-.856.43-.408.795-.79 1.142-1.206 1.266-1.518 2.03-3.21 2.137-5.231H3v-2h4V7h-.868c-.689 1.266-1.558 2.222-2.618 2.857L2.486 8.143c1.395-.838 2.425-2.604 3.038-5.36l1.952.434c-.14.633-.303 1.227-.489 1.783H11.5v2H9v4h2.5v2H9.185l3.159 4.963zm3.838-.07L17.298 17H19V7h-4v10h.736l.446.893zM13 5h8v14h-3l-2.5 2-1-2H13V5z"/></svg></svg></a><a href="mailto:lu_yuelian@163.com" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></svg></a>  <a href="/rss.xml" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="0" height="0" viewBox="0 0 0 0" fill="currentColor" class="icon-stack ov-icon" style="font-size:1.2em;"><!----> <svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="icon-sns ov-icon ov-inverse" style="font-size:1.2em;"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></svg></a></div> <hr data-v-60b9a85e></div> <nav class="nav-links"><div class="nav-item"><a href="/Welcome/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M489.2 287.9h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6V146.2c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32h-36.6v-32c0-6-8-4.6-11.7-4.6v-38c8.3-2 17.1-3.4 25.7-3.4 10.9 0 20.9 4.3 31.4 4.3 4.6 0 27.7-1.1 27.7-8v-60c0-2.6-2-4.6-4.6-4.6-5.1 0-15.1 4.3-24 4.3-9.7 0-20.9-4.3-32.6-4.3-8 0-16 1.1-23.7 2.9v-4.9c5.4-2.6 9.1-8.3 9.1-14.3 0-20.7-31.4-20.8-31.4 0 0 6 3.7 11.7 9.1 14.3v111.7c-3.7 0-11.7-1.4-11.7 4.6v32h-36.6v-32c0-2.6-2-4.6-4.6-4.6h-27.4c-2.6 0-4.6 2-4.6 4.6v32H128v-32c0-2.6-2-4.6-4.6-4.6H96c-2.6 0-4.6 2-4.6 4.6v178.3H54.8v-32c0-2.6-2-4.6-4.6-4.6H22.8c-2.6 0-4.6 2-4.6 4.6V512h182.9v-96c0-72.6 109.7-72.6 109.7 0v96h182.9V292.5c.1-2.6-1.9-4.6-4.5-4.6zm-288.1-4.5c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64zm146.4 0c0 2.6-2 4.6-4.6 4.6h-27.4c-2.6 0-4.6-2-4.6-4.6v-64c0-2.6 2-4.6 4.6-4.6h27.4c2.6 0 4.6 2 4.6 4.6v64z"/></svg>
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/Welcome/tags/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>
  æ ‡ç­¾ ğŸ·ï¸
</a></div><div class="nav-item"><a href="/Welcome/links/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg>
  é“¾æ¥ ğŸŒ
</a></div><div class="nav-item"><a href="/Welcome/docs/aboutMe/" class="nav-link ov-parent ov-hover"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M21 18H6a1 1 0 000 2h15v2H6a3 3 0 01-3-3V4a2 2 0 012-2h16v16zm-5-9V7H8v2h8z"/></svg>
  ä¸¾æ¯ â¤
</a></div> <div class="nav-item"><a class="nav-link ov-parent ov-hover" style="cursor: pointer"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon ov-wrench ov-hover" style="font-size:1.2em;"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg>
      æœç´¢
    </a></div></nav> <!----> </aside> <div class="content" data-v-60b9a85e><div class="post-header style-img" style="background-image:url(/Welcome/img/in-post/2020-10-29/header.jpg);" data-v-2c97064e><div class="header-mask" style="background:rgba(40, 57, 101, .4);" data-v-2c97064e></div> <div class="header-content" data-v-2c97064e><div class="tags" data-v-2c97064e><span class="tag" data-v-2c97064e>
        Linux
      </span><span class="tag" data-v-2c97064e>
        ä¸­é—´ä»¶
      </span></div> <h1 class="title" data-v-2c97064e>
      RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—
    </h1> <h3 class="subtitle" data-v-2c97064e>
      MQå…¨ç§°ä¸ºMessage Queueï¼Œåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹æ³•ã€‚æ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ã€‚å¤šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œè¿›è¡Œå¼‚æ­¥å¤„ç†çš„æ–¹å¼å¤§å¤§çš„èŠ‚çœäº†æœåŠ¡å™¨çš„è¯·æ±‚å“åº”æ—¶é—´
    </h3> <div class="icons" data-v-2c97064e><div class="icon" data-v-2c97064e><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-2c97064e><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg> <span data-v-2c97064e>Lu Da Zhuang</span></div> <div class="icon" data-v-2c97064e><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-2c97064e><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg> <span data-v-2c97064e>2021-01-10</span></div> <div class="icon" data-v-2c97064e><svg aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-2c97064e><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg> <span data-v-2c97064e>73 min</span></div></div></div></div> <main class="page"><!----> <div class="theme-content content__default"><h2 id="rabbitmq-æ¶ˆæ¯é˜Ÿåˆ—å®‰è£…"><a href="#rabbitmq-æ¶ˆæ¯é˜Ÿåˆ—å®‰è£…" class="header-anchor">#</a> RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—å®‰è£…</h2> <blockquote><p>è¯¦è§: javaå¼€å‘å·¥å…·å®‰è£…æ  | java è¡¥å……è®°</p></blockquote> <h3 id="rabbitmq-serveræœåŠ¡å¯åŠ¨"><a href="#rabbitmq-serveræœåŠ¡å¯åŠ¨" class="header-anchor">#</a> rabbitmq-serveræœåŠ¡å¯åŠ¨</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// æŸ¥çœ‹è¿›ç¨‹ ç«¯å£ä¿¡æ¯</span>
netstat <span class="token operator">-</span>tlnp
<span class="token comment">// æ ¹æ®ç«¯å£ å…³é—­è¿›ç¨‹</span>
kill <span class="token operator">-</span><span class="token number">9</span> ç«¯å£å·
<span class="token comment">// å…³é—­é˜²ç«å¢™</span>
systemctl stop firewalld<span class="token punctuation">.</span>service

<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>#service rabbitmq<span class="token operator">-</span>server start ## å¯åŠ¨æœåŠ¡
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>#service rabbitmq<span class="token operator">-</span>server stop ## åœæ­¢æœåŠ¡
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>#service rabbitmq<span class="token operator">-</span>server restart ## é‡å¯æœåŠ¡
    
<span class="token comment">// å‰ç«¯ç½‘é¡µ</span>
http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.174</span><span class="token number">.133</span><span class="token operator">:</span><span class="token number">15672</span>
</code></pre></div><h3 id="æ¶ˆæ¯ä¸­é—´ä»¶-ç®€ä»‹"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶-ç®€ä»‹" class="header-anchor">#</a> æ¶ˆæ¯ä¸­é—´ä»¶ - ç®€ä»‹</h3> <p>MQå…¨ç§°ä¸ºMessage Queueï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯åº”ç”¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹æ³•ã€‚æ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ã€‚å¤šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œå¯å°†ä¸€äº›æ— éœ€å³æ—¶è¿”å›ä¸”è€—æ—¶çš„æ“ä½œæå–å‡ºæ¥ï¼Œè¿›è¡Œ<strong>å¼‚æ­¥å¤„ç†</strong>ï¼Œè€Œè¿™ç§å¼‚æ­¥å¤„ç†çš„æ–¹å¼å¤§å¤§çš„èŠ‚çœäº†æœåŠ¡å™¨çš„è¯·æ±‚å“åº”æ—¶é—´ï¼Œä»è€Œ<strong>æé«˜</strong>äº†<strong>ç³»ç»Ÿ</strong>çš„<strong>ååé‡</strong></p> <p><strong>ä¼˜åŠ¿:</strong></p> <p>1.ä»»åŠ¡å¼‚æ­¥å¤„ç†</p> <blockquote><p>åŒæ­¥æ–¹å¼ï¼šå°†ä¸éœ€è¦åŒæ­¥å¤„ç†çš„å¹¶ä¸”è€—æ—¶é•¿çš„æ“ä½œç”±æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥æ¶ˆæ¯æ¥æ”¶æ–¹è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚æé«˜äº†åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´ã€‚</p></blockquote> <p>2.åº”ç”¨ç¨‹åºè§£è€¦åˆ</p> <blockquote><p>MQç›¸å½“äºä¸€ä¸ªä¸­ä»‹ï¼Œç”Ÿäº§æ–¹é€šè¿‡MQä¸æ¶ˆè´¹æ–¹äº¤äº’ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºè¿›è¡Œè§£è€¦åˆã€‚ç³»ç»Ÿçš„è€¦åˆæ€§è¶Šé«˜ï¼Œå®¹é”™æ€§å°±è¶Šä½ï¼Œå¯ç»´æŠ¤æ€§å°±è¶Šä½</p> <p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ï¼šä½¿ç”¨ MQ ä½¿å¾—åº”ç”¨é—´è§£è€¦ï¼Œæå‡å®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åº“å­˜å’Œæ”¯ä»˜å’Œç‰©æµç›´æ¥å»MQå–åˆ°è®¢å•çš„ä¿¡æ¯å³å¯ï¼Œå³ä½¿åº“å­˜ç³»ç»ŸæŠ¥é”™ï¼Œæ²¡å…³ç³»ï¼Œç­‰åˆ°åº“å­˜ä¿®å¤åå†æ¬¡ä»MQä¸­å»å–å°±å¯ä»¥äº†</p></blockquote> <p>3.å‰Šå³°å¡«è°·</p> <blockquote><p>å¦‚è®¢å•ç³»ç»Ÿï¼Œåœ¨ä¸‹å•çš„æ—¶å€™å°±ä¼šå¾€æ•°æ®åº“å†™æ•°æ®ã€‚ä½†æ˜¯æ•°æ®åº“åªèƒ½æ”¯æ’‘æ¯ç§’1000å·¦å³çš„å¹¶å‘å†™å…¥ï¼Œå¹¶å‘é‡å†é«˜å°±å®¹æ˜“å®•æœºã€‚ä½å³°æœŸçš„æ—¶å€™å¹¶å‘ä¹Ÿå°±100å¤šä¸ªï¼Œä½†æ˜¯åœ¨é«˜å³°æœŸæ—¶å€™ï¼Œå¹¶å‘é‡ä¼šçªç„¶æ¿€å¢åˆ°5000ä»¥ä¸Šï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åº“è‚¯å®šå¡æ­»äº†ã€‚ä½†ä¸ä¸€å®šå®•æœºï¼Œåªä¼šå¾ˆæ…¢ï¼Œä¸€æ—¦å®•æœºå°±ä¼šæœ‰æ¶ˆæ¯ä¸¢å¤±ï¼Œ</p></blockquote> <p><strong>åŠ£åŠ¿:</strong></p> <p>1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼šç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ã€‚ä¸€æ—¦ MQ å®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨ï¼Ÿ</p> <p>2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜ï¼šMQ çš„åŠ å…¥å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä»¥å‰ç³»ç»Ÿé—´æ˜¯åŒæ­¥çš„è¿œç¨‹è°ƒç”¨ï¼Œç°åœ¨æ˜¯é€šè¿‡ MQ è¿›è¡Œå¼‚æ­¥è°ƒç”¨ã€‚å¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰è¢«é‡å¤æ¶ˆè´¹ï¼Ÿæ€ä¹ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±æƒ…å†µï¼Ÿé‚£ä¹ˆä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿ</p> <p>3ã€ä¸€è‡´æ€§é—®é¢˜ï¼šA ç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡ MQ ç»™Bã€Cã€Dä¸‰ä¸ªç³»ç»Ÿå‘æ¶ˆæ¯æ•°æ®ï¼Œå¦‚æœ B ç³»ç»Ÿã€C ç³»ç»Ÿå¤„ç†æˆåŠŸï¼ŒD ç³»ç»Ÿå¤„ç†å¤±è´¥ã€‚å¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§ï¼Ÿ</p> <p><strong>æ—¢ç„¶ MQ æœ‰ä¼˜åŠ¿ä¹Ÿæœ‰åŠ£åŠ¿ï¼Œé‚£ä¹ˆä½¿ç”¨ MQ éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å‘¢ï¼Ÿ</strong></p> <blockquote><p>ç”Ÿäº§è€…ä¸éœ€è¦ä»æ¶ˆè´¹è€…å¤„è·å¾—åé¦ˆã€‚å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰çš„ç›´æ¥è°ƒç”¨ï¼Œå…¶æ¥å£çš„è¿”å›å€¼åº”è¯¥ä¸ºç©ºï¼Œè¿™æ‰è®©æ˜æ˜ä¸‹å±‚çš„åŠ¨ä½œè¿˜æ²¡åšï¼Œä¸Šå±‚å´å½“æˆåŠ¨ä½œåšå®Œäº†ç»§ç»­å¾€åèµ°ï¼Œå³æ‰€è°“å¼‚æ­¥æˆä¸ºäº†å¯èƒ½ã€‚
å®¹è®¸çŸ­æš‚çš„ä¸ä¸€è‡´æ€§ã€‚
ç¡®å®æ˜¯ç”¨äº†æœ‰æ•ˆæœã€‚å³è§£è€¦ã€æé€Ÿã€å‰Šå³°è¿™äº›æ–¹é¢çš„æ”¶ç›Šï¼Œè¶…è¿‡åŠ å…¥MQï¼Œç®¡ç†MQè¿™äº›æˆæœ¬ã€‚</p></blockquote> <h3 id="rabbitmq-å¿«é€Ÿå…¥é—¨"><a href="#rabbitmq-å¿«é€Ÿå…¥é—¨" class="header-anchor">#</a> RabbitMQ å¿«é€Ÿå…¥é—¨</h3> <p>1ã€æ·»åŠ ä¾èµ–</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--rabbitmq java å®¢æˆ·ç«¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>2ã€åˆ›å»ºç”Ÿäº§æ–¹</p> <p>åˆ›å»ºé˜Ÿåˆ—queueDeclareï¼ˆï¼‰å‚æ•°è¯´æ˜ï¼š</p> <table><thead><tr><th style="text-align:left;">å‚æ•°</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">queue</td> <td style="text-align:left;">å­—ç¬¦ä¸²å€¼ï¼Œqueue çš„åç§°ã€‚</td></tr> <tr><td style="text-align:left;">durable</td> <td style="text-align:left;">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ queue æ˜¯å¦æŒä¹…åŒ–ã€‚ å®ƒå†³å®šäº†å½“ RabbitMQ é‡å¯åï¼Œä½ æ˜¯å¦è¿˜èƒ½ â€œçœ‹åˆ°â€ é‡å¯å‰åˆ›å»ºçš„ queue ã€‚ å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œqueue çš„æŒä¹…åŒ–ä¸ç­‰äºå…¶ä¸­çš„æ¶ˆæ¯ä¹Ÿä¼šè¢«æŒä¹…åŒ–ã€‚</td></tr> <tr><td style="text-align:left;">exclusive</td> <td style="text-align:left;">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ queue æ˜¯å¦æ’å®ƒå¼ä½¿ç”¨ã€‚æ’å®ƒå¼ä½¿ç”¨æ„å‘³ç€ä»…å£°æ˜ä»–çš„è¿æ¥å¯è§/å¯ç”¨ï¼Œå…¶å®ƒè¿æ¥ä¸å¯è§/ä¸å¯ç”¨ã€‚å³ä¸€ä¸ªé˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜ä»–å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¿…é¡»æ˜¯åŒä¸€ä¸ªconnection</td></tr> <tr><td style="text-align:left;">autoDelete</td> <td style="text-align:left;">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“è¯¥ queue æ²¡â€œäººâ€ï¼ˆconnectionï¼‰ç”¨æ—¶ï¼Œæ˜¯å¦ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ å³ï¼Œå®ç°é€»è¾‘ä¸Šçš„ä¸´æ—¶é˜Ÿåˆ—ã€‚é¡¹ç›®å¯åŠ¨æ—¶è¿æ¥åˆ° RabbitMQ ï¼Œåˆ›å»ºé˜Ÿåˆ—ï¼›é¡¹ç›®åœæ­¢æ—¶æ–­å¼€è¿æ¥ï¼ŒRabbitMQ è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—ã€‚</td></tr> <tr><td style="text-align:left;">arguments</td> <td style="text-align:left;">å…¶å®ƒå‚æ•° ï¼Œå¦‚æ¶ˆæ¯è¿‡æœŸæ—¶é—´x-message-ttlç­‰</td></tr></tbody></table> <p>å‘å¸ƒæ¶ˆæ¯basicPublishï¼ˆï¼‰å‚æ•°è¯´æ˜ï¼š</p> <table><thead><tr><th style="text-align:left;">å‚æ•°</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">exchange</td> <td style="text-align:left;">å­—ç¬¦ä¸²å€¼ï¼Œäº¤æ¢æœºçš„åç§°ã€‚ç®€å•æ¨¡å¼ä¸‹äº¤æ¢æœºä¼šä½¿ç”¨é»˜è®¤çš„ï¼Œé»˜è®¤æ˜¯ â€œâ€</td></tr> <tr><td style="text-align:left;">routingKey</td> <td style="text-align:left;">è·¯ç”±åç§°ï¼Œå¦‚æœäº¤æ¢æœºé‡‡ç”¨é»˜è®¤çš„ â€œ â€ é‚£ä¹ˆroutingKeyè¦å’Œé˜Ÿåˆ—åå­—ä¿æŒä¸€æ ·</td></tr> <tr><td style="text-align:left;">props</td> <td style="text-align:left;">æ¶ˆæ¯å±æ€§ï¼Œå¦‚æ¶ˆæ¯å†…å®¹ç¼–ç ï¼Œæ¶ˆæ¯æŠ•é€’æ¨¡å¼deliveryModeï¼ˆ1è¡¨ç¤ºä¸æŒä¹…åŒ–ï¼Œ2è¡¨ç¤ºæŒä¹…åŒ–ï¼‰æ¶ˆæ¯è¿‡æœŸæ—¶é—´æ¯«ç§’ç­‰</td></tr> <tr><td style="text-align:left;">body</td> <td style="text-align:left;">æ¶ˆæ¯å†…å®¹</td></tr></tbody></table> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMqProducerApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºè¿æ¥å·¥ç¨‹</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2ã€è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.174.131&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è™šæ‹Ÿæœº é»˜è®¤å€¼ '/'</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç«¯å£  é»˜è®¤å€¼ 5672</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨æˆ·å é»˜è®¤ guest</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯†ç  é»˜è®¤å€¼ guest</span>

        <span class="token comment">// 3. åˆ›å»ºè¿æ¥ Connection å¯¹è±¡</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. åˆ›å»º Channel ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5.åˆ›å»ºé˜Ÿåˆ—ï¼šå¦‚æœæ²¡æœ‰åå­—çš„é˜Ÿåˆ—ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å°±ä¸ä¼šåˆ›å»º</span>
        <span class="token comment">/**
         * queveDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete r Map&lt;Stringï¼Œ0bject&gt; arguments)
         * å‚æ•°è¯´æ˜:
         *  queue é˜Ÿåˆ—åå®
         *  durable .è¿™ä¸ªé˜Ÿåˆ—æ˜¯å¦æœ‰æŒä¹…åŒ–ï¼Œä¸æ˜¯é˜Ÿåˆ—çš„æ•°æ®æ˜¯å¦æŒä¹…åŒ– trueè¡¨ç¤ºè¦æŒä¹…åŒ–
         *  exclusiveè¿™ä¸ªæ˜¯å¦å°¼ç‹¬å é˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€… trueè¡¨ç¤ºæ˜¯ç‹¬å é˜Ÿåˆ—
         *  autoDeleteè¿™ä¸ªä»¥åˆ—å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼Œä¼šä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œtrue å°±æ˜¯è‡ªåŠ¨åˆ é™¤
         *  arguments_ä»åˆ°çš„å±æ€§(.è¿™ä¸ªMåˆ—çš„æ•°æ®è¦ä¸è¦æŒä¹…åŒ–ï¼Œè¿™ä¸ªé£åˆ—çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´æ˜¯è€ä¹…ï¼Œè§„å®šè¿™ä¸ªé˜Ÿåˆ—åªèƒ½æ”¾å¤šå°‘æ¡æ•°æ®)
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;paidaxingxing&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6.å‘é€æ•°æ®</span>
        <span class="token comment">/**
         * basicPublish(String exchange, String routingKey, BasicProperties props, byte[] body)
         * å‚æ•°è¯´æ˜:
         *  exchange äº¤æ¢æœºçš„åå­—ï¼Œ å› ä¸ºæ¶ˆæ¯æ˜¯å…ˆå‘ç»™äº¤æ¢æœºï¼Œç„¶ååœ¨ç”±äº¤æ¢æœºè·¯ç”±åˆºAå‰‘çš„ã€‚å¦‚æœæ²¡æœ‰å†™äº¤æ¢æœºï¼Œåˆ™é»˜ä»¥ä¼šæœ‰--ä¸ªç©ºçš„äº¤æ¢æœº
         *  routingKey :è·¯ç”±é”®ï¼Œå°±æ³è¯´il åˆ—é€šè¿‡è¿™ä¸ªé”®å’Œäº¤æ¢æœºå½¢æˆäº†ç»‘å®šå…³ç³»ï¼Œå¦‚æœæ²¡ æœ‰è·¯ç”±éšï¼Œåˆ™è¿™froutingKeyè¦å’Œé£å¤–çš„åå­—- -æ ·
         *  praps: æ¶ˆæ¯å±æ€§ï¼Œå¦‚æ¶ˆæ¯å†…å®¹ç¼–ç ï¼ŒæŠ•é€’æ¨¡å¼
         *  body :æ¶ˆæ¯å†…å®¹
         **/</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;hahahah&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;paidaxingxing&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3ã€åˆ›å»ºæ¶ˆè´¹ç«¯</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMqComsumerApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºè¿æ¥å·¥ç¨‹</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.174.131&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è™šæ‹Ÿæœº é»˜è®¤å€¼ '/'</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç«¯å£  é»˜è®¤å€¼ 5672</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨æˆ·å é»˜è®¤ guest</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯†ç  é»˜è®¤å€¼ guest</span>

        <span class="token comment">//è™šæ‹Ÿä¸»æœºå</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//é‡å†™ DefaultConsumerç±»çš„handleDeliveryï¼ˆï¼‰æ–¹æ³•</span>
        <span class="token class-name">DefaultConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//å›è°ƒæ–¹æ³•ï¼Œå½“æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span>
                                       <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">//envelope æ¶ˆæ¯åŒ…çš„å†…å®¹</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumerTag:æ¶ˆæ¯è€…æ ‡ç­¾&quot;</span> <span class="token operator">+</span> consumerTag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åœ¨channel.basicConsumeræ—¶å€™å¯ä»¥æŒ‡å®š</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·¯ç”±keyä¸ºï¼š&quot;</span> <span class="token operator">+</span> envelope<span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºä¸ºï¼š&quot;</span> <span class="token operator">+</span> envelope<span class="token punctuation">.</span><span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯idä¸ºï¼š&quot;</span> <span class="token operator">+</span> envelope<span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * basicConsume(String queue, boolean autoAck, Consumer callback)
         * å‚æ•°ï¼š
         *  queueï¼šé˜Ÿåˆ—åç§°
         *  autoAck: æ˜¯å¦è‡ªåŠ¨ç¡®è®¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨ç¡®è®¤
         *  consumer: ä¸Šæ–¹é‡å†™çš„æ–¹æ³•
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;paidaxingxing&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸å…³é—­èµ„æº</span>
        <span class="token comment">//channel.close();</span>
        <span class="token comment">//connection.close();</span>
        <span class="token comment">//System.in.read();  //ä¸€ç›´å¤„äºç›‘å¬çš„çŠ¶æ€</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="rabbitmq-å·¥ä½œæ¨¡å¼"><a href="#rabbitmq-å·¥ä½œæ¨¡å¼" class="header-anchor">#</a> RabbitMQ å·¥ä½œæ¨¡å¼</h2> <p><strong>é˜²å‘æŒ‡å—:</strong></p> <ul><li>é˜Ÿåˆ—æ¨¡å¼ä¸‹: æœªä½¿ç”¨è·¯ç”±å™¨åˆ™ key è¦ä½¿ç”¨é˜Ÿåˆ—åå­— è·¯ç”±å™¨ exchange ä¸º ç©º &quot;&quot;</li></ul> <h3 id="work-queues-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"><a href="#work-queues-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼" class="header-anchor">#</a> Work queues å·¥ä½œé˜Ÿåˆ—æ¨¡å¼</h3> <ul><li><p><code>Work Queues</code>ä¸å…¥é—¨ç¨‹åºçš„<code>ç®€å•æ¨¡å¼</code>ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæˆ–ä¸€äº›æ¶ˆè´¹ç«¯ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚å®ƒä»¬å¤„äºç«äº‰è€…çš„å…³ç³»ï¼Œ</p></li> <li><p>ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ï¼Œrabbité‡‡ç”¨<code>è½®è¯¢</code>çš„æ–¹å¼å°†æ¶ˆæ¯æ˜¯å¹³å‡å‘é€ç»™æ¶ˆè´¹è€…çš„ï¼›æ¶ˆè´¹è€…åœ¨å¤„ç†å®ŒæŸæ¡æ¶ˆæ¯åï¼Œæ‰ä¼šæ”¶åˆ°ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚</p></li></ul> <p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šå¯¹äº ä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚å¦‚ç”Ÿäº§è€…ç”Ÿäº§ä¸€åƒæ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆc1å’Œc2å„æ¶ˆè´¹500æ¡,é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯æ˜¯å‡è¡¡åˆ†é…</p> <blockquote><p>RabbitMQ å¿«é€Ÿå…¥é—¨: å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€… å³å¯å®ç°è½®è¯¢çš„å‡è¡¡åˆ†é…</p></blockquote> <h3 id="è®¢é˜…æ¨¡å¼ç±»å‹"><a href="#è®¢é˜…æ¨¡å¼ç±»å‹" class="header-anchor">#</a> è®¢é˜…æ¨¡å¼ç±»å‹</h3> <p>åœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªexchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p> <ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li> <li>Cï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥å—è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ã€‚</li> <li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</li> <li>Exchangeï¼šäº¤æ¢æœºï¼Œå›¾ä¸­çš„Xã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰å¸¸è§ä»¥ä¸‹3ç§ç±»å‹ï¼š
<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li> <li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li> <li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li></ul></li></ul> <p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p> <h3 id="å¹¿æ’­æ¨¡å¼"><a href="#å¹¿æ’­æ¨¡å¼" class="header-anchor">#</a> å¹¿æ’­æ¨¡å¼</h3> <blockquote><p>æ— éœ€æŒ‡å®š key é”® è·¯ç”±å™¨ä¼šå°†æ¶ˆæ¯ä¼ é€’è‡³æ‰€æœ‰è·Ÿå®ƒç»‘å®šçš„ é˜Ÿåˆ—</p></blockquote> <p>åˆ›å»ºäº¤æ¢æœºå‚æ•°è¯´æ˜ï¼š</p> <table><thead><tr><th style="text-align:left;">å‚æ•°</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">exchange</td> <td style="text-align:left;">å­—ç¬¦ä¸²å€¼ï¼Œäº¤æ¢æœºåç§°</td></tr> <tr><td style="text-align:left;">type</td> <td style="text-align:left;">äº¤æ¢æœºçš„ç±»å‹ï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼šFANOUTã€DIRECTã€TOPIC</td></tr> <tr><td style="text-align:left;">durable</td> <td style="text-align:left;">äº¤æ¢æœºæ˜¯å¦æŒä¹…åŒ–ï¼Œè¡¨ç¤ºå½“rabbitmqé‡å¯æ—¶æˆ–è€…æ„å¤–å®•æœºï¼Œè¿™ä¸ªäº¤æ¢æœºè¿˜åœ¨ä¸åœ¨</td></tr> <tr><td style="text-align:left;">autoDelete</td> <td style="text-align:left;">æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œè¡¨ç¤ºå½“è¯¥äº¤æ¢æœºæ²¡äººå‘æ¶ˆæ¯æ—¶ï¼Œæ˜¯å¦ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</td></tr> <tr><td style="text-align:left;">internal</td> <td style="text-align:left;">å†…éƒ¨ä½¿ç”¨ï¼Œä¸€èˆ¬ä¸ºfalse</td></tr> <tr><td style="text-align:left;">arguments</td> <td style="text-align:left;">å…¶å®ƒå‚æ•°</td></tr></tbody></table> <p>å‘é€æ¶ˆæ¯å‚æ•°è¯´æ˜</p> <table><thead><tr><th style="text-align:left;">å‚æ•°</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">exchange</td> <td style="text-align:left;">å­—ç¬¦ä¸²å€¼ï¼Œäº¤æ¢æœºåç§°</td></tr> <tr><td style="text-align:left;">routingKey</td> <td style="text-align:left;">å¦‚æœäº¤æ¢æœºç±»å‹æ˜¯fanoutï¼Œåˆ™routingKeyä¸º&quot;&quot;</td></tr> <tr><td style="text-align:left;">props</td> <td style="text-align:left;">æ¶ˆæ¯åŸºæœ¬å±æ€§é…ç½®</td></tr> <tr><td style="text-align:left;">body</td> <td style="text-align:left;">è¦å‘é€çš„æ¶ˆæ¯çš„å†…å®¹</td></tr></tbody></table> <p><strong>ç”Ÿäº§æ–¹:</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer_PubSub</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºè¿æ¥å·¥ç¨‹</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2ã€è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.174.131&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è™šæ‹Ÿæœº é»˜è®¤å€¼ '/'</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç«¯å£  é»˜è®¤å€¼ 5672</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨æˆ·å é»˜è®¤ guest</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯†ç  é»˜è®¤å€¼ guest</span>

        <span class="token comment">// 3. åˆ›å»ºè¿æ¥ Connection å¯¹è±¡</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. åˆ›å»º Channel ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5.åˆ›å»ºé˜Ÿåˆ—ï¼šå¦‚æœæ²¡æœ‰åå­—çš„é˜Ÿåˆ—ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å°±ä¸ä¼šåˆ›å»º</span>
        <span class="token comment">/**
         * queveDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete r Map&lt;Stringï¼Œ0bject&gt; arguments)
         * å‚æ•°è¯´æ˜:
         *  queue é˜Ÿåˆ—å
         *  durable è¿™ä¸ªé˜Ÿåˆ—æ˜¯å¦æœ‰æŒä¹…åŒ–ï¼Œä¸æ˜¯é˜Ÿåˆ—çš„æ•°æ®æ˜¯å¦æŒä¹…åŒ– trueè¡¨ç¤ºè¦æŒä¹…åŒ–
         *  exclusiveè¿™ä¸ªæ˜¯å¦å°¼ç‹¬å é˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€… trueè¡¨ç¤ºæ˜¯ç‹¬å é˜Ÿåˆ—
         *  autoDeleteè¿™ä¸ªä»¥åˆ—å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼Œä¼šä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œtrue å°±æ˜¯è‡ªåŠ¨åˆ é™¤
         *  arguments_ä»åˆ°çš„å±æ€§(.è¿™ä¸ªMåˆ—çš„æ•°æ®è¦ä¸è¦æŒä¹…åŒ–ï¼Œè¿™ä¸ªé£åˆ—çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´æ˜¯è€ä¹…ï¼Œè§„å®šè¿™ä¸ªé˜Ÿåˆ—åªèƒ½æ”¾å¤šå°‘æ¡æ•°æ®)
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;duilie1&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;duilie2&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6.åˆ›å»ºäº¤æ¢æœº</span>
        <span class="token comment">/** Exchange.DeclareOk exchangeDecLare(String exchange, String type)
         *  exchange: äº¤æ¢æœºçš„åç§°
         *  type: äº¤æ¢æœºç±»å‹  BuiltinExchangeType.FANOUT å¹¿æ’­ | DIRECT å®šå‘ | TOPIC åˆ†é…ç¬¦
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>FANOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//7ã€äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„ç»‘å®š</span>
        <span class="token comment">/**
         * queueBind(String queue, String exchange, String routingKey, Map&lt;string, 0bject&gt;
         * queue: é˜Ÿåˆ—åç§°
         * exchange: äº¤æ¢æœºåç§°
         * routingKey: è·¯ç”±çš„é”® å¦‚æœä¸ºå¹¿æ’­æ¨¡å¼fanout åˆ™ä¸ºç©º &quot; &quot;
         * 0bject: ç»‘å®šè§„åˆ™
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token string">&quot;duilie1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token string">&quot;duilie2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 8.å‘é€æ•°æ®</span>
        <span class="token comment">/**
         * basicPublish(String exchange, String routingKey, BasicProperties props, byte[] body)
         * å‚æ•°è¯´æ˜:
         *  exchange äº¤æ¢æœºçš„åå­—ï¼Œ å› ä¸ºæ¶ˆæ¯æ˜¯å…ˆå‘ç»™äº¤æ¢æœºï¼Œç„¶ååœ¨ç”±äº¤æ¢æœºè·¯ç”±åˆºAå‰‘çš„ã€‚å¦‚æœæ²¡æœ‰å†™äº¤æ¢æœºï¼Œåˆ™é»˜ä»¥ä¼šæœ‰--ä¸ªç©ºçš„äº¤æ¢æœº
         *  routingKey :è·¯ç”±é”®ï¼Œå°±æ³è¯´il åˆ—é€šè¿‡è¿™ä¸ªé”®å’Œäº¤æ¢æœºå½¢æˆäº†ç»‘å®šå…³ç³»ï¼Œå¦‚æœæ²¡ æœ‰è·¯ç”±éšï¼Œåˆ™è¿™froutingKeyè¦å’Œé£å¤–çš„åå­—- -æ ·
         *  praps: æ¶ˆæ¯å±æ€§ï¼Œå¦‚æ¶ˆæ¯å†…å®¹ç¼–ç ï¼ŒæŠ•é€’æ¨¡å¼
         *  body :æ¶ˆæ¯å†…å®¹
         **/</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">&quot;hahahah&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 9. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="routing-è·¯ç”±æ¨¡å¼"><a href="#routing-è·¯ç”±æ¨¡å¼" class="header-anchor">#</a> Routing è·¯ç”±æ¨¡å¼</h3> <blockquote><p>é˜Ÿåˆ— å’Œ è·¯ç”±å™¨ åœ¨ç»‘å®šæ—¶ åŠ å…¥å¯¹åº”çš„é”®</p> <p>åœ¨æ¶ˆæ¯ä¼ é€’æ—¶ ä¼šæ ¹æ®é”®ä¼ é€’å¯¹åº”çš„æ¶ˆæ¯</p></blockquote> <p>è·¯ç”±æ¨¡å¼ç‰¹ç‚¹ï¼š</p> <ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</li> <li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</li> <li>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul> <p>åœ¨ç¼–ç ä¸Šä¸ <code>Publish/Subscribeå‘å¸ƒä¸è®¢é˜…æ¨¡å¼</code> çš„åŒºåˆ«æ˜¯äº¤æ¢æœºçš„ç±»å‹ä¸ºï¼šDirectï¼Œè¿˜æœ‰é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºçš„æ—¶å€™éœ€è¦æŒ‡å®šrouting keyã€‚</p> <p><strong>ç”Ÿäº§æ–¹:</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer_Routing</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºè¿æ¥å·¥ç¨‹</span>
        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2ã€è®¾ç½®å‚æ•°</span>
        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.174.132&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è™šæ‹Ÿæœº é»˜è®¤å€¼ '/'</span>
        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç«¯å£  é»˜è®¤å€¼ 5672</span>
        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”¨æˆ·å é»˜è®¤ guest</span>
        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯†ç  é»˜è®¤å€¼ guest</span>

        <span class="token comment">// 3. åˆ›å»ºè¿æ¥ Connection å¯¹è±¡</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. åˆ›å»º Channel ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5.åˆ›å»ºé˜Ÿåˆ—ï¼šå¦‚æœæ²¡æœ‰åå­—çš„é˜Ÿåˆ—ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å°±ä¸ä¼šåˆ›å»º</span>
        <span class="token comment">/**
         * queveDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete r Map&lt;Stringï¼Œ0bject&gt; arguments)
         * å‚æ•°è¯´æ˜:
         *  queue é˜Ÿåˆ—åå®
         *  durable .è¿™ä¸ªé˜Ÿåˆ—æ˜¯å¦æœ‰æŒä¹…åŒ–ï¼Œä¸æ˜¯é˜Ÿåˆ—çš„æ•°æ®æ˜¯å¦æŒä¹…åŒ– trueè¡¨ç¤ºè¦æŒä¹…åŒ–
         *  exclusiveè¿™ä¸ªæ˜¯å¦å°¼ç‹¬å é˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€… trueè¡¨ç¤ºæ˜¯ç‹¬å é˜Ÿåˆ—
         *  autoDeleteè¿™ä¸ªä»¥åˆ—å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼Œä¼šä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œtrue å°±æ˜¯è‡ªåŠ¨åˆ é™¤
         *  arguments_ä»åˆ°çš„å±æ€§(.è¿™ä¸ªMåˆ—çš„æ•°æ®è¦ä¸è¦æŒä¹…åŒ–ï¼Œè¿™ä¸ªé£åˆ—çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´æ˜¯è€ä¹…ï¼Œè§„å®šè¿™ä¸ªé˜Ÿåˆ—åªèƒ½æ”¾å¤šå°‘æ¡æ•°æ®)
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;duilie1&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;duilie2&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6.åˆ›å»ºäº¤æ¢æœº</span>
        <span class="token comment">/** Exchange.DeclareOk exchangeDecLare(String exchange, String type)
         *  exchange: äº¤æ¢æœºçš„åç§°
         *  type: äº¤æ¢æœºç±»å‹  BuiltinExchangeType.FANOUT å¹¿æ’­ | DIRECT å®šå‘ | TOPIC åˆ†é…ç¬¦
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>FANOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//7ã€äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„ç»‘å®š</span>
        <span class="token comment">/**
         * queueBind(String queue, String exchange, String routingKey, Map&lt;string, 0bject&gt;
         * queue: é˜Ÿåˆ—åç§°
         * exchange: äº¤æ¢æœºåç§°
         * routingKey: è·¯ç”±çš„é”® å¦‚æœä¸ºå¹¿æ’­æ¨¡å¼fanout åˆ™ä¸ºç©º &quot; &quot;
         * 0bject: ç»‘å®šè§„åˆ™
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token string">&quot;duilie1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token string">&quot;duilie2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tow&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 8.å‘é€æ•°æ®</span>
        <span class="token comment">/**
         * basicPublish(String exchange, String routingKey, BasicProperties props, byte[] body)
         * å‚æ•°è¯´æ˜:
         *  exchange äº¤æ¢æœºçš„åå­—ï¼Œ å› ä¸ºæ¶ˆæ¯æ˜¯å…ˆå‘ç»™äº¤æ¢æœºï¼Œç„¶ååœ¨ç”±äº¤æ¢æœºè·¯ç”±åˆºAå‰‘çš„ã€‚å¦‚æœæ²¡æœ‰å†™äº¤æ¢æœºï¼Œåˆ™é»˜ä»¥ä¼šæœ‰--ä¸ªç©ºçš„äº¤æ¢æœº
         *  routingKey :è·¯ç”±é”®ï¼Œå°±æ³è¯´il åˆ—é€šè¿‡è¿™ä¸ªé”®å’Œäº¤æ¢æœºå½¢æˆäº†ç»‘å®šå…³ç³»ï¼Œå¦‚æœæ²¡ æœ‰è·¯ç”±éšï¼Œåˆ™è¿™froutingKeyè¦å’Œé£å¤–çš„åå­—- -æ ·
         *  praps: æ¶ˆæ¯å±æ€§ï¼Œå¦‚æ¶ˆæ¯å†…å®¹ç¼–ç ï¼ŒæŠ•é€’æ¨¡å¼
         *  body :æ¶ˆæ¯å†…å®¹
         **/</span>
        <span class="token class-name">String</span> one <span class="token operator">=</span> <span class="token string">&quot;one paipai&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> one<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> tow <span class="token operator">=</span> <span class="token string">&quot;tow apaiapai--&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tow&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tow<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 9. é‡Šæ”¾èµ„æº</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre></div><h3 id="topics-é€šé…ç¬¦æ¨¡å¼"><a href="#topics-é€šé…ç¬¦æ¨¡å¼" class="header-anchor">#</a> Topics é€šé…ç¬¦æ¨¡å¼</h3> <p><code>Topic</code>ç±»å‹ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>Routing key</code> çš„æ—¶å€™<strong>ä½¿ç”¨é€šé…ç¬¦</strong>ï¼<code>Routingkey</code> ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€.â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p> <p>é€šé…ç¬¦è§„åˆ™ï¼š</p> <p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p> <p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p> <p>ä¸¾ä¾‹ï¼š</p> <p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.insert.abc</code> æˆ–è€… <code>item.insert</code></p> <p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.insert</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// é˜Ÿåˆ— å’Œ è·¯ç”±å™¨ åœ¨ç»‘å®šæ—¶ åŠ å…¥å¯¹åº”çš„é€šé…ç¬¦</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token string">&quot;duilie1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;one.#&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ¶ˆæ¯å‘é€æ—¶ åªä¼šå‘é€ç¬¦åˆè¦æ±‚çš„keyé”®çš„é˜Ÿåˆ—</span>
<span class="token class-name">String</span> one <span class="token operator">=</span> <span class="token string">&quot;one paipai&quot;</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;jiaohuanji&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;one.a.b.c&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> one<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="spring"><a href="#spring" class="header-anchor">#</a> ------- Spring -------</h2> <h2 id="spring-æ•´åˆ-rabbitmq"><a href="#spring-æ•´åˆ-rabbitmq" class="header-anchor">#</a> Spring æ•´åˆ RabbitMQ</h2> <h3 id="æ­å»ºç”Ÿäº§è€…å·¥ç¨‹"><a href="#æ­å»ºç”Ÿäº§è€…å·¥ç¨‹" class="header-anchor">#</a> æ­å»ºç”Ÿäº§è€…å·¥ç¨‹</h3> <blockquote><p>æ–°å»º Meven å·¥ç¨‹ RabbitMQ-producer é¡¹ç›®</p></blockquote> <h4 id="pom-æ–‡ä»¶"><a href="#pom-æ–‡ä»¶" class="header-anchor">#</a> pom æ–‡ä»¶</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.apai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Spring-RabbitMQ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.8.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="rabbitmq-è¿æ¥ä¿¡æ¯"><a href="#rabbitmq-è¿æ¥ä¿¡æ¯" class="header-anchor">#</a> RabbitMQ è¿æ¥ä¿¡æ¯:</h4> <blockquote><p>rabbitmq.properties</p></blockquote> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">rabbitmq.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.174.132</span>
<span class="token attr-name">rabbitmq.port</span><span class="token punctuation">=</span><span class="token attr-value">5672</span>
<span class="token attr-name">rabbitmq.username</span><span class="token punctuation">=</span><span class="token attr-value">guest</span>
<span class="token attr-name">rabbitmq.password</span><span class="token punctuation">=</span><span class="token attr-value">guest</span>
<span class="token attr-name">rabbitmq.virtual-host</span><span class="token punctuation">=</span><span class="token attr-value">/</span>
</code></pre></div><h4 id="rabbitmq-é…ç½®"><a href="#rabbitmq-é…ç½®" class="header-anchor">#</a> RabbitMQ é…ç½®:</h4> <p>spring-rabbitmq.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitmq.properties<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--ä¸»è¦åˆ›å»ºbeanå¯¹è±¡--&gt;</span>
    <span class="token comment">&lt;!--åˆ›å»ºä¸€ä¸ªconnnectionfactory publisher-confirms=&quot;true&quot;:å¼€å¯äº¤æ¢æœºå›è°ƒ publisher-returns=&quot;true&quot; :å¼€å¯é˜Ÿåˆ—çš„å›è°ƒ--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">publisher-confirms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">publisher-returns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»º connection --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>admin</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»º channel  åˆ›å»ºä¸€ä¸ªä¼šè¯  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>template</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--åˆ›å»ºé˜Ÿåˆ—--&gt;</span>
    <span class="token comment">&lt;!-- 
		rabbit:queue id=&quot;é˜Ÿåˆ—å&quot; name=&quot;é˜Ÿåˆ—å&quot; 
		auto-declare=&quot;true | false&quot; æ˜¯å¦æŒä¹…åŒ–
 		auto-delete=&quot;false&quot; 
		exclusive=&quot;false&quot; trueè¡¨ç¤ºæ˜¯ç‹¬å é˜Ÿåˆ—
	--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isyueliangpai<span class="token punctuation">&quot;</span></span> <span class="token attr-name">durable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">exclusive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isyueliangpai<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--åˆ›å»ºé˜Ÿåˆ—--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºäº¤æ¢æœº  å¹¿æ’­æ¨¡å¼ fanout --&gt;</span>
    <span class="token comment">&lt;!-- 
		rabbit:fanout-exchange å¹¿æ’­æ¨¡å¼ | direct-exchange è·¯ç”±æ¨¡å¼ | topic-exchange é€šé…ç¬¦æ¨¡å¼
		name=&quot;fanout_exchange&quot; id=&quot;fanout_exchange&quot; è·¯ç”±å™¨åç§°
 		durable=&quot;true&quot; æ˜¯å¦æŒä¹…åŒ–
		auto-declare=&quot;true&quot;
	--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>fanout-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">durable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>fanout-exchange</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--åˆ›å»ºé˜Ÿåˆ—--&gt;</span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºäº¤æ¢æœº   è·¯ç”±æ¨¡å¼ direct --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>direct-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">durable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order.add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order.delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order.three<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>direct-exchange</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--åˆ›å»ºé˜Ÿåˆ—--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºäº¤æ¢æœº é€šé…ç¬¦æ¨¡å¼ topic --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tpf.*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tpf.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--åˆ›å»ºé˜Ÿåˆ— TTL ç”Ÿå‘½å‘¨æœŸ åˆ°æœŸè‡ªåŠ¨é”€æ¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TTL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TTL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">durable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">exclusive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--è®¾ç½®é˜Ÿåˆ—å±æ€§--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--key=&quot;x-message-ttl&quot; è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-message-ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>


    <span class="token comment">&lt;!--DLX  æ­»ä¿¡é˜Ÿåˆ—--&gt;</span>
    <span class="token comment">&lt;!--1ã€å£°æ˜æ­£å¸¸é˜Ÿåˆ—ï¼ˆtest_queue_dlx--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--1ã€æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--1.1 x-dead-letter-exchange æ­»ä¿¡äº¤æ¢æœºçš„åç§°--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dead-letter-exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exchange_dlx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!--1.2 x-dead-letter-routing-key æ­£å¸¸é˜Ÿåˆ—å‘é€æ¶ˆæ¯åˆ°æ­»ä¿¡ äº¤æ¢æœºçš„routingKey--&gt;</span>
            <span class="token comment">&lt;!--æ³¨æ„ï¼šè¿™ä¸ªroutingKeyå’Œæ­»ä¿¡äº¤æ¢æœºå‘é€æ¶ˆæ¯åˆ°æ­»ä¿¡é˜Ÿåˆ— åŒ¹é…ä¸€è‡´   dlx.## èƒ½åŒ¹é…åˆ° dlx.hehe--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dead-letter-routing-key<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlx.hehe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

            <span class="token comment">&lt;!--2 æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ --&gt;</span>
            <span class="token comment">&lt;!-- 2.1 è®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ ttl  x-message-ttl --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-message-ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!--2.2 è®¾ç½®é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶ x-max-length--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-max-length<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--æ­£å¸¸äº¤æ¢æœºï¼ˆtest_exchange_dlxï¼‰--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--æ­£å¸¸äº¤æ¢æœºå‘ç»™æ­£å¸¸é˜Ÿåˆ—çš„routingkey--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test.dlx.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--2ã€å£°æ˜æ­»ä¿¡é˜Ÿåˆ—ï¼ˆqueue_dlx--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--æ­»ä¿¡æ­»ä¿¡äº¤æ¢æœº(exchange_dlx)--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--pattern æ­»ä¿¡äº¤æ¢æœºå‘é€ç»™æ­»ä¿¡é˜Ÿåˆ—çš„ routingkey--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlx.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>



<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="test-æµ‹è¯•"><a href="#test-æµ‹è¯•" class="header-anchor">#</a> test æµ‹è¯•</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span></span><span class="token class-name">AmqpException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">MessagePostProcessor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">CorrelationData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>

<span class="token comment">// å¿…é¡»ä½¿ç”¨ spring æ•´åˆçš„æ³¨è§£ è¿›è¡Œé…ç½®æ³¨å…¥</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token comment">// junitçš„é‹è¡Œå™¨ï¼Œèª¬ç™½äº†å°±æ˜¯å®ƒå†…éƒ¨æœ‰ä¸€å€‹mainå‡½æ•¸ å¦‚æœå¯¹åº”æ²¡æœ‰è·¯ç”±å™¨ é»˜è®¤æ˜¯ä¸€ä¸ª &quot;&quot; ç©ºçš„è·¯ç”±å™¨ ä¸”è¦å°† é˜Ÿåˆ—çš„åç§° å†™å…¥ key é‡Œ</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;isyueliangpai&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;paidaxingçš„å¤§çˆ†ç‚¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¹¿æ’­æ¨¡å¼</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fanout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;fanout_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;å¹¿æ’­æ¨¡å¼æ¶ˆæ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·¯ç”±æ¨¡å¼</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">direct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.add&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è·¯ç”±æ¨¡å¼æ¶ˆæ¯ -- add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.delete&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è·¯ç”±æ¨¡å¼æ¶ˆæ¯ -- delete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é€šé…ç¬¦æ¨¡å¼</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tpf.add.saas&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é€šé…ç¬¦æ¨¡å¼ -- ####&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tpf.delete&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é€šé…ç¬¦æ¨¡å¼ -- ****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ¶ˆæ¯çš„å¯é æŠ•é€’ å³æœªæ­£ç¡®ä¼ é€’æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">huidiao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">/**
         * äº¤æ¢æœºçš„å›è°ƒ: ä¸è¿‡æ˜¯å¦å‡ºç°å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œå›è°ƒæ–¹æ³•
         * æ³¨æ„: éœ€è¦åœ¨é…ç½®æ–‡ä»¶ connnectionfactory ä¸Šè®¾ç½® publisher-confirms=&quot;true&quot;:å¼€å¯äº¤æ¢æœºå›è°ƒ
         */</span>
        <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span> callback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// correlationData: å…¶å®æ˜¯ä¸€- ä¸ªå¯ä»¥è£…æ•°æ®çš„å®¹å™¨</span>
                <span class="token comment">// ack: äº¤æ¢æœºæ˜¯å¦æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œå¦‚æœæ”¶åˆ°äº†ï¼Œå°±è¿™å›trueï¼Œ å¦åˆ™è¿”laifalse</span>
                <span class="token comment">// cause: å¦‚æœäº¤æ¢æœºæ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ™å¤±å«©çš„åŸå› æ˜¯ä»€ä¹ˆ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœº æˆåŠŸæ”¶åˆ°æ¶ˆæ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœº å‡ºç°å¼‚å¸¸ æ‰“å°å¼‚å¸¸ä¿¡æ¯ä¸º: &quot;</span> <span class="token operator">+</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * é˜Ÿåˆ—çš„å›è°ƒ: åªæœ‰å‡ºç°é”™è¯¯æ—¶æ‰ä¼šæ‰§è¡Œè¯¥å›è°ƒæ–¹æ³•
         * æ³¨æ„: éœ€è¦åœ¨é…ç½®æ–‡ä»¶ connnectionfactory ä¸Šè®¾ç½® publisher-returns=&quot;true&quot; :å¼€å¯é˜Ÿåˆ—çš„å›è°ƒ
         *      å¦‚æœäº¤æ¢æœºå¯¹äº†é˜Ÿåˆ—ä¹Ÿå¯¹äº†ã€‚åˆ™åªä¼šæ‰§è¡Œäº¤æ¢æœºçš„ç½‘è°confirmcallback
         *      å¦‚æœäº¤æ¢æœºé”™äº†ç‰©åªä¼šæ‰§è¡Œäº¤æ¢æœºçš„åˆ›è°ƒconfirmcallback
         *      å¦‚æœäº¤æ¢æœºå¯¹äº†é˜Ÿåˆ—é”™äº†ï¼Œå…ˆæ‰§è¡Œä»¥åˆ—çš„å››è°ƒreturncallback,å†æ‰§å…äº¤æ¢æœºçš„å›è°ƒ
         */</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// message: æ¶ˆå¿å†…å®¹ | replyCode: çŠ¶æ€ç  | replyText: çŠ¶æ€ç  | exchange: äº¤æ¢æœºçš„åç§° | routingKey: è·¯ç”±é”®</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>replyCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>replyText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wwwwtpf.add.saas&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é€šé…ç¬¦æ¨¡å¼ -- ####&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tpf.delete&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é€šé…ç¬¦æ¨¡å¼ -- ****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Consumer ACK æ¶ˆæ¯æµ‹è¯•</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.three&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Consumer ACK æ¶ˆæ¯æµ‹è¯•!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// TTLç”Ÿå‘½å‘¨æœŸ åˆ°æœŸè‡ªåŠ¨é”€æ¯ | å¦‚æœå¯¹åº”æ²¡æœ‰è·¯ç”±å™¨ é»˜è®¤æ˜¯ä¸€ä¸ª &quot;&quot; ç©ºçš„è·¯ç”±å™¨ ä¸”è¦å°† é˜Ÿåˆ—çš„åç§° å†™å…¥ key é‡Œ</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TTL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">/**
         * è®¾ç½®å•ç‹¬æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´æ³¨æ„ç‚¹:
         * 1. å¦‚æœæŸä¸ªæ¶ˆæ¯å•ç‹¬è®¾ç½®äº†æ—¶é—´,åœ¨é…ç½®æ–‡ä»¶é‡Œé…ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™ä»¥æ—¶å†…çŸ­çš„ä¸ºå‡†
         * 2. å¦‚æœæœ‰åæ¡æ¶ˆæ¯ï¼Œè¦å•ç‹¬è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™å¿…é¡»ä»ç¬¬ä¸€-æ¡æ¶ˆæ¯å¼€å§‹æ²¡ç½®
         */</span>

        <span class="token comment">// è®¾ç½®å•ç‹¬æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span>
        <span class="token class-name">MessagePostProcessor</span> messagePostProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessagePostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">postProcessMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AmqpException</span> <span class="token punctuation">{</span>
                <span class="token comment">//åˆšæ‰æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶è®¾ç½®çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯10ç§’ï¼Œè¿™é‡Œæ˜¯5ç§’ï¼Œæ³¨æ„:ä»¥æ—¶é—´çŸ­çš„ä¸ºå‡†</span>
                message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token string">&quot;5000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span>
                <span class="token keyword">return</span> message<span class="token punctuation">;</span><span class="token comment">//æ¶ˆæ¯ä¸€å®šè¦è¿”å›</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è®¾ç½®å•ç‹¬æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span>
                rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTL&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTLç”Ÿå‘½å‘¨æœŸ 5ç§’åˆ°æœŸè‡ªåŠ¨é”€æ¯&quot;</span><span class="token punctuation">,</span> messagePostProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTL&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTLç”Ÿå‘½å‘¨æœŸ åˆ°æœŸè‡ªåŠ¨é”€æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// DLX  æ­»ä¿¡é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> DLX  <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// è¿‡æœŸæ—¶é—´æµ‹è¯•</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_dlx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test.dlx.test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;DLX  æ­»ä¿¡é˜Ÿåˆ—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¶…è¿‡èŒƒå›´æµ‹è¯•</span>
<span class="token comment">//        for (int i = 0; i &lt; 20; i++) {</span>
<span class="token comment">//            rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.test&quot;,&quot;DLX  æ­»ä¿¡é˜Ÿåˆ—&quot;);</span>
<span class="token comment">//        }</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹"><a href="#æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹" class="header-anchor">#</a> æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹</h3> <blockquote><p>pom æ–‡ä»¶è·Ÿ ç”Ÿäº§æ–¹ä¸€è‡´</p></blockquote> <blockquote><p>RabbitMQ è¿æ¥ä¿¡æ¯: rabbitmq.properties  æ–‡ä»¶è·Ÿ ç”Ÿäº§æ–¹ä¸€è‡´</p></blockquote> <h4 id="æ¶ˆæ¯æ‰“å°ç±»"><a href="#æ¶ˆæ¯æ‰“å°ç±»" class="header-anchor">#</a> æ¶ˆæ¯æ‰“å°ç±»:</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">MessageListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleMessageListener</span> <span class="token keyword">implements</span> <span class="token class-name">MessageListener</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯æŠ•éæ¨™è¨˜&quot;</span><span class="token operator">+</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="ä¸šåŠ¡å±‚æ¨¡æ‹Ÿ"><a href="#ä¸šåŠ¡å±‚æ¨¡æ‹Ÿ" class="header-anchor">#</a> ä¸šåŠ¡å±‚æ¨¡æ‹Ÿ:</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">ChannelAwareMessageListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Consumer ACKæœºåˆ¶ï¼š
 * 1ã€è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼Œåœ¨ listener-containerå®¹å™¨ä¸­ æ·»åŠ  acknowledge = â€manualâ€œ
 * 2. è®©ç›‘å¬å™¨ç±»å®ç°ChannelAwareMessageListeneræ¥å£
 * 3ã€å¦‚æœ æ¶ˆæ¯æˆåŠŸå¤„ç†ï¼Œåˆ™è°ƒç”¨channelçš„basicAck()ç­¾æ”¶
 * 4ã€å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œåˆ™è°ƒç”¨channelçš„Nack()æ‹’ç»ç­¾æ”¶,brokerä¼šé‡æ–°å‘é€æ¶ˆæ¯ç»™ consumer
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AckMessageListener</span> <span class="token keyword">implements</span> <span class="token class-name">ChannelAwareMessageListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¾“å‡ºæ¶ˆæ¯å†…å®¹ ä¸èƒ½ç›´æ¥tostring æ˜¾ç¤ºä¸æ­£å¸¸</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯çš„å†…å®¹ä¸º: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯çš„æŠ•é€’æ ‡è®°ä¸º: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ­£å¸¸çš„æ‰‹åŠ¨åº”ç­”</span>
            <span class="token comment">/**
             * basicAck(long deliveryTag, boolean multiple)
             * å‚æ•°
             * 1.deliveryTag æ¶ˆæ¯çš„æ ‡è®°ï¼Œé»˜è®¤å€¼ä»1å¼€å§‹ï¼Œ ä½ è¦åº”ç­”å“ªä¸€æ¡æ¶ˆæ¯
             * 2.multiple æ˜¯å¦æ‰¹é‡åº”ç­”ï¼Œå®ƒä¼šæŠŠæ²¡æœ‰åº”ç­”çš„æ¶ˆæ¯éƒ½åº”ç­”ï¼Œå‰ææ˜¯è¿™ä¸ªæ ‡è®°è¦&lt;=å½“å‰æ ‡è®°
             */</span>
            <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¹‰åŠ¡å¼‚å¸¸å‡ºé”™ è¿›å…¥ catch æ‹’ç»åº”ç­”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ‹’ç»ç­¾æ”¶ï¼ˆåº”ç­”ï¼‰</span>
            <span class="token comment">/**
             * basicNack(long deliveryTag, boolean multiple, boolean requeue)
             * basicReject(long deliveryTag, boolean requeue);
             * å‚æ•°ï¼š
             * 1.deliveryTag æ¶ˆæ¯çš„æŠ•é€’æ ‡è®°
             * 2.multiple æ˜¯å¦æ‰¹é‡æ‹’ç»
             * 3.requeue  å¦‚æœæ‹’ç»äº† trueï¼Œåˆ™é˜Ÿåˆ—ä¸ä¼šåˆ é™¤è¿™æ¡æ¶ˆæ¯ï¼Œè€Œæ˜¯é‡æ–°å†æ¨é€ç»™ä½ ã€‚å¦‚æœä¸ºfalseï¼Œé˜Ÿåˆ—ç›´æ¥é‚£è¿™ä¸ª
             * æ¶ˆæ¯åˆ é™¤ï¼ˆå¦‚æœæœ‰æ­»ä¿¡é˜Ÿåˆ—å°±ç›´æ¥æ‰”åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼‰ï¼Œä¸ä¼šç»™ä½ é‡å‘ã€‚
             */</span>
            <span class="token comment">//channel.basicNack(message.getMessageProperties().getDeliveryTag(),true,true);</span>
            <span class="token comment">//basicReject ä¹Ÿæ˜¯ç”¨æ¥æ‹’ç»åº”ç­”çš„</span>
            channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="rabbitmq-é…ç½®-2"><a href="#rabbitmq-é…ç½®-2" class="header-anchor">#</a> RabbitMQ é…ç½®:</h4> <p>spring-rabbitmq.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.apai.listener<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitmq.properties<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--ä¸»è¦åˆ›å»ºbeanå¯¹è±¡--&gt;</span>
    <span class="token comment">&lt;!--åˆ›å»ºä¸€ä¸ªconnnectionfactory--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºconnection --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>admin</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºchannel  åˆ›å»ºä¸€ä¸ªä¼šè¯  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>template</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--è·å–æŒ‡å®šçš„å¯¹åº”æ¶ˆæ¯ queue-names=&quot;é˜Ÿåˆ—å&quot; --&gt;</span>
    <span class="token comment">&lt;!--acknowledge=&quot;manual&quot; è¡¨ç¤ºæ‰‹åŠ¨åº”ç­”ï¼Œprefetch  = 1 è¡¨ç¤ºæ¯æ¬¡ä»é˜Ÿåˆ—å–1æ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥prefetch = 10ï¼Œæ¯æ¬¡å–10æ¡--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener-container</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">acknowledge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manual<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prefetch</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isyueliangpai<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--å¹¿æ’­æ¨¡å¼--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fanout_queue1, fanout_queue2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--è·¯ç”±æ¨¡å¼--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue1, direct_queue2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--é€šé…ç¬¦æ¨¡å¼--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1, topic_queue2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--Consumer ACK æ¶ˆæ¯æµ‹è¯•--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ackMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue3, test_queue_dlx<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--Consumer ACK æ¶ˆæ¯æµ‹è¯•--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlxMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>listener-container</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="test-æµ‹è¯•-2"><a href="#test-æµ‹è¯•-2" class="header-anchor">#</a> test æµ‹è¯•</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æ¶ˆæ¯çš„å¯é æŠ•é€’"><a href="#æ¶ˆæ¯çš„å¯é æŠ•é€’" class="header-anchor">#</a> æ¶ˆæ¯çš„å¯é æŠ•é€’</h2> <p>åœ¨ä½¿ç”¨ RabbitMQ çš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯å‘é€æ–¹å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯ä¸¢å¤±æˆ–è€…æŠ•é€’å¤±è´¥åœºæ™¯ã€‚RabbitMQ ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼ç”¨æ¥æ§åˆ¶æ¶ˆæ¯çš„æŠ•é€’å¯é æ€§æ¨¡å¼ã€‚</p> <ul><li>confirm ç¡®è®¤æ¨¡å¼</li> <li>return  é€€å›æ¨¡å¼</li></ul> <p>rabbitmq æ•´ä¸ªæ¶ˆæ¯æŠ•é€’çš„è·¯å¾„ä¸ºï¼šproducer---&gt;rabbitmq broker---&gt;exchange---&gt;queue---&gt;consumer</p> <ul><li>æ¶ˆæ¯ä» producer åˆ° exchangeï¼Œ<strong>ä¸ç®¡exchangeæ˜¯å¦æ”¶åˆ°ç”Ÿäº§è€…æ¶ˆæ¯</strong>ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª confirmCallback ã€‚</li> <li>æ¶ˆæ¯ä» exchange--&gt;queue <strong>æŠ•é€’å¤±è´¥</strong>åˆ™ä¼šè¿”å›ä¸€ä¸ª returnCallback ã€‚</li></ul> <p>æˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸¤ä¸ª callback æ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’</p> <h3 id="å¼‚å¸¸å›è°ƒ"><a href="#å¼‚å¸¸å›è°ƒ" class="header-anchor">#</a> å¼‚å¸¸å›è°ƒ</h3> <p><strong>é˜²å‘æŒ‡å—:</strong></p> <ul><li>ä½œç”¨äº ç”Ÿäº§æ–¹ åœ¨æ¶ˆæ¯ä¼ é€’æ—¶çš„ç›‘æµ‹ é‡åˆ°è·¯ç”±å™¨æˆ–è€…é˜Ÿåˆ—å¼‚å¸¸åˆ™å¯è¿›è¡Œå¯¹åº”çš„å›è°ƒ</li> <li>é…ç½®æ–‡ä»¶ connnectionfactory ä¸Šè®¾ç½® publisher-confirms=&quot;true&quot;:å¼€å¯äº¤æ¢æœºå›è°ƒ</li></ul> <h3 id="spring-rabbitmq-xml"><a href="#spring-rabbitmq-xml" class="header-anchor">#</a> spring-rabbitmq.xml</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitmq.properties<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--ä¸»è¦åˆ›å»ºbeanå¯¹è±¡--&gt;</span>
    <span class="token comment">&lt;!--åˆ›å»ºä¸€ä¸ªconnnectionfactory publisher-confirms=&quot;true&quot;:å¼€å¯äº¤æ¢æœºå›è°ƒ publisher-returns=&quot;true&quot; :å¼€å¯é˜Ÿåˆ—çš„å›è°ƒ--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">publisher-confirms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">publisher-returns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºconnection --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>admin</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºchannel  åˆ›å»ºä¸€ä¸ªä¼šè¯  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>template</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- === é€šé…ç¬¦æ¨¡å¼ === --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºäº¤æ¢æœº   é€šé…ç¬¦æ¨¡å¼ --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tpf.*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tpf.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>topic_queue2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="test-æµ‹è¯•-3"><a href="#test-æµ‹è¯•-3" class="header-anchor">#</a> test æµ‹è¯•</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">CorrelationData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>

<span class="token comment">// å¿…é¡»ä½¿ç”¨ spring æ•´åˆçš„æ³¨è§£ è¿›è¡Œé…ç½®æ³¨å…¥</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:spring-rabbitmq.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token comment">// æ¶ˆæ¯çš„å¯é æŠ•é€’ å³æœªæ­£ç¡®ä¼ é€’æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">huidiao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">/**
         * äº¤æ¢æœºçš„å›è°ƒ: ä¸è¿‡æ˜¯å¦å‡ºç°å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œå›è°ƒæ–¹æ³•
         * æ³¨æ„: éœ€è¦åœ¨é…ç½®æ–‡ä»¶ connnectionfactory ä¸Šè®¾ç½® publisher-confirms=&quot;true&quot;:å¼€å¯äº¤æ¢æœºå›è°ƒ
         */</span>
        <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span> callback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// correlationData: å…¶å®æ˜¯ä¸€- ä¸ªå¯ä»¥è£…æ•°æ®çš„å®¹å™¨</span>
                <span class="token comment">// ack: äº¤æ¢æœºæ˜¯å¦æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œå¦‚æœæ”¶åˆ°äº†ï¼Œå°±è¿™å›trueï¼Œ å¦åˆ™è¿”laifalse</span>
                <span class="token comment">// cause: å¦‚æœäº¤æ¢æœºæ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ™å¤±å«©çš„åŸå› æ˜¯ä»€ä¹ˆ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœº æˆåŠŸæ”¶åˆ°æ¶ˆæ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœº å‡ºç°å¼‚å¸¸ æ‰“å°å¼‚å¸¸ä¿¡æ¯ä¸º: &quot;</span> <span class="token operator">+</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * é˜Ÿåˆ—çš„å›è°ƒ: åªæœ‰å‡ºç°é”™è¯¯æ—¶æ‰ä¼šæ‰§è¡Œè¯¥å›è°ƒæ–¹æ³•
         * æ³¨æ„: éœ€è¦åœ¨é…ç½®æ–‡ä»¶ connnectionfactory ä¸Šè®¾ç½® publisher-returns=&quot;true&quot; :å¼€å¯é˜Ÿåˆ—çš„å›è°ƒ
         *   å¦‚æœäº¤æ¢æœºå¯¹äº†é˜Ÿåˆ—ä¹Ÿå¯¹äº†ã€‚åˆ™åªä¼šæ‰§è¡Œè·¯ç”±å™¨å›è°ƒconfirmcallback
         *   å¦‚æœäº¤æ¢æœºé”™äº†ç‰©åªä¼šæ‰§è¡Œäº¤æ¢æœºçš„å›è°ƒconfirmcallback
         *   å¦‚æœäº¤æ¢æœºå¯¹äº†é˜Ÿåˆ—é”™äº†ï¼Œå…ˆæ‰§è¡Œé˜Ÿåˆ—çš„å›è°ƒreturncallback,å†æ‰§è¡Œäº¤æ¢æœºçš„å›è°ƒ
         */</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// message: æ¶ˆå¿å†…å®¹ | replyCode: çŠ¶æ€ç  | replyText: çŠ¶æ€ç  | exchange: äº¤æ¢æœºçš„åç§° | routingKey: è·¯ç”±é”®</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>replyCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>replyText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;twpf.add.saas&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é€šé…ç¬¦æ¨¡å¼ -- ####&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topic_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tpf.delete&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é€šé…ç¬¦æ¨¡å¼ -- ****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="consumer-ack-åº”ç­”"><a href="#consumer-ack-åº”ç­”" class="header-anchor">#</a> Consumer ACK åº”ç­”</h2> <p>ackæŒ‡Acknowledge(ç¿»è¯‘ä¸ºï¼šåº”ç­”)ï¼Œè¡¨ç¤ºæ¶ˆè´¹ç«¯æ”¶åˆ°æ¶ˆæ¯åçš„ç¡®è®¤æ–¹å¼ã€‚æœ‰ä¸‰ç§ç¡®è®¤æ–¹å¼ï¼š</p> <ul><li>è‡ªåŠ¨ç¡®è®¤ï¼šacknowledge=&quot;none&quot;</li> <li>æ‰‹åŠ¨ç¡®è®¤ï¼šacknowledge=&quot;manual&quot;</li> <li>æ ¹æ®å¼‚å¸¸æƒ…å†µç¡®è®¤ï¼šacknowledge=&quot;auto&quot;ï¼Œï¼ˆè¿™ç§æ–¹å¼ä½¿ç”¨éº»çƒ¦ï¼Œä¸ä½œè®²è§£ï¼‰</li></ul> <p>å…¶ä¸­è‡ªåŠ¨ç¡®è®¤æ˜¯æŒ‡ï¼Œå½“æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¥æ”¶åˆ°ï¼Œåˆ™è‡ªåŠ¨ç¡®è®¤æ”¶åˆ°ï¼Œå¹¶å°†ç›¸åº” message ä» RabbitMQ çš„æ¶ˆæ¯ç¼“å­˜ä¸­ç§»é™¤ã€‚ä½†æ˜¯åœ¨å®é™…ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¯èƒ½æ¶ˆæ¯æ¥æ”¶åˆ°ï¼Œä¸šåŠ¡å¤„ç†å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚å¦‚æœè®¾ç½®äº†æ‰‹åŠ¨ç¡®è®¤æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨ä¸šåŠ¡å¤„ç†æˆåŠŸåï¼Œè°ƒç”¨channel.basicAck()ï¼Œæ‰‹åŠ¨ç¡®è®¤ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicNack()æ–¹æ³•ï¼Œè®©å…¶è‡ªåŠ¨é‡æ–°å‘é€æ¶ˆæ¯ã€‚</p> <h3 id="æ¶ˆè´¹æ–¹çš„åº”ç­”"><a href="#æ¶ˆè´¹æ–¹çš„åº”ç­”" class="header-anchor">#</a> æ¶ˆè´¹æ–¹çš„åº”ç­”</h3> <p><strong>é˜²å‘æŒ‡å—:</strong></p> <ul><li>ä½œç”¨äº æ¶ˆè´¹æ–¹ å½“ä¸šåŠ¡å±‚è·å–æ¶ˆæ¯åå‡ºç°å¼‚å¸¸ä½†åˆæ¶ˆè´¹çš„æ¶ˆæ¯çš„æƒ…å†µ</li> <li>èƒ½å¤Ÿæ ¹æ® å¼‚å¸¸ æ¥å¯¹åº”æ‰§è¡Œ æ¶ˆæ¯çš„åº”ç­”å’Œæ‹’ç»</li></ul> <h3 id="spring-rabbitmq-xml-2"><a href="#spring-rabbitmq-xml-2" class="header-anchor">#</a> spring-rabbitmq.xml</h3> <blockquote><p>rabbit:listener-container æ·»åŠ é…ç½®:  è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶</p> <p>||  acknowledge=&quot;manual&quot; è¡¨ç¤ºæ‰‹åŠ¨åº”ç­”ï¼Œprefetch  = 1 è¡¨ç¤ºæ¯æ¬¡ä»é˜Ÿåˆ—å–1æ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥prefetch = 10ï¼Œæ¯æ¬¡å–10æ¡</p> <p>rabbit:listener ref=&quot;æŒ‡å®šä½¿ç”¨ç±»&quot; queue-names=&quot;é˜Ÿåˆ—åç§°&quot;</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>rabbit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/rabbit<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.apai.listener<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitmq.properties<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--ä¸»è¦åˆ›å»ºbeanå¯¹è±¡--&gt;</span>
    <span class="token comment">&lt;!--åˆ›å»ºä¸€ä¸ªconnnectionfactory--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>connection-factory</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.host}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.port}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.username}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.password}<span class="token punctuation">&quot;</span></span>
                               <span class="token attr-name">virtual-host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${rabbitmq.virtual-host}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºconnection --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>admin</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--åˆ›å»ºchannel  åˆ›å»ºä¸€ä¸ªä¼šè¯  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>template</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rabbitTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--è·å–æŒ‡å®šçš„å¯¹åº”æ¶ˆæ¯ queue-names=&quot;é˜Ÿåˆ—å&quot; --&gt;</span>
    <span class="token comment">&lt;!--acknowledge=&quot;manual&quot; è¡¨ç¤ºæ‰‹åŠ¨åº”ç­”ï¼Œprefetch  = 1 è¡¨ç¤ºæ¯æ¬¡ä»é˜Ÿåˆ—å–1æ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥prefetch = 10ï¼Œæ¯æ¬¡å–10æ¡--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener-container</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">acknowledge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manual<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prefetch</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isyueliangpai<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--Consumer ACK æ¶ˆæ¯æµ‹è¯•--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ackMessageListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>direct_queue3<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>listener-container</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="ackmessagelistener-ä½¿ç”¨ç±»"><a href="#ackmessagelistener-ä½¿ç”¨ç±»" class="header-anchor">#</a> ackMessageListener ä½¿ç”¨ç±»</h3> <blockquote><p>ç›‘å¬æ¶ˆæ¯ æ ¹æ®ä¸šåŠ¡æ˜¯å¦å‡ºç°å¼‚å¸¸ è¿›è¡Œæ¶ˆæ¯çš„åº”ç­”å’Œæ‹’ç»</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">ChannelAwareMessageListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Consumer ACKæœºåˆ¶ï¼š
 * 1ã€è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼Œåœ¨ listener-containerå®¹å™¨ä¸­ æ·»åŠ  acknowledge = â€manualâ€œ
 * 2. è®©ç›‘å¬å™¨ç±»å®ç°ChannelAwareMessageListeneræ¥å£
 * 3ã€å¦‚æœ æ¶ˆæ¯æˆåŠŸå¤„ç†ï¼Œåˆ™è°ƒç”¨channelçš„basicAck()ç­¾æ”¶
 * 4ã€å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œåˆ™è°ƒç”¨channelçš„Nack()æ‹’ç»ç­¾æ”¶,brokerä¼šé‡æ–°å‘é€æ¶ˆæ¯ç»™ consumer
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AckMessageListener</span> <span class="token keyword">implements</span> <span class="token class-name">ChannelAwareMessageListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¾“å‡ºæ¶ˆæ¯å†…å®¹ ä¸èƒ½ç›´æ¥tostring æ˜¾ç¤ºä¸æ­£å¸¸</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯çš„å†…å®¹ä¸º: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯çš„æŠ•é€’æ ‡è®°ä¸º: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ­£å¸¸çš„æ‰‹åŠ¨åº”ç­”</span>
            <span class="token comment">/**
             * basicAck(long deliveryTag, boolean multiple)
             * å‚æ•°
             * 1.deliveryTag æ¶ˆæ¯çš„æ ‡è®°ï¼Œé»˜è®¤å€¼ä»1å¼€å§‹ï¼Œ ä½ è¦åº”ç­”å“ªä¸€æ¡æ¶ˆæ¯
             * 2.multiple æ˜¯å¦æ‰¹é‡åº”ç­”ï¼Œå®ƒä¼šæŠŠæ²¡æœ‰åº”ç­”çš„æ¶ˆæ¯éƒ½åº”ç­”ï¼Œå‰ææ˜¯è¿™ä¸ªæ ‡è®°è¦&lt;=å½“å‰æ ‡è®°
             */</span>
            <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¹‰åŠ¡å¼‚å¸¸å‡ºé”™ è¿›å…¥ catch æ‹’ç»åº”ç­”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ‹’ç»ç­¾æ”¶ï¼ˆåº”ç­”ï¼‰</span>
            <span class="token comment">/**
             * basicNack(long deliveryTag, boolean multiple, boolean requeue)
             * basicReject(long deliveryTag, boolean requeue);
             * å‚æ•°ï¼š
             * 1.deliveryTag æ¶ˆæ¯çš„æŠ•é€’æ ‡è®°
             * 2.multiple æ˜¯å¦æ‰¹é‡æ‹’ç»
             * 3.requeue  å¦‚æœæ‹’ç»äº† trueï¼Œåˆ™é˜Ÿåˆ—ä¸ä¼šåˆ é™¤è¿™æ¡æ¶ˆæ¯ï¼Œè€Œæ˜¯é‡æ–°å†æ¨é€ç»™ä½ ã€‚å¦‚æœä¸ºfalseï¼Œé˜Ÿåˆ—ç›´æ¥é‚£è¿™ä¸ª
             * æ¶ˆæ¯åˆ é™¤ï¼ˆå¦‚æœæœ‰æ­»ä¿¡é˜Ÿåˆ—å°±ç›´æ¥æ‰”åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼‰ï¼Œä¸ä¼šç»™ä½ é‡å‘ã€‚
             */</span>
            <span class="token comment">//channel.basicNack(message.getMessageProperties().getDeliveryTag(),true,true);</span>
            <span class="token comment">//basicReject ä¹Ÿæ˜¯ç”¨æ¥æ‹’ç»åº”ç­”çš„</span>
            channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æ¶ˆè´¹ç«¯é™æµ"><a href="#æ¶ˆè´¹ç«¯é™æµ" class="header-anchor">#</a> æ¶ˆè´¹ç«¯é™æµ</h2> <blockquote><p>æ¶ˆè´¹ç«¯æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–ä¸€éƒ¨åˆ†æ¶ˆæ¯ï¼Œç„¶åæ¶ˆè´¹è€…è§£å†³å®Œä¸šåŠ¡å¤„ç†ï¼Œå½“ä¸šåŠ¡å¤„ç†å®Œä¹‹åï¼Œæ¶ˆè´¹è€…é‡‡ç”¨æ‰‹åŠ¨åº”ç­”çš„æ–¹å¼ï¼Œå›åº”æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åç»§ç»­å–ä¸€éƒ¨åˆ†æ¶ˆæ¯å¤„ç†ï¼Œå®ç°å‰Šå³°å¡«è°·çš„æ•ˆæœ</p></blockquote> <p><strong>æ¶ˆè´¹ç«¯å·¥ç¨‹çš„é…ç½®æ–‡ä»¶é…ç½®å¦‚ä¸‹</strong></p> <p>æ³¨æ„:  åœ¨<a href="rabbit:listener-container">rabbit:listener-container</a> ä¸­é…ç½® prefetchå±æ€§è®¾ç½®æ¶ˆè´¹ç«¯ä¸€æ¬¡æ‹‰å–å¤šå°‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯çš„ç¡®è®¤æ¨¡å¼ä¸€å®šä¸ºæ‰‹åŠ¨ç¡®è®¤ã€‚acknowledge=&quot;manual&quot;</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨--&gt;</span>
<span class="token comment">&lt;!--acknowledge=&quot;manual&quot; è¡¨ç¤ºæ‰‹åŠ¨åº”ç­”ï¼Œprefetch  = 1 è¡¨ç¤ºæ¯æ¬¡ä»é˜Ÿåˆ—å–1æ¡--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener-container</span> <span class="token attr-name">connection-factory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>connectionFactory<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">acknowledge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manual<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prefetch</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--&lt;rabbit:listener ref=&quot;ackListener&quot; queue-names=&quot;test_queue_confirm&quot; /&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>listener</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qosListener<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-names</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_confirm<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>listener-container</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="ttl-æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ"><a href="#ttl-æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> TTL æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ</h2> <blockquote><p>TTL å…¨ç§° Time To Liveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰ã€‚å½“æ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚RabbitMQå¯ä»¥å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å½“æ¶ˆæ¯è¶…è¿‡è¿‡æœŸæ—¶é—´è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ä¸¢å¼ƒ</p></blockquote> <h4 id="å›¾å½¢åŒ–è®¾ç½®"><a href="#å›¾å½¢åŒ–è®¾ç½®" class="header-anchor">#</a> å›¾å½¢åŒ–è®¾ç½®</h4> <p>1ã€æ·»åŠ äº¤æ¢æœº</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211120541264.png" alt="image-20220211120541264"></p> <p>2ã€æ·»åŠ é˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211120639547.png" alt="image-20220211120639547"></p> <p>3ã€äº¤æ¢æœºå’Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç»‘å®š</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211120727976.png" alt="image-20220211120727976"></p> <p>äº¤æ¢æœºå‘é€æ¶ˆæ¯</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211120750369.png" alt="image-20220211120750369"></p> <h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="header-anchor">#</a> ä»£ç å®ç°</h4> <p><strong>é˜²å‘æŒ‡å—:</strong></p> <ul><li>å¦‚æœæŸä¸ªæ¶ˆæ¯å•ç‹¬è®¾ç½®äº†æ—¶é—´,åœ¨é…ç½®æ–‡ä»¶é‡Œé…ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™ä»¥æ—¶å†…çŸ­çš„ä¸ºå‡†</li> <li>å¦‚æœæœ‰åæ¡æ¶ˆæ¯ï¼Œè¦å•ç‹¬è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™å¿…é¡»ä»ç¬¬ä¸€-æ¡æ¶ˆæ¯å¼€å§‹æ²¡ç½®</li></ul> <p><strong>1.é…ç½®æ–‡ä»¶</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--åˆ›å»ºé˜Ÿåˆ— TTL ç”Ÿå‘½å‘¨æœŸ åˆ°æœŸè‡ªåŠ¨é”€æ¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TTL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TTL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-declare</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">durable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">exclusive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--è®¾ç½®é˜Ÿåˆ—å±æ€§--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--key=&quot;x-message-ttl&quot; è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-message-ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>2.æµ‹è¯•</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// TTLç”Ÿå‘½å‘¨æœŸ åˆ°æœŸè‡ªåŠ¨é”€æ¯ | å¦‚æœå¯¹åº”æ²¡æœ‰è·¯ç”±å™¨ é»˜è®¤æ˜¯ä¸€ä¸ª &quot;&quot; ç©ºçš„è·¯ç”±å™¨ ä¸”è¦å°† é˜Ÿåˆ—çš„åç§° å†™å…¥ key é‡Œ</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TTL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/**
    * è®¾ç½®å•ç‹¬æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´æ³¨æ„ç‚¹:
    * 1. å¦‚æœæŸä¸ªæ¶ˆæ¯å•ç‹¬è®¾ç½®äº†æ—¶é—´,åœ¨é…ç½®æ–‡ä»¶é‡Œé…ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™ä»¥æ—¶å†…çŸ­çš„ä¸ºå‡†
    * 2. å¦‚æœæœ‰åæ¡æ¶ˆæ¯ï¼Œè¦å•ç‹¬è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™å¿…é¡»ä»ç¬¬ä¸€-æ¡æ¶ˆæ¯å¼€å§‹æ²¡ç½®
    */</span>

    <span class="token comment">// è®¾ç½®å•ç‹¬æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span>
    <span class="token class-name">MessagePostProcessor</span> messagePostProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessagePostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">postProcessMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AmqpException</span> <span class="token punctuation">{</span>
            <span class="token comment">//åˆšæ‰æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶è®¾ç½®çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯10ç§’ï¼Œè¿™é‡Œæ˜¯5ç§’ï¼Œæ³¨æ„:ä»¥æ—¶é—´çŸ­çš„ä¸ºå‡†</span>
            message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token string">&quot;5000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span>
            <span class="token keyword">return</span> message<span class="token punctuation">;</span><span class="token comment">//æ¶ˆæ¯ä¸€å®šè¦è¿”å›</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è®¾ç½®å•ç‹¬æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span>
            rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTL&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTLç”Ÿå‘½å‘¨æœŸ 5ç§’åˆ°æœŸè‡ªåŠ¨é”€æ¯&quot;</span><span class="token punctuation">,</span> messagePostProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTL&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;TTLç”Ÿå‘½å‘¨æœŸ åˆ°æœŸè‡ªåŠ¨é”€æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dlx-æ­»ä¿¡é˜Ÿåˆ—"><a href="#dlx-æ­»ä¿¡é˜Ÿåˆ—" class="header-anchor">#</a> DLX  æ­»ä¿¡é˜Ÿåˆ—</h2> <p>æ­»ä¿¡é˜Ÿåˆ—ï¼Œè‹±æ–‡ç¼©å†™ï¼šDLX  ã€‚Dead Letter Exchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œå½“æ¶ˆæ¯åœ¨é˜Ÿåˆ—æˆä¸ºDead messageåï¼Œé€šè¿‡è¯¥é˜Ÿåˆ—æŠŠè¿™æ¡æ­»ä¿¡æ¶ˆæ¯å‘ç»™å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯DLXã€‚</p> <h3 id="æµç¨‹"><a href="#æµç¨‹" class="header-anchor">#</a> <strong>æµç¨‹:</strong></h3> <p>æ­£å¸¸è·¯ç”±å™¨ --&gt; æ­£å¸¸é˜Ÿåˆ— --&gt; æ‹’ç»ç­¾æ”¶ä¸”ä¸é‡å‘ --&gt; æ­»ä¿¡è·¯ç”±å™¨ --&gt; æ­»ä¿¡é˜Ÿåˆ—</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220728151856201.png" alt="image-20220728151856201"></p> <h3 id="æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ"><a href="#æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ" class="header-anchor">#</a> **æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š **</h3> <ul><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ï¼›</li> <li>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼ŒbasicNack/basicReject,å¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—,requeue=falseï¼›</li> <li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼›</li></ul> <h3 id="åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—"><a href="#åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—" class="header-anchor">#</a> åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—</h3> <blockquote><p><strong>1ã€é…ç½®äº¤æ¢æœºå’Œé˜Ÿåˆ—</strong></p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--DLX  æ­»ä¿¡é˜Ÿåˆ—--&gt;</span>
<span class="token comment">&lt;!--1ã€å£°æ˜æ­£å¸¸é˜Ÿåˆ—ï¼ˆtest_queue_dlx--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--1ã€æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--1.1 x-dead-letter-exchange æ­»ä¿¡äº¤æ¢æœºçš„åç§°--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dead-letter-exchange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exchange_dlx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--1.2 x-dead-letter-routing-key æ­£å¸¸é˜Ÿåˆ—å‘é€æ¶ˆæ¯åˆ°æ­»ä¿¡ äº¤æ¢æœºçš„routingKey--&gt;</span>
        <span class="token comment">&lt;!--æ³¨æ„ï¼šè¿™ä¸ªroutingKeyå’Œæ­»ä¿¡äº¤æ¢æœºå‘é€æ¶ˆæ¯åˆ°æ­»ä¿¡é˜Ÿåˆ— åŒ¹é…ä¸€è‡´   dlx.## èƒ½åŒ¹é…åˆ° dlx.hehe--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dead-letter-routing-key<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlx.hehe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!--2 æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ --&gt;</span>
        <span class="token comment">&lt;!-- 2.1 è®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ ttl  x-message-ttl --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-message-ttl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!--2.2 è®¾ç½®é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶ x-max-length--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-max-length<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue-arguments</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--æ­£å¸¸äº¤æ¢æœºï¼ˆtest_exchange_dlxï¼‰--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ­£å¸¸äº¤æ¢æœºå‘ç»™æ­£å¸¸é˜Ÿåˆ—çš„routingkey--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test.dlx.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--2ã€å£°æ˜æ­»ä¿¡é˜Ÿåˆ—ï¼ˆqueue_dlx--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>queue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>queue</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--æ­»ä¿¡æ­»ä¿¡äº¤æ¢æœº(exchange_dlx)--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>topic-exchange</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>exchange_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--pattern æ­»ä¿¡äº¤æ¢æœºå‘é€ç»™æ­»ä¿¡é˜Ÿåˆ—çš„ routingkey--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">rabbit:</span>binding</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dlx.#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queue_dlx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>binding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>bindings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">rabbit:</span>topic-exchange</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p><strong>2ã€ç”Ÿäº§è€…å·¥ç¨‹æµ‹è¯•ï¼š</strong></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// DLX  æ­»ä¿¡é˜Ÿåˆ—</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> DLX  <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// è¿‡æœŸæ—¶é—´æµ‹è¯•</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_dlx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test.dlx.test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;DLX  æ­»ä¿¡é˜Ÿåˆ—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¶…è¿‡èŒƒå›´æµ‹è¯•</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;test_exchange_dlx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test.dlx.test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;DLX  æ­»ä¿¡é˜Ÿåˆ—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>3.  æ¶ˆè´¹æ–¹æ·»åŠ æ­£å¸¸é˜Ÿåˆ—çš„ç›‘å¬å™¨</strong></p></blockquote> <ul><li>ç›‘å¬ æ­£å¸¸é˜Ÿåˆ—  å½“å‡ºç°ä¸€å¼‚å¸¸ æ‹’ç»åº”ç­” ä¸”ä¸è¿›è¡Œé‡å‘ åˆ™è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</li> <li>å¯åœ¨è¿›è¡Œç›‘å¬æ­»ä¿¡é˜Ÿåˆ— è¿›è¡Œå¯¹åº”çš„æ“ä½œ</li></ul> <h2 id="æ—¥å¿—ä¸ç›‘æ§"><a href="#æ—¥å¿—ä¸ç›‘æ§" class="header-anchor">#</a> æ—¥å¿—ä¸ç›‘æ§</h2> <h3 id="rabbitmqæ—¥å¿—"><a href="#rabbitmqæ—¥å¿—" class="header-anchor">#</a> RabbitMQæ—¥å¿—</h3> <p>RabbitMQé»˜è®¤æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š /var/log/rabbitmq/rabbit@xxx.log</p> <p>æ—¥å¿—åŒ…å«äº†RabbitMQçš„ç‰ˆæœ¬å·ã€Erlangçš„ç‰ˆæœ¬å·ã€RabbitMQæœåŠ¡èŠ‚ç‚¹åç§°ã€cookieçš„hashå€¼ã€RabbitMQé…ç½®æ–‡ä»¶åœ°å€ã€å†…å­˜é™åˆ¶ã€ç£ç›˜é™åˆ¶ã€é»˜è®¤è´¦æˆ·guestçš„åˆ›å»ºä»¥åŠæƒé™é…ç½®ç­‰ç­‰ã€‚</p> <h3 id="rabbitmqå¸¸ç”¨å‘½ä»¤"><a href="#rabbitmqå¸¸ç”¨å‘½ä»¤" class="header-anchor">#</a> rabbitmqå¸¸ç”¨å‘½ä»¤</h3> <p>1ã€æŸ¥çœ‹é˜Ÿåˆ—</p> <div class="language-shell extra-class"><pre class="language-shell"><code>rabbitmqctl list_queues               <span class="token comment">#æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿä¸»æœºé‡Œé¢çš„é˜Ÿåˆ—</span>
rabbitmqctl list_queues  -p  /vhost   <span class="token comment">#æŸ¥çœ‹æŸä¸ªè™šæ‹Ÿä¸»æœºé‡Œé¢çš„é˜Ÿåˆ—</span>
</code></pre></div><p>2ã€åˆ é™¤æ‰€æœ‰é˜Ÿåˆ—</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>rabbitmqctl stop_app   <span class="token comment">#å…³é—­åº”ç”¨</span>
rabbitmqctl reset      <span class="token comment">#æ¸…é™¤é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</span>
rabbitmqctl start_app  <span class="token comment">## å†æ¬¡å¯åŠ¨æ­¤åº”ç”¨</span>
</code></pre></div><blockquote><p>æ³¨æ„ï¼šæ­¤æ–¹å¼ï¼Œä¼šåŒæ—¶åˆ é™¤ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œéœ€è¦æ…ç”¨</p></blockquote> <p>3ã€æŸ¥çœ‹rabbitmqä¸­çš„äº¤æ¢æœº</p> <div class="language-shell extra-class"><pre class="language-shell"><code>rabbitmqctl list_exchanges <span class="token punctuation">[</span>-p  vhost<span class="token punctuation">]</span>
</code></pre></div><p>4ã€rabbitmqçš„ç”¨æˆ·æ“ä½œå‘½ä»¤</p> <div class="language-shell extra-class"><pre class="language-shell"><code>rabbitmqctl list_users
rabbitmqctl add_user ç”¨æˆ·å å¯†ç 
rabbitmqctl delete_user ç”¨æˆ·å
</code></pre></div><p>5ã€æŸ¥çœ‹æœªè¢«ç¡®è®¤çš„é˜Ÿåˆ—</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmqctl list_queues  name messages_unacknowledged
</code></pre></div><p>6ã€æŸ¥çœ‹é˜Ÿåˆ—ç¯å¢ƒå˜é‡</p> <div class="language-shell extra-class"><pre class="language-shell"><code>rabbitmqctl environment
</code></pre></div><p>7ã€æŸ¥çœ‹é˜Ÿåˆ—æ¶ˆè´¹è€…ä¿¡æ¯</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmqctl list_consumers
</code></pre></div><p>8ã€æŸ¥çœ‹é˜Ÿåˆ—è¿æ¥</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmqctl list_connections
</code></pre></div><p>9ã€æŸ¥çœ‹å‡†å¤‡å°±ç»ªçš„é˜Ÿåˆ—</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmqctl list_queues name messages_ready
</code></pre></div><p>10ã€æŸ¥çœ‹å•ä¸ªé˜Ÿåˆ—çš„å†…å­˜ä½¿ç”¨</p> <div class="language- extra-class"><pre class="language-text"><code>rabbitmqctl list_queues name memory
</code></pre></div><p>11ã€åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº</p> <div class="language-shell extra-class"><pre class="language-shell"><code>rabbitmqctl list_vhosts
rabbitmqctl status <span class="token operator">|</span> <span class="token function">grep</span> rabbit  <span class="token comment">##æŸ¥çœ‹rabbitmqçš„ç‰ˆæœ¬</span>
</code></pre></div><h2 id="æ¶ˆæ¯è¿½è¸ª"><a href="#æ¶ˆæ¯è¿½è¸ª" class="header-anchor">#</a> æ¶ˆæ¯è¿½è¸ª</h2> <p>åœ¨ä½¿ç”¨ä»»ä½•æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šå‡ºç°æŸæ¡æ¶ˆæ¯å¼‚å¸¸ä¸¢å¤±çš„æƒ…å†µã€‚</p> <p>å¯¹äºRabbitMQè€Œè¨€ï¼Œå¯èƒ½æ˜¯å› ä¸ºç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ä¸RabbitMQæ–­å¼€äº†è¿æ¥ï¼Œè€Œå®ƒä»¬ä¸RabbitMQåˆé‡‡ç”¨äº†ä¸åŒçš„ç¡®è®¤æœºåˆ¶ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºäº¤æ¢å™¨ä¸é˜Ÿåˆ—ä¹‹é—´ä¸åŒçš„è½¬å‘ç­–ç•¥ï¼›ç”šè‡³æ˜¯äº¤æ¢å™¨å¹¶æ²¡æœ‰ä¸ä»»ä½•é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œç”Ÿäº§è€…åˆä¸æ„ŸçŸ¥æˆ–è€…æ²¡æœ‰é‡‡å–ç›¸åº”çš„æªæ–½ï¼›å¦å¤–RabbitMQæœ¬èº«çš„é›†ç¾¤ç­–ç•¥ä¹Ÿå¯èƒ½å¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªè¾ƒå¥½çš„æœºåˆ¶è·Ÿè¸ªè®°å½•æ¶ˆæ¯çš„æŠ•é€’è¿‡ç¨‹ï¼Œä»¥æ­¤ååŠ©å¼€å‘å’Œè¿ç»´äººå‘˜è¿›è¡Œé—®é¢˜çš„å®šä½ã€‚</p> <p>åœ¨RabbitMQä¸­å¯ä»¥ä½¿ç”¨Firehoseå’Œrabbitmq_tracingæ’ä»¶åŠŸèƒ½æ¥å®ç°æ¶ˆæ¯è¿½è¸ªã€‚</p> <h3 id="æ¶ˆæ¯è¿½è¸ª-firehose-äº†è§£"><a href="#æ¶ˆæ¯è¿½è¸ª-firehose-äº†è§£" class="header-anchor">#</a> æ¶ˆæ¯è¿½è¸ª-Firehose(äº†è§£)</h3> <p>firehoseçš„æœºåˆ¶æ˜¯å°†ç”Ÿäº§è€…æŠ•é€’ç»™é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä»¥åŠé˜Ÿåˆ—æŠ•é€’ç»™æ¶ˆè´¹è€…çš„æ¶ˆæ¯æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼å‘é€åˆ°é»˜è®¤çš„exchangeä¸Šã€‚è¿™ä¸ªé»˜è®¤çš„exchangeçš„åç§°ä¸º<strong>amq.rabbitmq.trace</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªtopicç±»å‹çš„exchangeã€‚å‘é€åˆ°è¿™ä¸ªexchangeä¸Šçš„æ¶ˆæ¯çš„routing keyä¸º publish.exchangename å’Œ deliver.queuenameã€‚å…¶ä¸­exchangenameå’Œqueuenameä¸ºå®é™…äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„åç§°ï¼Œåˆ†åˆ«å¯¹åº”ç”Ÿäº§è€…æŠ•é€’åˆ°exchangeçš„æ¶ˆæ¯ï¼Œå’Œæ¶ˆè´¹è€…ä»queueä¸Šè·å–çš„æ¶ˆæ¯ã€‚</p> <p>1ã€æ‰“å¼€trace åŠŸèƒ½</p> <div class="language-shell extra-class"><pre class="language-shell"><code>rabbitmqctl trace_on <span class="token punctuation">[</span>-p vhost<span class="token punctuation">]</span>     <span class="token comment">##å¼€å¯Firehoseå‘½ä»¤</span>
</code></pre></div><blockquote><p>æ‰“å¼€ trace ä¼šå½±å“æ¶ˆæ¯å†™å…¥åŠŸèƒ½ï¼Œé€‚å½“æ‰“å¼€åè¯·å…³é—­ï¼Œå…³é—­Firehoseå‘½ä»¤ï¼šrabbitmqctl trace_off [-p vhost]ï¼Œæ‰“å¼€åä¼šå¤šä¸€ä¸ªäº¤æ¢æœºï¼Œå¦‚ä¸‹å›¾</p></blockquote> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211150538504.png" alt="image-20220211150538504"></p> <p>2ã€æ–°å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ç»™è¯¥äº¤æ¢æœºç»‘å®šä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211150649960.png" alt="image-20220211150649960"></p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211150739166.png" alt="image-20220211150739166"></p> <p>3ã€æ‰“å¼€ä»»ä½•ä¸€ä¸ªå…¶ä»–çš„é˜Ÿåˆ—ï¼Œå¹¶å¾€é˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œåˆ™è¿™ä¸ªtest_traceé˜Ÿåˆ—ä¹Ÿä¼šæœ‰å…¶ä»–é˜Ÿåˆ—çš„æ¶ˆæ¯</p> <h3 id="æ¶ˆæ¯è¿½è¸ª-rabbitmq-tracing"><a href="#æ¶ˆæ¯è¿½è¸ª-rabbitmq-tracing" class="header-anchor">#</a> æ¶ˆæ¯è¿½è¸ª-rabbitmq_tracing</h3> <p>rabbitmq_tracingå’ŒFirehoseåœ¨å®ç°ä¸Šå¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡rabbitmq_tracingçš„æ–¹å¼æ¯”Firehoseå¤šäº†ä¸€å±‚GUIçš„åŒ…è£…ï¼Œæ›´å®¹æ˜“ä½¿ç”¨å’Œç®¡ç†ã€‚</p> <p>1ã€å¯ç”¨æ’ä»¶ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">## rabbitmq-plugins list                       ###æŸ¥è¯¢æ’ä»¶</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">## rabbitmq-plugins enable rabbitmq_tracing</span>
</code></pre></div><p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211151141485.png" alt="image-20220211151141485"></p> <p>1ã€æ–°å»ºä¸€ä¸ªtraceï¼Œå°†æ¥æ‰€æœ‰çš„æ¶ˆæ¯éƒ½è¢«traceä¿å­˜èµ·æ¥ï¼Œæ–‡ä»¶çš„é»˜è®¤è·¯å¾„ä¸º/var/tmp/rabbitmq-tracing</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211151244964.png" alt="image-20220211151244964"></p> <p>ä¸ç®¡åœ¨å“ªä¸ªé˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œéƒ½ä¼šä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶mytrace.logä¸­</p> <p><img src="https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220211151427726.png" alt="image-20220211151427726"></p> <p>å¦‚æœæ˜¯ç”¨å…¶å®ƒçš„ç”¨æˆ·åˆ›å»ºè¿™ä¸ªæ¶ˆæ¯æ—¥å¿—ã€‚åˆ™éœ€è¦åœ¨/etc/rabbitmq/rabbit.configé…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼šåˆ›å»ºçš„ç”¨æˆ·åå’Œå¯†ç </p> <div class="language- extra-class"><pre class="language-text"><code>{rabbitmq_tracing,
    [
     {directory, &quot;/var/log/rabbitmq/rabbitmq_tracing&quot;},
     {username, &quot;woniu&quot;}, 
     {password, &quot;woniu&quot;}
    ]
}
</code></pre></div><p>é‡å¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å³å¯</p> <h2 id="spring-boot"><a href="#spring-boot" class="header-anchor">#</a> ------- Spring Boot -------</h2> <h2 id="spring-boot-æ•´åˆ-rabbitmq"><a href="#spring-boot-æ•´åˆ-rabbitmq" class="header-anchor">#</a> Spring-Boot æ•´åˆ RabbitMQ</h2> <h3 id="pom-xml"><a href="#pom-xml" class="header-anchor">#</a> pom.xml</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--rabbitmq å®¢æˆ·ç«¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="application-yml-é…ç½®"><a href="#application-yml-é…ç½®" class="header-anchor">#</a> application.yml é…ç½®</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Spring<span class="token punctuation">-</span>boot<span class="token punctuation">-</span>producer
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/k15<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.174.133
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
    <span class="token comment">## æ¶ˆæ¯é˜Ÿåˆ—çš„è™šæ‹Ÿä¸»æœº</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token comment">## è·¯ç”±å™¨æ¶ˆæ¯ç¡®è®¤é…ç½® ç”Ÿäº§æ–¹ é»˜è®¤ none | CORRELATED å¼‚æ­¥ | SIMPLE åŒæ­¥</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> CORRELATED
    <span class="token comment">## å¼€å¯ æ¶ˆæ¯åˆ°é˜Ÿåˆ—çš„å›è°ƒ ç”Ÿäº§æ–¹</span>
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token comment">## å¼€å¯æ‰‹åŠ¨åº”ç­” æ¶ˆè´¹æ–¹</span>
        <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> manual
        <span class="token comment">## é˜Ÿåˆ—æ¯æ¬¡æ‹‰å–æ¶ˆæ¯æ¬¡æ•° æ¶ˆè´¹æ–¹</span>
        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><h3 id="rabbitmqconfig-åˆ›å»º"><a href="#rabbitmqconfig-åˆ›å»º" class="header-anchor">#</a> RabbitMqConfig  åˆ›å»º</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMqConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">// åˆ›å»ºäº¤æ¢æœº åç§°ä¸º: direct_exchange</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// return ExchangeBuilder.directExchange(&quot;direct_exchange&quot;).build();</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åˆ›å»ºé˜Ÿåˆ— åç§°ä¸º: direct_queue é…ç½®åç§°wei: queue1</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;queue1&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//return   QueueBuilder.durable(&quot;direct_queue&quot;).build();</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®š keyä¸º: x.y</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;queue1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Exchange</span> exchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;x.y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="è·¯ç”±å™¨-é˜Ÿåˆ—-å›è°ƒ"><a href="#è·¯ç”±å™¨-é˜Ÿåˆ—-å›è°ƒ" class="header-anchor">#</a> è·¯ç”±å™¨ | é˜Ÿåˆ— | å›è°ƒ</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MessageMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">CorrelationData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token comment">//åˆ›å»ºäº¤æ¢æœºå’Œé˜Ÿåˆ—</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMqConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageMapper</span> messageMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;registor_exchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">getDirectExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">directExchange</span><span class="token punctuation">(</span><span class="token string">&quot;registor_exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;registor_queue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;registor_queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;registor_queue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;registor_exchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Exchange</span> exchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;registor.add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¯è‡ªå®šä¹‰ rabbitTemplateé…ç½® ä¸”å¯è®¾ç½®è·¯ç”±å™¨å’Œé˜Ÿåˆ—çš„å›è°ƒ</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RabbitTemplate</span> <span class="token function">getRabbitTemplate</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RabbitTemplate</span> rabbitTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//äº¤æ¢æœºçš„å›è°ƒ</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">// è·å– CorrelationDataå°è£…çš„æ•°æ® ä¸ºå­—ç¬¦ä¸²</span>
               <span class="token class-name">String</span> messageId <span class="token operator">=</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//é˜Ÿåˆ—çš„å›è°ƒ</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å– MessagePostProcessor å°è£…çš„æ•°æ® ä¸ºå­—ç¬¦ä¸²</span>
                <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="controller-å‘é€æ¶ˆæ¯"><a href="#controller-å‘é€æ¶ˆæ¯" class="header-anchor">#</a> Controller å‘é€æ¶ˆæ¯</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DlxRabbitmqConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IUserService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token comment">// æ³¨å…¥é…ç½®ç±»çš„è·¯ç”±å™¨ | é˜Ÿåˆ— ...</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// æ ¹æ® è·¯ç”±å™¨åç§° å’Œ é˜Ÿåˆ—çš„key å¯¹åº”çš„å‘é€æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;x.y&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;éšä¾¿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="listener-æ¥æ”¶æ¶ˆæ¯"><a href="#listener-æ¥æ”¶æ¶ˆæ¯" class="header-anchor">#</a> listener æ¥æ”¶æ¶ˆæ¯</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mylistener</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç›‘å¬ é˜Ÿåˆ—åç§°ä¸º: direct_queue çš„æ¶ˆæ¯</span>
    <span class="token comment">// æ³¨æ„: æ•°ç»„ queues = {&quot;direct_queue&quot;, &quot;é˜Ÿåˆ—åç§°2&quot;, &quot;é˜Ÿåˆ—åç§°3&quot;, ...}</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ç›‘å¬direct_queueé˜Ÿåˆ— è·å–æ•°æ®æ—¶è°ƒç”¨è¯¥æ–¹æ³•</span>
    <span class="token comment">// String str å‚æ•° å‘é€æ¶ˆæ¯çš„å†…å®¹</span>
    <span class="token comment">// correlationId å‚æ•° å¯ç›´æ¥æ‹¿åˆ°é¢å¤–çš„æ•°æ®</span>
    <span class="token comment">// Message å‚æ•° å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
    <span class="token comment">// Channel channel å‚æ•° å¯è¿›è¡Œåº”ç­” å’Œ æ‹’ç»</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span>CORRELATION_ID<span class="token punctuation">)</span> <span class="token class-name">String</span> correlationId<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¯ç›´æ¥æ‹¿åˆ°é¢å¤–çš„æ•°æ®</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>correlationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
            <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// åº”ç­” ç­¾æ”¶</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‹’ç» åº”ç­” ä¸ç­¾æ”¶</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="ç¡®è®¤æ¶ˆæ¯å·²åˆ°è·¯ç”±å™¨"><a href="#ç¡®è®¤æ¶ˆæ¯å·²åˆ°è·¯ç”±å™¨" class="header-anchor">#</a> ç¡®è®¤æ¶ˆæ¯å·²åˆ°è·¯ç”±å™¨</h2> <p>RabbitMQ æœ‰ä¸€ä¸ªé…ç½®å±æ€§ <code>spring.rabbitmq.publisher-confirm-type</code> æ§åˆ¶æ˜¯å¦å¼€å¯ç¡®è®¤åŠŸèƒ½ã€‚è¯¥å±æ€§é»˜è®¤å€¼æ˜¯ <strong>NONE</strong> ï¼Œè¡¨ç¤ºä¸å¼€å¯æ¶ˆæ¯ç¡®è®¤ã€‚ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</p> <p><strong>é˜²å‘æŒ‡å—:</strong></p> <ul><li>ä½œç”¨äº ç”Ÿäº§æ–¹ åœ¨æ¶ˆæ¯ä¼ é€’æ—¶çš„ç›‘æµ‹ é‡åˆ°è·¯ç”±å™¨æˆ–è€…é˜Ÿåˆ—å¼‚å¸¸åˆ™å¯è¿›è¡Œå¯¹åº”çš„å›è°ƒ</li> <li>äº¤æ¢æœºçš„å›è°ƒ: ä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œå›è°ƒæ–¹æ³•</li> <li>å¦‚æœäº¤æ¢æœºå¯¹äº†é˜Ÿåˆ—ä¹Ÿå¯¹äº†ã€‚åˆ™åªä¼šæ‰§è¡Œè·¯ç”±å™¨å›è°ƒconfirmcallback</li> <li>å¦‚æœäº¤æ¢æœºé”™äº†ç‰©åªä¼šæ‰§è¡Œäº¤æ¢æœºçš„å›è°ƒconfirmcallback</li> <li>å¦‚æœäº¤æ¢æœºå¯¹äº†é˜Ÿåˆ—é”™äº†ï¼Œå…ˆæ‰§è¡Œé˜Ÿåˆ—çš„å›è°ƒreturncallback,å†æ‰§è¡Œäº¤æ¢æœºçš„å›è°ƒ</li></ul> <h3 id="yml-é…ç½®"><a href="#yml-é…ç½®" class="header-anchor">#</a> yml é…ç½®</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.174.133
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token comment">## æ¶ˆæ¯ç¡®è®¤é…ç½® é»˜è®¤ none | CORRELATED å¼‚æ­¥ | SIMPLE åŒæ­¥</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> SIMPLE
</code></pre></div><h3 id="correlated-å¼‚æ­¥"><a href="#correlated-å¼‚æ­¥" class="header-anchor">#</a> CORRELATED å¼‚æ­¥</h3> <ul><li>publisher-confirm-type = CORRELATED</li></ul> <blockquote><p>å½“æ”¹å±æ€§çš„å€¼ä¸º <strong>CORRELATED</strong> æ—¶ï¼Œè¡¨ç¤ºæ”¯æŒä»¥å¼‚æ­¥å›è°ƒæ–¹å¼è·å¾—ç¡®è®¤ä¸å¦çš„ä¿¡æ¯ã€‚</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// CORRELATED å¼‚æ­¥ | å¼€å¯å¼‚æ­¥åˆ™å‘é€æ¶ˆæ¯ä¼šç»§ç»­æ‰§è¡Œä¸‹æ–¹ç¨‹åºä¸ä¼šé˜»å¡</span>
    <span class="token comment">// è·¯ç”±å™¨å›è°ƒçš„æ–¹æ³•</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–å¤´æ•°æ®çš„id</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;item.add1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å¼‚æ­¥æµ‹è¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯• --- å¼€å¯å¼‚æ­¥åˆ™å‘é€æ¶ˆæ¯ä¼šç»§ç»­æ‰§è¡Œä¸‹æ–¹ç¨‹åºä¸ä¼šé˜»å¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="simple-åŒæ­¥"><a href="#simple-åŒæ­¥" class="header-anchor">#</a> SIMPLE åŒæ­¥</h3> <ul><li>publisher-confirm-type = SIMPLE</li></ul> <blockquote><p>å½“æ”¹å±æ€§çš„å€¼ä¸º SIMPLEæ—¶ï¼Œè¡¨ç¤ºæ”¯æŒä»¥ç®€å•ï¼ˆåŒæ­¥é˜»å¡ç­‰å¾…ï¼‰æ–¹å¼è·å¾—ç¡®è®¤ä¸å¦çš„ä¿¡æ¯ã€‚</p> <p>è¿™é‡Œä¼šè°ƒç”¨ Templateçš„waitForConfirmsæ–¹æ³•ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªè¦æ±‚ï¼Œå®ƒå¿…é¡»åœ¨ Template#invoke æ–¹æ³•ä¸­ä½¿ç”¨</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// SIMPLE åŒæ­¥ | å¼€å¯åŒæ­¥åˆ™å‘é€æ¶ˆæ¯ä¸ä¼šç»§ç»­æ‰§è¡Œä¸‹æ–¹ç¨‹åºä¼šé˜»å¡</span>
    <span class="token class-name">String</span> invoke <span class="token operator">=</span> rabbitTemplate<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitOperations<span class="token punctuation">.</span>OperationsCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doInRabbit</span><span class="token punctuation">(</span><span class="token class-name">RabbitOperations</span> operations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// å‘é€æ¶ˆæ¯</span>
                operations<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;item.add1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å¼‚æ­¥æµ‹è¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ç­‰å¾…äº”ç§’åœ¨æ‰§è¡Œ å¦‚æœè·¯ç”±å™¨æœªè·å–åˆ° åœ¨è¿”å›true åä¹‹false</span>
                <span class="token keyword">boolean</span> b <span class="token operator">=</span> operations<span class="token punctuation">.</span><span class="token function">waitForConfirms</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AmqpException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>invoke<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯• --- å¼€å¯åŒæ­¥åˆ™å‘é€æ¶ˆæ¯ä¸ä¼šç»§ç»­æ‰§è¡Œä¸‹æ–¹ç¨‹åºä¼šé˜»å¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ç¡®è®¤æ¶ˆæ¯å·²åˆ°æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ç¡®è®¤æ¶ˆæ¯å·²åˆ°æ¶ˆæ¯é˜Ÿåˆ—" class="header-anchor">#</a> ç¡®è®¤æ¶ˆæ¯å·²åˆ°æ¶ˆæ¯é˜Ÿåˆ—</h2> <h3 id="yml-é…ç½®-2"><a href="#yml-é…ç½®-2" class="header-anchor">#</a> yml é…ç½®</h3> <ul><li>spring.rabbitmq.publisher-returns=true</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.174.133
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token comment">## æ¶ˆæ¯ç¡®è®¤é…ç½® é»˜è®¤ none | CORRELATED å¼‚æ­¥ | SIMPLE åŒæ­¥</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> CORRELATED
    <span class="token comment">## å¼€å¯ æ¶ˆæ¯åˆ°é˜Ÿåˆ—çš„å›è°ƒ</span>
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="é˜Ÿåˆ—å›è°ƒ"><a href="#é˜Ÿåˆ—å›è°ƒ" class="header-anchor">#</a> é˜Ÿåˆ—å›è°ƒ</h3> <blockquote><p>é˜Ÿåˆ—çš„å›è°ƒ: åªæœ‰é˜Ÿåˆ—å‡ºç°é”™è¯¯æ—¶æ‰ä¼šæ‰§è¡Œè¯¥å›è°ƒæ–¹æ³•</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">quer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¼€å¯é˜Ÿåˆ—çš„å›è°ƒ</span>
    <span class="token comment">// å¼€å¯å¼ºåˆ¶é˜Ÿåˆ—å›è°ƒ: rabbitTemplate.setMandatory(true);</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// çŠ¶æ€ç : 312 å³ä¸ºå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—å¤±è´¥ key é”™è¯¯</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;çŠ¶æ€ç : &quot;</span> <span class="token operator">+</span> replyCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;7x.y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å¼‚æ­¥æµ‹è¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®©çº¿ç¨‹ä¿æŒè¿è¡Œ å¦åˆ™ä¼šå‡ºç° å› ä¸ºå¼‚æ­¥é€ æˆçº¿ç¨‹ç»“æŸä½†å›è°ƒè¿˜æ²¡ç»“æŸè€Œæ— æ³•æ‰“å°ç»“æœ</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="consumer-ack-åº”ç­”-2"><a href="#consumer-ack-åº”ç­”-2" class="header-anchor">#</a> Consumer ACK åº”ç­”</h2> <h3 id="yml-é…ç½®-3"><a href="#yml-é…ç½®-3" class="header-anchor">#</a> yml é…ç½®</h3> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.174.133
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token comment">## æ¶ˆæ¯ç¡®è®¤é…ç½® é»˜è®¤ none | CORRELATED å¼‚æ­¥ | SIMPLE åŒæ­¥</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> CORRELATED
    <span class="token comment">## å¼€å¯ æ¶ˆæ¯åˆ°é˜Ÿåˆ—çš„å›è°ƒ</span>
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token comment">## å¼€å¯æ‰‹åŠ¨åº”ç­”</span>
        <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> manual
        <span class="token comment">## é˜Ÿåˆ—æ¯æ¬¡æ‹‰å–æ¶ˆæ¯æ¬¡æ•°</span>
        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><h3 id="åº”ç­”ä¸æ‹’ç»"><a href="#åº”ç­”ä¸æ‹’ç»" class="header-anchor">#</a> åº”ç­”ä¸æ‹’ç»</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// æ³¨æ„å¯¼åŒ…: Channel channel</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
        <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åº”ç­” ç­¾æ”¶</span>
        channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‹’ç» åº”ç­” ç­¾æ”¶ | true é‡å‘ false ä¸é‡å‘ | æ¶ˆæ¯è¢«é˜Ÿåˆ—åˆ é™¤</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æ­»ä¿¡é˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—" class="header-anchor">#</a> æ­»ä¿¡é˜Ÿåˆ—</h2> <h3 id="æ­»ä¿¡é˜Ÿåˆ—æµç¨‹"><a href="#æ­»ä¿¡é˜Ÿåˆ—æµç¨‹" class="header-anchor">#</a> <strong>æ­»ä¿¡é˜Ÿåˆ—æµç¨‹:</strong></h3> <ul><li>æ¶ˆæ¯å‘é€: æ ¹æ®æ­£å¸¸çš„è·¯ç”±å™¨å’Œkeyå‘é€åˆ°æ³¨å†Œçš„é˜Ÿåˆ—</li> <li>æ¶ˆæ¯è½¬å‘æ­»ä¿¡è·¯ç”±å™¨: æ ¹æ®æ­£å¸¸é˜Ÿåˆ— ç»‘å®šçš„æ­»ä¿¡è·¯ç”±å™¨å’Œkey åœ¨æ­»ä¿¡ç»‘å®šæ–¹æ³•ä¸­è¿›è¡Œè½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—</li></ul> <h3 id="æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ-2"><a href="#æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ-2" class="header-anchor">#</a> **æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š **</h3> <ul><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ï¼›</li> <li>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼ŒbasicNack/basicReject,å¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—,requeue=falseï¼›</li> <li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼›</li></ul> <h3 id="æ­»ä¿¡ç»‘å®šå…³ç³»"><a href="#æ­»ä¿¡ç»‘å®šå…³ç³»" class="header-anchor">#</a> æ­»ä¿¡ç»‘å®šå…³ç³»</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DlxRabbitmqConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">// æ­£å¸¸è·¯ç”±å™¨</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;orderExchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">getTopicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;order_exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ­£å¸¸é˜Ÿåˆ— | éœ€è¦ä¸æ­»ä¿¡è·¯ç”±å™¨è¿›è¡Œç»‘å®š</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;orderQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;order_queue&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// ä¸æ­»ä¿¡è·¯ç”±å™¨è¿›è¡Œç»‘å®š</span>
            <span class="token punctuation">.</span><span class="token function">withArgument</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order_exchange_Dlx&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// key é”® | å¿…é¡»å’Œæ­»ä¿¡è·¯ç”±å™¨å’Œé˜Ÿåˆ—ç»‘å®šçš„keyä¸€è‡´</span>
            <span class="token punctuation">.</span><span class="token function">withArgument</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;dlx.xx&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// è®¾ç½® æ¶ˆæ¯ çš„è¿‡æœŸæ—¶é—´ è¿‡æœŸè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
            <span class="token punctuation">.</span><span class="token function">withArgument</span><span class="token punctuation">(</span><span class="token string">&quot;x-message-ttl&quot;</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span>
            <span class="token comment">// è®¾ç½® é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ è¶…è¿‡éƒ¨åˆ†ç›´æ¥è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
            <span class="token punctuation">.</span><span class="token function">withArgument</span><span class="token punctuation">(</span><span class="token string">&quot;x-max-length&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ­£å¸¸è·¯ç”±å™¨å’Œæ­£å¸¸é˜Ÿåˆ—è¿›è¡Œç»‘å®š</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">orderBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;orderExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;orderQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> orderQueue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;order.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ­»ä¿¡è·¯ç”±å™¨</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;orderExchangeDlx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">getTopicExchangeDlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;order_exchange_Dlx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ­»ä¿¡é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;orderQueueDlx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">getQueueDlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;order_queue_Dlx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ­»ä¿¡è·¯ç”±å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—ç»‘å®š</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">orderTtlBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;orderExchangeDlx&quot;</span><span class="token punctuation">)</span> <span class="token class-name">TopicExchange</span> orderDlxTopic<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;orderQueueDlx&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> orderDlxQueue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderDlxQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>orderDlxTopic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;dlx.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æœˆäº®æ´¾é›†"><a href="#æœˆäº®æ´¾é›†" class="header-anchor">#</a> ------- æœˆäº®æ´¾é›† -------</h2> <h2 id="rabbitmq-æ¶ˆæ¯çš„å°è£…"><a href="#rabbitmq-æ¶ˆæ¯çš„å°è£…" class="header-anchor">#</a> RabbitMQ æ¶ˆæ¯çš„å°è£…</h2> <h3 id="æ•°æ®çš„å°è£…å‘é€"><a href="#æ•°æ®çš„å°è£…å‘é€" class="header-anchor">#</a> æ•°æ®çš„å°è£…å‘é€</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// èµ‹å€¼é¢å¤–çš„æ•°æ® æ¶ˆè´¹æ–¹å¯è¿›è¡Œè°ƒç”¨è¯¥æ•°æ® é˜Ÿåˆ—å¯è°ƒç”¨</span>
<span class="token class-name">MessagePostProcessor</span> processor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessagePostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>Message</span> <span class="token function">postProcessMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AmqpException</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°è£…æ•°æ®</span>
        message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCorrelationId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// è¿™ä¸ª CorrelationData æ˜¯ç»™è·¯ç”±å™¨å’Œé˜Ÿåˆ—çš„å›è°ƒå¯è¿›è¡Œè°ƒç”¨</span>
<span class="token class-name">CorrelationData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å‘é€æ¶ˆæ¯ å’Œ å°è£…çš„æ•°æ®</span>
rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;è·¯ç”±å™¨åç§°&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;keyé”®&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ¶ˆæ¯&quot;</span><span class="token punctuation">,</span>processor<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å›è°ƒè°ƒç”¨æ•°æ®"><a href="#å›è°ƒè°ƒç”¨æ•°æ®" class="header-anchor">#</a> å›è°ƒè°ƒç”¨æ•°æ®</h3> <blockquote><p>å›è°ƒè°ƒç”¨ CorrelationData å°è£…çš„æ•°æ®</p></blockquote> <p>è·¯ç”±å™¨å›è°ƒè·å– CorrelationData å¤´æ•°æ® | ä¸ºå­—ç¬¦ä¸²ç±»å‹</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> messageId <span class="token operator">=</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>é˜Ÿåˆ—å›è°ƒè·å– MessagePostProcessor å¤´æ•°æ® | ä¸ºå­—ç¬¦ä¸²ç±»å‹</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MessageMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">CorrelationData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token comment">//åˆ›å»ºäº¤æ¢æœºå’Œé˜Ÿåˆ—</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> asdasdasd <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageMapper</span> messageMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;registor_exchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">getDirectExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">directExchange</span><span class="token punctuation">(</span><span class="token string">&quot;registor_exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;registor_queue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;registor_queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;registor_queue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span>
                              <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;registor_exchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Exchange</span> exchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;registor.add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¯è‡ªå®šä¹‰ rabbitTemplateé…ç½® ä¸”å¯è®¾ç½®è·¯ç”±å™¨å’Œé˜Ÿåˆ—çš„å›è°ƒ</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RabbitTemplate</span> <span class="token function">getRabbitTemplate</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RabbitTemplate</span> rabbitTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// äº¤æ¢æœºçš„å›è°ƒ</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">/**
             * @param correlationData  ç›¸å…³é…ç½®ä¿¡æ¯
             * @param ack è¡¨ç¤ºäº¤æ¢æœºæ˜¯å¦æˆåŠŸæ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼ŒtrueæˆåŠŸï¼Œfalse å¤±è´¥
             * @param s å¤±è´¥åŸå› ï¼Œå¦‚æœæˆåŠŸåˆ™è¯¥å‚æ•°å€¼ä¸ºâ€œâ€
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å– CorrelationData å¤´æ•°æ® | ä¸ºå­—ç¬¦ä¸²ç±»å‹</span>
                <span class="token class-name">String</span> messageId <span class="token operator">=</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é˜Ÿåˆ—çš„å›è°ƒ å›é€€æ¨¡å¼ï¼šå½“æ¶ˆæ¯å‘é€ç»™Exchangeï¼ŒExchangeè·¯ç”±åˆ°Queueå¤±è´¥æ—¶ï¼Œæ‰æ‰§è¡ŒReturnCallback</span>
        <span class="token comment">// å¼€å¯å›é€€æ¨¡å¼ï¼špublisher-returns=&quot;true&quot;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             *
             * @param message æ¶ˆæ¯å¯¹è±¡
             * @param replyCode é”™è¯¯ç 
             * @param replyText é”™è¯¯ä¿¡æ¯
             * @param exchange äº¤äº’åŠåç§°
             * @param routingKey è·¯ç”±é”®
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å– CorrelationData å¤´æ•°æ® | ä¸ºå­—ç¬¦ä¸²ç±»å‹</span>
                <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¶ˆè´¹æ–¹è°ƒç”¨æ•°æ®"><a href="#æ¶ˆè´¹æ–¹è°ƒç”¨æ•°æ®" class="header-anchor">#</a> æ¶ˆè´¹æ–¹è°ƒç”¨æ•°æ®</h3> <blockquote><p>æ¶ˆè´¹æ–¹å¯è°ƒç”¨ MessagePostProcessor å°è£…çš„é¢å¤–çš„æ•°æ®</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mylistener</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç›‘å¬ é˜Ÿåˆ—åç§°ä¸º: direct_queue çš„æ¶ˆæ¯</span>
    <span class="token comment">// æ³¨æ„: æ•°ç»„ queues = {&quot;direct_queue&quot;, &quot;é˜Ÿåˆ—åç§°2&quot;, &quot;é˜Ÿåˆ—åç§°3&quot;, ...}</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ç›‘å¬direct_queueé˜Ÿåˆ— è·å–æ•°æ®æ—¶è°ƒç”¨è¯¥æ–¹æ³•</span>
    <span class="token comment">// String str å‚æ•° å‘é€æ¶ˆæ¯çš„å†…å®¹</span>
    <span class="token comment">// correlationId å‚æ•° å¯ç›´æ¥æ‹¿åˆ°é¢å¤–çš„æ•°æ®</span>
    <span class="token comment">// Message å‚æ•° å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
    <span class="token comment">// Channel channel å‚æ•° å¯è¿›è¡Œåº”ç­” å’Œ æ‹’ç»</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span>CORRELATION_ID<span class="token punctuation">)</span> <span class="token class-name">String</span> correlationId<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¯ç›´æ¥æ‹¿åˆ°é¢å¤–çš„æ•°æ®</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>correlationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
            <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// str æ¶ˆæ¯çš„å†…å®¹</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// åº”ç­” ç­¾æ”¶</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‹’ç» åº”ç­” ä¸ç­¾æ”¶</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="ä¸­é—´ä»¶-æ€»æ±‡"><a href="#ä¸­é—´ä»¶-æ€»æ±‡" class="header-anchor">#</a> ä¸­é—´ä»¶ æ€»æ±‡</h2> <h3 id="åŸºç¡€å‚æ•°è¯¦è§£"><a href="#åŸºç¡€å‚æ•°è¯¦è§£" class="header-anchor">#</a> åŸºç¡€å‚æ•°è¯¦è§£</h3> <blockquote><p>åˆ›å»ºé˜Ÿåˆ—ï¼š</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">queveDeclare</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token keyword">boolean</span> durable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> exclusive<span class="token punctuation">,</span> <span class="token keyword">boolean</span> autoDelete r <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span>ï¼Œ<span class="token number">0</span>bject<span class="token operator">&gt;</span> arguments<span class="token punctuation">)</span>
<span class="token comment">// é˜Ÿåˆ—åå­—</span>
queue 
<span class="token comment">// è¿™ä¸ªé˜Ÿåˆ—æ˜¯å¦æœ‰æŒä¹…åŒ–ï¼Œä¸æ˜¯é˜Ÿåˆ—çš„æ•°æ®æ˜¯å¦æŒä¹…åŒ– trueè¡¨ç¤ºè¦æŒä¹…åŒ–</span>
durable 
<span class="token comment">// è¿™ä¸ªæ˜¯å¦å°¼ç‹¬å é˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€… trueè¡¨ç¤ºæ˜¯ç‹¬å é˜Ÿåˆ—</span>
exclusive
<span class="token comment">// è¿™ä¸ªä»¥åˆ—å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼Œä¼šä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œtrue å°±æ˜¯è‡ªåŠ¨åˆ é™¤</span>
autoDelete
<span class="token comment">// æ•°æ®è¦ä¸è¦æŒä¹…åŒ–ï¼Œè¿™ä¸ªé£åˆ—çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´æ˜¯è€ä¹…ï¼Œè§„å®šè¿™ä¸ªé˜Ÿåˆ—åªèƒ½æ”¾å¤šå°‘æ¡æ•°æ®</span>
arguments
</code></pre></div><blockquote><p>åˆ›å»ºäº¤æ¢æœº:</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Exchange<span class="token punctuation">.</span>DeclareOk</span> <span class="token function">exchangeDecLare</span><span class="token punctuation">(</span><span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span>
<span class="token comment">// äº¤æ¢æœºçš„åç§°</span>
exchange<span class="token operator">:</span> 
<span class="token comment">// äº¤æ¢æœºç±»å‹</span>
type  
<span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>FANOUT å¹¿æ’­ <span class="token operator">|</span> DIRECT å®šå‘ <span class="token operator">|</span> TOPIC åˆ†é…ç¬¦
</code></pre></div><blockquote><p>äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„ç»‘å®š:</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span>string<span class="token punctuation">,</span> 0bject<span class="token punctuation">&gt;</span></span>
<span class="token comment">// é˜Ÿåˆ—åç§°</span>
queue
<span class="token comment">// äº¤æ¢æœºåç§°</span>
exchange
<span class="token comment">// è·¯ç”±çš„é”® å¦‚æœä¸ºå¹¿æ’­æ¨¡å¼fanout åˆ™ä¸ºç©º &quot; &quot;</span>
routingKey
<span class="token comment">// ç»‘å®šè§„åˆ™</span>
<span class="token number">0</span>bject
</code></pre></div><blockquote><p>æ¶ˆæ¯çš„å‘é€</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">,</span> <span class="token class-name">BasicProperties</span> props<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span>
<span class="token comment">// äº¤æ¢æœºçš„åå­—ï¼Œ å› ä¸ºæ¶ˆæ¯æ˜¯å…ˆå‘ç»™äº¤æ¢æœºï¼Œç„¶ååœ¨ç”±äº¤æ¢æœºè·¯ç”±åˆºAå‰‘çš„ã€‚å¦‚æœæ²¡æœ‰å†™äº¤æ¢æœºï¼Œåˆ™é»˜ä»¥ä¼šæœ‰--ä¸ªç©ºçš„äº¤æ¢æœº</span>
exchange 
<span class="token comment">// è·¯ç”±é”®ï¼Œå°±æ³è¯´il åˆ—é€šè¿‡è¿™ä¸ªé”®å’Œäº¤æ¢æœºå½¢æˆäº†ç»‘å®šå…³ç³»ï¼Œå¦‚æœæ²¡ æœ‰è·¯ç”±éšï¼Œåˆ™è¿™froutingKeyè¦å’Œé£å¤–çš„åå­—- -æ ·</span>
routingKey
<span class="token comment">// æ¶ˆæ¯å±æ€§ï¼Œå¦‚æ¶ˆæ¯å†…å®¹ç¼–ç ï¼ŒæŠ•é€’æ¨¡å¼</span>
praps
<span class="token comment">// æ¶ˆæ¯å†…å®¹</span>
body
</code></pre></div><blockquote><p>æ¶ˆæ¯çš„æ¥æ”¶</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token keyword">boolean</span> autoAck<span class="token punctuation">,</span> <span class="token class-name">Consumer</span> callback<span class="token punctuation">)</span>
<span class="token comment">// é˜Ÿåˆ—åç§°</span>
queueï¼š
<span class="token comment">// æ˜¯å¦è‡ªåŠ¨ç¡®è®¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨ç¡®è®¤</span>
autoAck<span class="token operator">:</span> 
<span class="token comment">// ä¸Šæ–¹é‡å†™çš„æ–¹æ³•</span>
consumer<span class="token operator">:</span> 
</code></pre></div><blockquote><p>æ¶ˆæ¯çš„æ¥æ”¶æ—¶çš„å›è°ƒ</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span>
                           <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span>
<span class="token comment">// æ¶ˆæ¯è€…æ ‡ç­¾</span>
consumerTag
<span class="token comment">// è·¯ç”±keyä¸º</span>
envelope<span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// äº¤æ¢æœºä¸º</span>
envelope<span class="token punctuation">.</span><span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// æ¶ˆæ¯idä¸º</span>
envelope<span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// æ¥æ”¶åˆ°çš„æ¶ˆæ¯</span>
<span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="header-anchor">#</a> åŸºç¡€é…ç½®</h3> <h4 id="é˜²å‘æŒ‡å—"><a href="#é˜²å‘æŒ‡å—" class="header-anchor">#</a> é˜²å‘æŒ‡å—</h4> <ul><li><p>é˜Ÿåˆ—å’Œè·¯ç”±å™¨ä¸€æ—¦è¢«åˆ›å»º ç„¶åä¿®æ”¹äº†é…ç½® è¿›è¡Œæ¶ˆæ¯å‘é€ä¼šæŠ¥é”™ éœ€åˆ é™¤è·¯ç”±å™¨æˆ–è€…é˜Ÿåˆ— å†æ¬¡åˆ›å»º</p></li> <li><p>å¦‚æœç›‘å¬çš„é˜Ÿåˆ—ä¸å­˜åœ¨ åˆ™é¡¹ç›®æ— æ³•å¯åŠ¨ä¸”æŠ¥é”™</p></li> <li><p>ä¸¤ä¸ª å›è°ƒè·å–çš„é¢å¤–æ•°æ®åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ æ–¹æ³•è·å–</p></li> <li><p>æ‹’ç»ç­¾æ”¶åº”ç­” | ä¼šå°†æ¶ˆæ¯åœ¨é˜Ÿåˆ—é‡Œç›´æ¥åˆ é™¤</p></li></ul> <h4 id="rabbitmq-springä¾èµ–"><a href="#rabbitmq-springä¾èµ–" class="header-anchor">#</a> Rabbitmq-Springä¾èµ–</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--rabbitmq å®¢æˆ·ç«¯--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="application-yml-é…ç½®-2"><a href="#application-yml-é…ç½®-2" class="header-anchor">#</a> application.yml é…ç½®</h4> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Spring<span class="token punctuation">-</span>boot<span class="token punctuation">-</span>producer
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/k15<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;serverTimezone=UTC</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.174.133
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token comment">## è·¯ç”±å™¨æ¶ˆæ¯ç¡®è®¤é…ç½® ç”Ÿäº§æ–¹ é»˜è®¤ none | CORRELATED å¼‚æ­¥ | SIMPLE åŒæ­¥</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> CORRELATED
    <span class="token comment">## å¼€å¯ æ¶ˆæ¯åˆ°é˜Ÿåˆ—çš„å›è°ƒ ç”Ÿäº§æ–¹</span>
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">listener</span><span class="token punctuation">:</span>
      <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token comment">## å¼€å¯æ‰‹åŠ¨åº”ç­” æ¶ˆè´¹æ–¹</span>
        <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> manual
        <span class="token comment">## é˜Ÿåˆ—æ¯æ¬¡æ‹‰å–æ¶ˆæ¯æ¬¡æ•° æ¶ˆè´¹æ–¹</span>
        <span class="token key atrule">prefetch</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><h4 id="è·¯ç”±å™¨çš„ç§ç±»"><a href="#è·¯ç”±å™¨çš„ç§ç±»" class="header-anchor">#</a> è·¯ç”±å™¨çš„ç§ç±»</h4> <div class="language-java extra-class"><pre class="language-java"><code>FANOUT å¹¿æ’­ <span class="token operator">|</span> DIRECT å®šå‘ <span class="token operator">|</span> TOPIC åˆ†é…ç¬¦
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
fanout å¹¿æ’­ <span class="token operator">|</span> direct å®šå‘ <span class="token operator">|</span> topic åˆ†é…ç¬¦
</code></pre></div><h4 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="header-anchor">#</a> å‚æ•°è¯´æ˜</h4> <p><strong>åˆ›å»ºé˜Ÿåˆ—å‚æ•°è¯´æ˜ï¼š</strong></p> <table><thead><tr><th>å‚æ•°</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td>name</td> <td>å­—ç¬¦ä¸²å€¼ï¼Œexchange çš„åç§°ã€‚</td></tr> <tr><td>durable</td> <td>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ queue æ˜¯å¦æŒä¹…åŒ–ã€‚ æŒä¹…åŒ–æ„å‘³ç€å½“ RabbitMQ é‡å¯åï¼Œè¯¥ queue æ˜¯å¦ä¼šæ¢å¤/ä»å­˜åœ¨ã€‚ å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œqueue çš„æŒä¹…åŒ–ä¸ç­‰äºå…¶ä¸­çš„æ¶ˆæ¯ä¹Ÿä¼šè¢«æŒä¹…åŒ–ã€‚</td></tr> <tr><td>exclusive</td> <td>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ queue æ˜¯å¦æ’å®ƒå¼ä½¿ç”¨ã€‚æ’å®ƒå¼ä½¿ç”¨æ„å‘³ç€ä»…å£°æ˜ä»–çš„è¿æ¥å¯è§/å¯ç”¨ï¼Œå…¶å®ƒè¿æ¥ä¸å¯è§/ä¸å¯ç”¨ã€‚</td></tr> <tr><td>autoDelete</td> <td>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“è¯¥ queue æ²¡â€œäººâ€ï¼ˆconnectionï¼‰ç”¨æ—¶ï¼Œæ˜¯å¦ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</td></tr></tbody></table> <p>ä¸æŒ‡å®š durableã€exclusive å’Œ autoDelete æ—¶ï¼Œé»˜è®¤ä¸º <em>true</em> ã€ <em>false</em> å’Œ <em>false</em> ã€‚è¡¨ç¤ºæŒä¹…åŒ–ã€éæ’å®ƒã€ä¸ç”¨è‡ªåŠ¨åˆ é™¤</p> <p><strong>åˆ›å»ºäº¤æ¢æœºå‚æ•°è¯´æ˜</strong></p> <table><thead><tr><th>å‚æ•°</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td>name</td> <td>å­—ç¬¦ä¸²å€¼ï¼Œexchange çš„åç§°ã€‚</td></tr> <tr><td>durable</td> <td>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ exchage æ˜¯å¦æŒä¹…åŒ–ã€‚ æŒä¹…åŒ–æ„å‘³ç€å½“ RabbitMQ é‡å¯åï¼Œè¯¥ exchange æ˜¯å¦ä¼šæ¢å¤/ä»å­˜åœ¨ã€‚</td></tr> <tr><td>autoDelete</td> <td>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“è¯¥ exchange æ²¡â€œäººâ€ï¼ˆqueueï¼‰ç”¨æ—¶ï¼Œæ˜¯å¦ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</td></tr></tbody></table> <blockquote><p>ä¸æŒ‡å®š durable å’Œ autoDelete æ—¶ï¼Œé»˜è®¤ä¸º <em><code>true</code></em> å’Œ <em><code>false</code></em> ã€‚è¡¨ç¤ºæŒä¹…åŒ–ã€ä¸ç”¨è‡ªåŠ¨åˆ é™¤</p></blockquote> <h4 id="boot-rabbitmq-å¸¸ç”¨æ–¹æ³•"><a href="#boot-rabbitmq-å¸¸ç”¨æ–¹æ³•" class="header-anchor">#</a> Boot-RabbitMQ å¸¸ç”¨æ–¹æ³•</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// åˆ›å»ºäº¤æ¢æœº name = &quot;æŒ‡å®šé…ç½®åç§°&quot;</span>
<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// æ–¹å¼ä¸€</span>
    <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">directExchange</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–¹å¼äºŒ</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆ›å»ºé˜Ÿåˆ— name = &quot;æŒ‡å®šé…ç½®åç§°&quot;</span>
<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// æ–¹å¼ä¸€</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–¹å¼äºŒ</span>
    <span class="token keyword">return</span>   <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®š</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Exchange</span> exchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;x.y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å‘é€æ¶ˆæ¯</span>
rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;è·¯ç”±å™¨&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;keyé”®&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ¶ˆæ¯å†…å®¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ¥æ”¶æ¶ˆæ¯ æ³¨æ„: æ•°ç»„{&quot;é˜Ÿåˆ—åç§°2&quot;, &quot;é˜Ÿåˆ—åç§°3&quot;, ...}</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;é˜Ÿåˆ—åç§°&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// æ¶ˆæ¯å†…å®¹</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ack-åº”ç­”"><a href="#ack-åº”ç­”" class="header-anchor">#</a> ACK åº”ç­”</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// æ³¨æ„å¯¼åŒ…: Channel channel</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>

<span class="token comment">// åº”ç­” ç­¾æ”¶</span>
channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‹’ç» åº”ç­” ç­¾æ”¶ | true é‡å‘ false ä¸é‡å‘ | éœ€è¦ try catch</span>
channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="æ¶ˆæ¯å‘é€çš„é¢å¤–æ•°æ®å°è£…"><a href="#æ¶ˆæ¯å‘é€çš„é¢å¤–æ•°æ®å°è£…" class="header-anchor">#</a> æ¶ˆæ¯å‘é€çš„é¢å¤–æ•°æ®å°è£…</h4> <h5 id="å‘é€æ¶ˆæ¯çš„é¢å¤–æ•°æ®å°è£…"><a href="#å‘é€æ¶ˆæ¯çš„é¢å¤–æ•°æ®å°è£…" class="header-anchor">#</a> å‘é€æ¶ˆæ¯çš„é¢å¤–æ•°æ®å°è£…</h5> <blockquote><p>åœ¨ç”Ÿäº§æ–¹ å‘é€æ¶ˆæ¯æ—¶ å¯ä»¥å°è£…é¢å¤–çš„æ•°æ®åˆ° é˜Ÿåˆ— ä»¥ä¾›æ¶ˆè´¹æ–¹è·å–è°ƒç”¨</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">shuju</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// CORRELATED å¼‚æ­¥ | å¼€å¯å¼‚æ­¥åˆ™å‘é€æ¶ˆæ¯ä¼šç»§ç»­æ‰§è¡Œä¸‹æ–¹ç¨‹åºä¸ä¼šé˜»å¡</span>

    <span class="token comment">// MessagePostProcessor(): ç”¨äºå°è£…é¢å¤–çš„æ•°æ® å¯åœ¨æ¶ˆè´¹æ–¹ Message å‚æ•° set è·å–å‘é€çš„å‚æ•°</span>
    <span class="token class-name">MessagePostProcessor</span> postProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessagePostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">postProcessMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AmqpException</span> <span class="token punctuation">{</span>
            <span class="token comment">// å°è£… setCorrelationId çš„å‚æ•°</span>
            message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCorrelationId</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ•°æ®æ˜¯é¢å¤–å°è£…æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> message<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// è·¯ç”±å™¨å›è°ƒçš„æ–¹æ³•</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–å¤´æ•°æ®çš„id ä¸ºå­—ç¬¦ä¸²ç±»å‹</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//é˜Ÿåˆ—çš„å›è°ƒ</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–å¤´æ•°æ®çš„id æ¶ˆæ¯çš„ID ä¸ºå­—ç¬¦ä¸²</span>
            <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ©ç”¨é‡è½½ åœ¨å‘é€æ¶ˆæ¯æ˜¯æ—¶å‘é€ postProcessorå°è£…çš„æ•°æ® å¯åœ¨æ¶ˆè´¹æ–¹è·å–</span>
    <span class="token comment">// CorrelationDataä¸ºå®¹å™¨å¯¹è±¡ å°è£…åˆ°å±æ€§åˆ°é˜Ÿåˆ—å¤´éƒ¨çš„æ•°æ® ä»…ä¾›å›è°ƒè°ƒç”¨è·å–</span>
    <span class="token class-name">CorrelationData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token string">&quot;å¤´æ•°æ®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;direct_exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;x.y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å¼‚æ­¥æµ‹è¯•&quot;</span><span class="token punctuation">,</span> postProcessor<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯• --- å¼€å¯å¼‚æ­¥åˆ™å‘é€æ¶ˆæ¯ä¼šç»§ç»­æ‰§è¡Œä¸‹æ–¹ç¨‹åºä¸ä¼šé˜»å¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®©çº¿ç¨‹ä¿æŒè¿è¡Œ å¦åˆ™ä¼šå‡ºç° å› ä¸ºå¼‚æ­¥é€ æˆçº¿ç¨‹ç»“æŸä½†å›è°ƒè¿˜æ²¡ç»“æŸè€Œæ— æ³•æ‰“å°ç»“æœ</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="é¢å¤–æ•°æ®çš„è·å–"><a href="#é¢å¤–æ•°æ®çš„è·å–" class="header-anchor">#</a> é¢å¤–æ•°æ®çš„è·å–</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>apai<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Header</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mylistener</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç›‘å¬direct_queueé˜Ÿåˆ— è·å–æ•°æ®æ—¶è°ƒç”¨è¯¥æ–¹æ³•</span>
    <span class="token comment">// String str å‚æ•° å‘é€æ¶ˆæ¯çš„å†…å®¹</span>
    <span class="token comment">// correlationId å‚æ•° å¯ç›´æ¥æ‹¿åˆ°é¢å¤–çš„æ•°æ®</span>
    <span class="token comment">// Message å‚æ•° å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
    <span class="token comment">// Channel channel å‚æ•° å¯è¿›è¡Œåº”ç­” å’Œ æ‹’ç»</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span>CORRELATION_ID<span class="token punctuation">)</span> <span class="token class-name">String</span> correlationId<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¯ç›´æ¥æ‹¿åˆ°é¢å¤–çš„æ•°æ®</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>correlationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¯æ ¹æ®getè·å–å‘é€çš„é¢å¤–å‚æ•°æ•°æ®</span>
            <span class="token class-name">String</span> messageId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// åº”ç­” ç­¾æ”¶</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‹’ç» åº”ç­” ç­¾æ”¶</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h2 id="rabbitmq-æ³¨è§£"><a href="#rabbitmq-æ³¨è§£" class="header-anchor">#</a> RabbitMQ æ³¨è§£</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// RabbitMqConfig ä½œç”¨ï¼šspringçš„é…ç½®ç±»ï¼Œç±»åˆ›å»ºé˜Ÿåˆ— | è·¯ç”±å™¨çš„é…ç½®æ³¨è§£ å±äºspring æ–°æ³¨è§£</span>
<span class="token annotation punctuation">@Configuration</span>

<span class="token comment">// å¯åŠ¨ç±» | å¯ä¸å†™ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ | å¼€å¯åŸºäºæ³¨è§£çš„RabbitMQæ¨¡å¼</span>
<span class="token annotation punctuation">@EnableRabbit</span>

<span class="token comment">// ç›‘å¬é˜Ÿåˆ—åç§°ä¸º: direct_queue çš„æ¶ˆæ¯ç„¶åæ‰§è¡Œä¸‹æ–¹æ–¹æ³• æ³¨æ„: æ•°ç»„{&quot;é˜Ÿåˆ—åç§°2&quot;, &quot;é˜Ÿåˆ—åç§°3&quot;, ...}</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;direct_queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// åœ¨@RabbitListenerå†™åœ¨ç±»ä¸Šä¸ºå‰æ åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š@RabbitListeneræ—¶ç›‘å¬æ¶ˆæ¯åæ‰§è¡Œè¯¥æ–¹æ³•</span>
<span class="token annotation punctuation">@RabbitHandler</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Renovamen/vuepress-theme-gungnir/edit/main/docs/posts/ä¸­é—´ä»¶/RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—.md" target="_blank" rel="noopener noreferrer"><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>
      åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ
    </a></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡ç¼–è¾‘äº:</span> <span class="time">2024/5/21 14:35:14</span></div></footer> <!----> <div class="pager"><a href="/Welcome/post/2021/01/26/nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" class="next">
    ä¸‹ä¸€ç¯‡<br> <span>
      Nginx åå‘ä»£ç†
    </span></a> <a href="/Welcome/post/2020/12/15/linux-%E7%B3%BB%E7%BB%9F/" class="previous">
    ä¸Šä¸€ç¯‡<br> <span>
      Linux åŸºç¡€
    </span></a></div> <!----></main> <ul class="catalog" style="top:0px !important;" data-v-86932056><li class="level-2 toc-link-rabbitmq-æ¶ˆæ¯é˜Ÿåˆ—å®‰è£…" data-v-86932056>RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—å®‰è£…</li><li class="level-3 toc-link-rabbitmq-serveræœåŠ¡å¯åŠ¨" data-v-86932056>rabbitmq-serveræœåŠ¡å¯åŠ¨</li><li class="level-3 toc-link-æ¶ˆæ¯ä¸­é—´ä»¶-ç®€ä»‹" data-v-86932056>æ¶ˆæ¯ä¸­é—´ä»¶ - ç®€ä»‹</li><li class="level-3 toc-link-rabbitmq-å¿«é€Ÿå…¥é—¨" data-v-86932056>RabbitMQ å¿«é€Ÿå…¥é—¨</li><li class="level-2 toc-link-rabbitmq-å·¥ä½œæ¨¡å¼" data-v-86932056>RabbitMQ å·¥ä½œæ¨¡å¼</li><li class="level-3 toc-link-work-queues-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼" data-v-86932056>Work queues å·¥ä½œé˜Ÿåˆ—æ¨¡å¼</li><li class="level-3 toc-link-è®¢é˜…æ¨¡å¼ç±»å‹" data-v-86932056>è®¢é˜…æ¨¡å¼ç±»å‹</li><li class="level-3 toc-link-å¹¿æ’­æ¨¡å¼" data-v-86932056>å¹¿æ’­æ¨¡å¼</li><li class="level-3 toc-link-routing-è·¯ç”±æ¨¡å¼" data-v-86932056>Routing è·¯ç”±æ¨¡å¼</li><li class="level-3 toc-link-topics-é€šé…ç¬¦æ¨¡å¼" data-v-86932056>Topics é€šé…ç¬¦æ¨¡å¼</li><li class="level-2 toc-link-spring" data-v-86932056>------- Spring -------</li><li class="level-2 toc-link-spring-æ•´åˆ-rabbitmq" data-v-86932056>Spring æ•´åˆ RabbitMQ</li><li class="level-3 toc-link-æ­å»ºç”Ÿäº§è€…å·¥ç¨‹" data-v-86932056>æ­å»ºç”Ÿäº§è€…å·¥ç¨‹</li><li class="level-4 toc-link-pom-æ–‡ä»¶" data-v-86932056>pom æ–‡ä»¶</li><li class="level-4 toc-link-rabbitmq-è¿æ¥ä¿¡æ¯" data-v-86932056>RabbitMQ è¿æ¥ä¿¡æ¯:</li><li class="level-4 toc-link-rabbitmq-é…ç½®" data-v-86932056>RabbitMQ é…ç½®:</li><li class="level-4 toc-link-test-æµ‹è¯•" data-v-86932056>test æµ‹è¯•</li><li class="level-3 toc-link-æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹" data-v-86932056>æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹</li><li class="level-4 toc-link-æ¶ˆæ¯æ‰“å°ç±»" data-v-86932056>æ¶ˆæ¯æ‰“å°ç±»:</li><li class="level-4 toc-link-ä¸šåŠ¡å±‚æ¨¡æ‹Ÿ" data-v-86932056>ä¸šåŠ¡å±‚æ¨¡æ‹Ÿ:</li><li class="level-4 toc-link-rabbitmq-é…ç½®-2" data-v-86932056>RabbitMQ é…ç½®:</li><li class="level-4 toc-link-test-æµ‹è¯•-2" data-v-86932056>test æµ‹è¯•</li><li class="level-2 toc-link-æ¶ˆæ¯çš„å¯é æŠ•é€’" data-v-86932056>æ¶ˆæ¯çš„å¯é æŠ•é€’</li><li class="level-3 toc-link-å¼‚å¸¸å›è°ƒ" data-v-86932056>å¼‚å¸¸å›è°ƒ</li><li class="level-3 toc-link-spring-rabbitmq-xml" data-v-86932056>spring-rabbitmq.xml</li><li class="level-3 toc-link-test-æµ‹è¯•-3" data-v-86932056>test æµ‹è¯•</li><li class="level-2 toc-link-consumer-ack-åº”ç­”" data-v-86932056>Consumer ACK åº”ç­”</li><li class="level-3 toc-link-æ¶ˆè´¹æ–¹çš„åº”ç­”" data-v-86932056>æ¶ˆè´¹æ–¹çš„åº”ç­”</li><li class="level-3 toc-link-spring-rabbitmq-xml-2" data-v-86932056>spring-rabbitmq.xml</li><li class="level-3 toc-link-ackmessagelistener-ä½¿ç”¨ç±»" data-v-86932056>ackMessageListener ä½¿ç”¨ç±»</li><li class="level-2 toc-link-æ¶ˆè´¹ç«¯é™æµ" data-v-86932056>æ¶ˆè´¹ç«¯é™æµ</li><li class="level-2 toc-link-ttl-æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ" data-v-86932056>TTL æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ</li><li class="level-4 toc-link-å›¾å½¢åŒ–è®¾ç½®" data-v-86932056>å›¾å½¢åŒ–è®¾ç½®</li><li class="level-4 toc-link-ä»£ç å®ç°" data-v-86932056>ä»£ç å®ç°</li><li class="level-2 toc-link-dlx-æ­»ä¿¡é˜Ÿåˆ—" data-v-86932056>DLX  æ­»ä¿¡é˜Ÿåˆ—</li><li class="level-3 toc-link-æµç¨‹" data-v-86932056>æµç¨‹:</li><li class="level-3 toc-link-æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ" data-v-86932056>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š</li><li class="level-3 toc-link-åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—" data-v-86932056>åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—</li><li class="level-2 toc-link-æ—¥å¿—ä¸ç›‘æ§" data-v-86932056>æ—¥å¿—ä¸ç›‘æ§</li><li class="level-3 toc-link-rabbitmqæ—¥å¿—" data-v-86932056>RabbitMQæ—¥å¿—</li><li class="level-3 toc-link-rabbitmqå¸¸ç”¨å‘½ä»¤" data-v-86932056>rabbitmqå¸¸ç”¨å‘½ä»¤</li><li class="level-2 toc-link-æ¶ˆæ¯è¿½è¸ª" data-v-86932056>æ¶ˆæ¯è¿½è¸ª</li><li class="level-3 toc-link-æ¶ˆæ¯è¿½è¸ª-firehose-äº†è§£" data-v-86932056>æ¶ˆæ¯è¿½è¸ª-Firehose(äº†è§£)</li><li class="level-3 toc-link-æ¶ˆæ¯è¿½è¸ª-rabbitmq-tracing" data-v-86932056>æ¶ˆæ¯è¿½è¸ª-rabbitmq_tracing</li><li class="level-2 toc-link-spring-boot" data-v-86932056>------- Spring Boot -------</li><li class="level-2 toc-link-spring-boot-æ•´åˆ-rabbitmq" data-v-86932056>Spring-Boot æ•´åˆ RabbitMQ</li><li class="level-3 toc-link-pom-xml" data-v-86932056>pom.xml</li><li class="level-3 toc-link-application-yml-é…ç½®" data-v-86932056>application.yml é…ç½®</li><li class="level-3 toc-link-rabbitmqconfig-åˆ›å»º" data-v-86932056>RabbitMqConfig  åˆ›å»º</li><li class="level-3 toc-link-è·¯ç”±å™¨-é˜Ÿåˆ—-å›è°ƒ" data-v-86932056>è·¯ç”±å™¨ | é˜Ÿåˆ— | å›è°ƒ</li><li class="level-3 toc-link-controller-å‘é€æ¶ˆæ¯" data-v-86932056>Controller å‘é€æ¶ˆæ¯</li><li class="level-3 toc-link-listener-æ¥æ”¶æ¶ˆæ¯" data-v-86932056>listener æ¥æ”¶æ¶ˆæ¯</li><li class="level-2 toc-link-ç¡®è®¤æ¶ˆæ¯å·²åˆ°è·¯ç”±å™¨" data-v-86932056>ç¡®è®¤æ¶ˆæ¯å·²åˆ°è·¯ç”±å™¨</li><li class="level-3 toc-link-yml-é…ç½®" data-v-86932056>yml é…ç½®</li><li class="level-3 toc-link-correlated-å¼‚æ­¥" data-v-86932056>CORRELATED å¼‚æ­¥</li><li class="level-3 toc-link-simple-åŒæ­¥" data-v-86932056>SIMPLE åŒæ­¥</li><li class="level-2 toc-link-ç¡®è®¤æ¶ˆæ¯å·²åˆ°æ¶ˆæ¯é˜Ÿåˆ—" data-v-86932056>ç¡®è®¤æ¶ˆæ¯å·²åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li class="level-3 toc-link-yml-é…ç½®-2" data-v-86932056>yml é…ç½®</li><li class="level-3 toc-link-é˜Ÿåˆ—å›è°ƒ" data-v-86932056>é˜Ÿåˆ—å›è°ƒ</li><li class="level-2 toc-link-consumer-ack-åº”ç­”-2" data-v-86932056>Consumer ACK åº”ç­”</li><li class="level-3 toc-link-yml-é…ç½®-3" data-v-86932056>yml é…ç½®</li><li class="level-3 toc-link-åº”ç­”ä¸æ‹’ç»" data-v-86932056>åº”ç­”ä¸æ‹’ç»</li><li class="level-2 toc-link-æ­»ä¿¡é˜Ÿåˆ—" data-v-86932056>æ­»ä¿¡é˜Ÿåˆ—</li><li class="level-3 toc-link-æ­»ä¿¡é˜Ÿåˆ—æµç¨‹" data-v-86932056>æ­»ä¿¡é˜Ÿåˆ—æµç¨‹:</li><li class="level-3 toc-link-æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ-2" data-v-86932056>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š</li><li class="level-3 toc-link-æ­»ä¿¡ç»‘å®šå…³ç³»" data-v-86932056>æ­»ä¿¡ç»‘å®šå…³ç³»</li><li class="level-2 toc-link-æœˆäº®æ´¾é›†" data-v-86932056>------- æœˆäº®æ´¾é›† -------</li><li class="level-2 toc-link-rabbitmq-æ¶ˆæ¯çš„å°è£…" data-v-86932056>RabbitMQ æ¶ˆæ¯çš„å°è£…</li><li class="level-3 toc-link-æ•°æ®çš„å°è£…å‘é€" data-v-86932056>æ•°æ®çš„å°è£…å‘é€</li><li class="level-3 toc-link-å›è°ƒè°ƒç”¨æ•°æ®" data-v-86932056>å›è°ƒè°ƒç”¨æ•°æ®</li><li class="level-3 toc-link-æ¶ˆè´¹æ–¹è°ƒç”¨æ•°æ®" data-v-86932056>æ¶ˆè´¹æ–¹è°ƒç”¨æ•°æ®</li><li class="level-2 toc-link-ä¸­é—´ä»¶-æ€»æ±‡" data-v-86932056>ä¸­é—´ä»¶ æ€»æ±‡</li><li class="level-3 toc-link-åŸºç¡€å‚æ•°è¯¦è§£" data-v-86932056>åŸºç¡€å‚æ•°è¯¦è§£</li><li class="level-3 toc-link-åŸºç¡€é…ç½®" data-v-86932056>åŸºç¡€é…ç½®</li><li class="level-4 toc-link-é˜²å‘æŒ‡å—" data-v-86932056>é˜²å‘æŒ‡å—</li><li class="level-4 toc-link-rabbitmq-springä¾èµ–" data-v-86932056>Rabbitmq-Springä¾èµ–</li><li class="level-4 toc-link-application-yml-é…ç½®-2" data-v-86932056>application.yml é…ç½®</li><li class="level-4 toc-link-è·¯ç”±å™¨çš„ç§ç±»" data-v-86932056>è·¯ç”±å™¨çš„ç§ç±»</li><li class="level-4 toc-link-å‚æ•°è¯´æ˜" data-v-86932056>å‚æ•°è¯´æ˜</li><li class="level-4 toc-link-boot-rabbitmq-å¸¸ç”¨æ–¹æ³•" data-v-86932056>Boot-RabbitMQ å¸¸ç”¨æ–¹æ³•</li><li class="level-4 toc-link-ack-åº”ç­”" data-v-86932056>ACK åº”ç­”</li><li class="level-4 toc-link-æ¶ˆæ¯å‘é€çš„é¢å¤–æ•°æ®å°è£…" data-v-86932056>æ¶ˆæ¯å‘é€çš„é¢å¤–æ•°æ®å°è£…</li><li class="level-5 toc-link-å‘é€æ¶ˆæ¯çš„é¢å¤–æ•°æ®å°è£…" data-v-86932056>å‘é€æ¶ˆæ¯çš„é¢å¤–æ•°æ®å°è£…</li><li class="level-5 toc-link-é¢å¤–æ•°æ®çš„è·å–" data-v-86932056>é¢å¤–æ•°æ®çš„è·å–</li><li class="level-2 toc-link-rabbitmq-æ³¨è§£" data-v-86932056>RabbitMQ æ³¨è§£</li></ul></div> <div class="search-page" data-v-60b9a85e><span class="search-close"><svg aria-hidden="true" width="34.56" height="34.56" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:2.16em;"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></span> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="menu-btn-container" data-v-413dbfb4 data-v-60b9a85e><div class="menu-btn-wrapper" data-v-413dbfb4><div class="menu-btn" data-v-413dbfb4><div class="menu-btn-icon" style="display:;" data-v-413dbfb4><span data-v-413dbfb4></span> <span data-v-413dbfb4></span> <span data-v-413dbfb4></span></div> <div class="menu-text" style="display:none;" data-v-413dbfb4>
        0
      </div> <svg class="menu-svg" data-v-413dbfb4><circle cx="50%" cy="50%" r="48%" class="menu-border" style="stroke-dasharray:0% 314.15926%;" data-v-413dbfb4></circle></svg></div> <div class="menu-btn-child-wrapper" data-v-413dbfb4><a role="button" aria-label="Toggle light" title="Toggle light" class="toggle-mode menu-btn-child" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></a> <div class="menu-btn-child" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div> <div class="menu-btn-child" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div> <div class="menu-btn-child menu-toc-btn" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div> <div class="menu-btn-child menu-btn-sidebar" data-v-413dbfb4><svg aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor" class="ov-icon" style="font-size:1.2em;" data-v-413dbfb4><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div> <div class="footer-wrapper footer" data-v-2f609db5 data-v-60b9a85e><span data-v-2f609db5>
      &copy; <a href="https://luisapai.gitee.io/" target="_blank">æ˜¯é˜¿æ´¾å•Š! </a> 2000 - 2024
      <br>
      ç¥æˆ‘ä»¬ - <a href="https://vuepress.vuejs.org" target="_blank">å¹³å®‰å–œä¹</a> &
      <a href="https://github.com/Renovamen/vuepress-theme-gungnir/tree/v0" target="_blank">ä¸‡äº‹é¡ºé‚</a>
    </span></div></div><div class="global-ui"></div></div>
    <script src="/Welcome/assets/js/app.e8bc5df0.js" defer></script><script src="/Welcome/assets/js/8.d7055a2e.js" defer></script><script src="/Welcome/assets/js/1.ed48a7ee.js" defer></script><script src="/Welcome/assets/js/2.9a3f7cc9.js" defer></script><script src="/Welcome/assets/js/53.a4f3a63f.js" defer></script>
  </body>
</html>
