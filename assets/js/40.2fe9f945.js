(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{515:function(t,s,a){"use strict";a.r(s);var n=a(65),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"docker-远程访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-远程访问"}},[t._v("#")]),t._v(" Docker 远程访问")]),t._v(" "),a("ul",[a("li",[t._v("建议增加证书连接 安全 | 没有密码暴露端口很危险")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/hanxiaotongtong/article/details/124240589",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker 远程访问参考")])])]),t._v(" "),a("h3",{attrs:{id:"配置-docker-设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker-设置"}},[t._v("#")]),t._v(" 配置 Docker 设置")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 修改配置文件vim /usr/lib/systemd/system/docker.service，这是开启docker远程访问服务的第一步。0.0.0.0:2375表示在当前主机上所有网卡监听2375端口。修改ExecStart这行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375  -H unix:///var/run/docker.sock  --containerd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/run/containerd/containerd.sock\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 重新加载配置文件，并重启docker守护进程")]),t._v("\nsystemctl daemon-reload "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl restart docker\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3. 查看端口是否开启,有一行记录显示2375端口被监听，即正确 或者通过浏览器访问http://<docker宿主机ip>:2375/info也可以进行验证,有响应结果即正确，返回的是一个JSON的docker服务状态及配置信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" -nptl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2375")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nhttp://175.178.126.61:1011/info\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4. 需要注意的是如果你的服务器上防火墙没有开放2375端口访问，请使用下面的命令开放2375端口(注意：下面的命令行适用于CentOS7、8发行版，如果你是其他的linux发行版，命令可能不一样)。")]),t._v("\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2375")]),t._v("/tcp --permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置开放端口")]),t._v("\nfirewall-cmd --reload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重新加载配置")]),t._v("\n")])])]),a("h3",{attrs:{id:"设置-idea-连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-idea-连接"}},[t._v("#")]),t._v(" 设置 IDEA 连接")]),t._v(" "),a("ul",[a("li",[t._v("在IDEA服务下进行配置Docker连接设置")]),t._v(" "),a("li",[t._v("TCP连接: 服务器的IP地址和Docker远程连接端口")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20230322155327956.png",alt:"image-20230322155327956"}})]),t._v(" "),a("h2",{attrs:{id:"docker-远程证书访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-远程证书访问"}},[t._v("#")]),t._v(" Docker 远程证书访问")]),t._v(" "),a("ul",[a("li",[t._v("开启证书校验远程连接比较安全 避免被黑挖矿 PS:亲身经历服务器差点被封了")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/qq_34626094/article/details/130579470",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker 远程证书访问")]),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/jimbooks/article/details/98037922",target:"_blank",rel:"noopener noreferrer"}},[t._v("执行脚本格式报错参考")])])]),t._v(" "),a("h3",{attrs:{id:"创建证书脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建证书脚本"}},[t._v("#")]),t._v(" 创建证书脚本")]),t._v(" "),a("p",[t._v("1.创建脚本")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建脚本文件 ca.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" ca.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置文件权限 设置为可执行脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" ca.sh 或者 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x ca.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果在运行脚本报错: [:No such file or directory] ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 表示: Windows环境下dos格式文件传输到unix系统时,会在每行的结尾多一个^M，所以在执行的时候出现了这种现象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/\\r$//'")]),t._v("  ca.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行脚本 会自动生成证书 存储在脚本设置的目录下 如下图")]),t._v("\n./ca.sh\n")])])]),a("p",[t._v("2.脚本内容")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要的配置设置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ip")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("175.178")]),t._v(".126.61  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你的IP")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1120")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#你的密码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("dir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/DockerCa/CaFile  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书生成位置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("validity_period")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书有效期10年")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将此shell脚本在安装docker的机器上执行，作用是生成docker远程连接加密证书")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v(' , not dir , will create"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v(' , dir exist , will delete and create"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建根证书RSA私钥")]),t._v("\nopenssl genrsa -aes256 -passout pass:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$password")]),t._v('"')]),t._v(" -out ca-key.pem "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建CA证书")]),t._v("\nopenssl req -new -x509 -days "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$validity_period")]),t._v(" -key ca-key.pem -passin pass:"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$password")]),t._v('"')]),t._v(" -sha256 -out ca.pem -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/C=NL/ST=./L=./O=./CN='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建服务端私钥")]),t._v("\nopenssl genrsa -out server-key.pem "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建服务端签名请求证书文件")]),t._v("\nopenssl req -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")]),t._v('"')]),t._v(" -sha256 -new -key server-key.pem -out server.csr\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" subjectAltName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IP:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ip")]),t._v(",IP:0.0.0.0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("extfile.cnf\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" extendedKeyUsage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serverAuth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("extfile.cnf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建签名生效的服务端证书文件")]),t._v("\nopenssl x509 -req -days "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$validity_period")]),t._v(" -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem -passin "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pass:'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$password")]),t._v('"')]),t._v(" -CAcreateserial -out server-cert.pem -extfile extfile.cnf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建客户端私钥")]),t._v("\nopenssl genrsa -out key.pem "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建客户端签名请求证书文件")]),t._v("\nopenssl req -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/CN=client'")]),t._v(" -new -key key.pem -out client.csr\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" extendedKeyUsage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" clientAuth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("extfile.cnf\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" extendedKeyUsage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" clientAuth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("extfile-client.cnf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建签名生效的客户端证书文件")]),t._v("\nopenssl x509 -req -days "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$validity_period")]),t._v(" -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem -passin "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pass:'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$password")]),t._v('"')]),t._v(" -CAcreateserial -out cert.pem -extfile extfile-client.cnf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除多余文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -f -v client.csr server.csr extfile.cnf extfile-client.cnf\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -v 0400 ca-key.pem key.pem server-key.pem\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -v 0444 ca.pem server-cert.pem cert.pem\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230614085518129.png",alt:"image-20230614085518129"}})]),t._v(" "),a("h3",{attrs:{id:"配置-docker-设置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker-设置-2"}},[t._v("#")]),t._v(" 配置 Docker 设置")]),t._v(" "),a("p",[t._v("1.修改Docker配置文件")]),t._v(" "),a("ul",[a("li",[t._v("配置文件  vim /usr/lib/systemd/system/docker.service")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("notify\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the default is not to use systemd for cgroups because the delegate issues still")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# exists and systemd currently does not support the cgroup feature set required")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for containers run by docker")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认设置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定证书: 注意证书的目录位置 -H | 特别注意该段不能换行只能一行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tcp://0.0.0.0:1010: 设置的远程端口为1010 注意开放其端口 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/bin/dockerd --tlsverify --tlscacert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/DockerCa/CaFile/ca.pem --tlscert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/DockerCa/CaFile/server-cert.pem --tlskey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/DockerCa/CaFile/server-key.pem -H fd:// --containerd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/run/containerd/containerd.sock -H tcp://0.0.0.0:1010\n")])])]),a("p",[t._v("2.刷新配置 重启Docker")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新加载配置文件，并重启docker守护进程")]),t._v("\nsystemctl daemon-reload "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl restart docker\n")])])]),a("p",[t._v("3.测试连接方法")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器本机测试(先CD进入证书文件夹)：")]),t._v("\ndocker --tlsverify --tlscacert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ca.pem --tlscert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cert.pem --tlskey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("key.pem -H tcp://你的ip:2376 -v\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个人终端测试：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://你的ip:1010/info --cert /root/docker/cert/cert.pem --key /root/docker/cert/key.pem --cacert /root/docker/cert/ca.pem\n")])])]),a("h3",{attrs:{id:"设置-idea-连接-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-idea-连接-2"}},[t._v("#")]),t._v(" 设置 IDEA 连接")]),t._v(" "),a("p",[t._v("1.下载证书文件")]),t._v(" "),a("ul",[a("li",[t._v("下载证书文件到win本机文件夹下 后续连接使用")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230614090548535.png",alt:"image-20230614090548535"}})]),t._v(" "),a("p",[t._v("2.IDEA 连接")]),t._v(" "),a("ul",[a("li",[t._v("在IDEA服务下进行配置Docker连接设置")]),t._v(" "),a("li",[t._v("TCP连接: 服务器的IP地址和Docker远程连接端口 + 证书的目录地址")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230614090916302.png",alt:"image-20230614090916302"}})]),t._v(" "),a("h2",{attrs:{id:"docker-问题补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-问题补充"}},[t._v("#")]),t._v(" Docker 问题补充")]),t._v(" "),a("h3",{attrs:{id:"使用docker命令报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker命令报错"}},[t._v("#")]),t._v(" 使用Docker命令报错")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_38641128/article/details/127939990",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考一")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止 Docker")]),t._v("\nsystemctl stop docker\nsystemctl stop docker.socket\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动 Docker")]),t._v("\nsystemctl start docker\n")])])]),a("h2",{attrs:{id:"idea-dockerfile-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#idea-dockerfile-部署"}},[t._v("#")]),t._v(" IDEA Dockerfile 部署")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("已经远程连接好了服务器的Docker服务")])])]),t._v(" "),a("h3",{attrs:{id:"项目配置docker插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目配置docker插件"}},[t._v("#")]),t._v(" 项目配置Docker插件")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Pom.xml 的 plugin 插件")])])]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--使用docker-maven-plugin插件 可根据Dockerfile进行远程一键部署--\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.spotify"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("docker-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("0.4.13"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- made of '[a-z0-9-_.]' --\x3e")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("imageName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.artifactId}:${project.version}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("imageName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dockerDirectory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.basedir}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dockerDirectory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("resource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("targetPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("/"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("targetPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.build.directory}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.build.finalName}.jar"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("resource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"dockerfile-脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-脚本"}},[t._v("#")]),t._v(" Dockerfile 脚本")]),t._v(" "),a("ul",[a("li",[t._v("需跟 pom.xml 文件同级 [否则修改脚本jar目录-不建议]")]),t._v(" "),a("li",[t._v("在运行前注意: "),a("strong",[t._v("进行打包保障target内有jar包 以及 修改 jar包匹配符")])])]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定基础镜像，在其上进行定制 (FROM java:8 弃用) 注意:镜像过于精简没有字体easyexcel在导出时会报错")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#FROM openjdk:8-jre-slim")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此镜像包含了easyexcel所需要的字体文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" frolvlad/alpine-java:jdk8-slim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 维护者信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MAINTAINER")]),t._v(" Your Name <2386297795@QQ.com>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置环境变量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" PARAMS="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" TZ=PRC")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -snf /usr/share/zoneinfo/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" /etc/localtime && echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" > /etc/timezone")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重命名 jar 文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" target/aftersaleserver-*.jar /KaiYun-App/aftersaleserverApp.jar")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 设置工作目录为 JAR 文件的目录 | System.getProperty("user.dir")) 指定的工作目录')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /KaiYun-App")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 3001")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置最大运行内存为256mb")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" JAVA_OPTS="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Xmx256m"')])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 指定容器启动程序及参数 ENTRYPOINT ["cmd命令"]')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/KaiYun-App/aftersaleserverApp.jar"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--server.port=3001"')]),t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 备用: CMD java -jar $JAVA_OPTS /app.jar --server.port=$SERVER_PORT $PARAMS")]),t._v("\n")])])]),a("h3",{attrs:{id:"配置-docker-容器端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker-容器端口"}},[t._v("#")]),t._v(" 配置 Docker 容器端口")]),t._v(" "),a("ul",[a("li",[t._v("项目的jar包重新命名为app.jar 在容器的根目录下")]),t._v(" "),a("li",[a("strong",[t._v("默认生成的容器没有跟主服务器 映射端口 需手动添加")])]),t._v(" "),a("li",[t._v("访问:  http://175.178.126.61:1060/china/getChinaListTree")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230616141425875.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230614162420037.png",alt:"image-20230614162420037"}})]),t._v(" "),a("h2",{attrs:{id:"nginx-dockerfile-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-dockerfile-部署"}},[t._v("#")]),t._v(" Nginx Dockerfile 部署")]),t._v(" "),a("h3",{attrs:{id:"nginx-脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-脚本"}},[t._v("#")]),t._v(" Nginx 脚本")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基础镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" nginx")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 维护者信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MAINTAINER")]),t._v(" Apai-Lu")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -snf /usr/share/zoneinfo/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" /etc/localtime && echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" > /etc/timezone")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 暴露端口 1050:80 访问地址为:http://localhost:1050 (这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 1050")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制conf文件到路径 替换 nginx.conf 文件配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./conf/nginx.conf /etc/nginx/nginx.conf")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制html文件到路径 根据配置文件配置的路径将以后的请求转发到这个路径下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./html/dist /home/apai-web")]),t._v("\n")])])]),a("h3",{attrs:{id:"nginx-说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-说明"}},[t._v("#")]),t._v(" Nginx 说明")]),t._v(" "),a("blockquote",[a("p",[t._v("目录结构")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("nginx\n\tconf\n\t\tnginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// nginx 的配置文件, 修改后会覆盖镜像原有的")]),t._v("\n\thtml\n\t\tdist "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 前端打包文件, 会根据dockerfile复制到容器里")]),t._v("\ndockerfile "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行会根据命令创建容器")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("nginx.conf 配置文件")])]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[t._v("worker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    server {\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问端口")]),t._v("\n        listen       80;\n        server_name  localhost;\n\n        location / {\n    \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定前端打包文件路径 根据dockerfile的配置")]),t._v("\n            root   /home/apai-web;\n            try_files $uri $uri/ /index.html;\n            index  index.html index.htm;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230630093241935.png",alt:"image-20230630093241935"}})]),t._v(" "),a("h2",{attrs:{id:"compose-服务编排"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-服务编排"}},[t._v("#")]),t._v(" Compose 服务编排")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/menxu_work/article/details/125738386",target:"_blank",rel:"noopener noreferrer"}},[t._v("Compose 服务编排参考")]),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/WuDan_1112/article/details/125878728",target:"_blank",rel:"noopener noreferrer"}},[t._v("基础参考")])])]),t._v(" "),a("h3",{attrs:{id:"compose-概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-概述"}},[t._v("#")]),t._v(" Compose 概述")]),t._v(" "),a("ul",[a("li",[t._v("Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排")]),t._v(" "),a("li",[t._v("docker-compose是基于docker的编排工具，使容器的操作能够批量的，可视的执行，是一个管理多个容器的工具")])]),t._v(" "),a("p",[a("strong",[t._v("Compose有2个重要的概念：")])]),t._v(" "),a("ul",[a("li",[t._v("项目（Project）：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。")]),t._v(" "),a("li",[t._v("服务（Service）：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。")])]),t._v(" "),a("p",[a("strong",[t._v("使用Compose 基本上分为三步：")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Dockerfile   定义应用的运行环境")])]),t._v(" "),a("li",[a("p",[t._v("docker-compose.yml 定义组成应用的各服务")])]),t._v(" "),a("li",[a("p",[t._v("docker-compose up 启动整个应用")])])]),t._v(" "),a("h3",{attrs:{id:"compose-微服务编排"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-微服务编排"}},[t._v("#")]),t._v(" Compose 微服务编排")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker-Compose.yml 构建 MySQL 服务")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Apai-MySql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Apai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("MySql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的镜像版本")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8.0.25\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的构建上下文")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./mysql\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的端口映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1051:3306"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的数据卷映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes:")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./mysql/conf:/etc/mysql/conf.d")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./mysql/logs:/logs")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./mysql/data:/var/lib/mysql")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的环境变量")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysqld'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--innodb-buffer-pool-size=80M'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--character-set-server=utf8mb4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--collation-server=utf8mb4_unicode_ci'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--default-time-zone=+8:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--lower-case-table-names=1'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的需要创建数据库名称")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_DATABASE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'apai-cloud'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySql 的默认ROOT账号的密码")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker-Compose.yml 构建 Nacos 服务: http://175.178.126.61:1052/nacos [账号密码: nacos/nacos]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Apai-Nacos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nacos 的容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Apai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Nacos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.4.1\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nacos 的镜像版本")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nacos/nacos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1.4.1\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nacos 的构建上下文")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./nacos\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nacos 的环境变量")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MODE=standalone\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nacos 的数据卷映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes:")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./nacos/logs/:/home/nacos/logs")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./nacos/conf/application.properties:/home/nacos/conf/application.properties")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nacos 的端口映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1052:8848"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker-Compose.yml 构建 Redis 服务")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Apai-Redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Redis 的容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Apai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Redis 的镜像版本")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Redis 的构建上下文")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./redis\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Redis 的端口映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1053:6379"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Redis 的数据卷映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes:")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./redis/conf/redis.conf:/home/ruoyi/redis/redis.conf")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./redis/data:/data")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# command: redis-server /home/ruoyi/redis/redis.conf")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker-Compose.yml 构建 Nginx 服务：http://175.178.126.61:1054/")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Apai-Nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nginx 的容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Apai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Nginx\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nginx 的镜像版本")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nginx 的构建上下文")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./nginx\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nginx 的端口映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1054:80"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nginx 的数据卷映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes:")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./nginx/html/dist:/home/ruoyi/projects/ruoyi-ui")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./nginx/conf/nginx.conf:/etc/nginx/nginx.conf")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./nginx/logs:/var/log/nginx")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - ./nginx/conf.d:/etc/nginx/conf.d")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker-Compose.yml 构建 Rabbitmq 服务: http://175.178.126.61:1056/#/")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Apai-Rabbitmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Rabbitmq 的容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Apai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Rabbitmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.7.25\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Rabbitmq 的镜像版本")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3.7.25"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("management\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes:")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - /mydata/rabbitmq/data:/var/lib/rabbitmq #数据文件挂载")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - /mydata/rabbitmq/log:/var/log/rabbitmq #日志文件挂载")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 1055"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 1056"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 环境变量 user:pass -> 账号:密码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("RABBITMQ_DEFAULT_VHOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("RABBITMQ_DEFAULT_USER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("RABBITMQ_DEFAULT_PASS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n")])])]),a("h3",{attrs:{id:"compose-部署-jar-包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-部署-jar-包"}},[t._v("#")]),t._v(" Compose 部署 Jar 包")]),t._v(" "),a("ul",[a("li",[t._v("Docker-Compose.yml 配合 Dockerfile(详情可参考上方) 实现")]),t._v(" "),a("li",[t._v("启动名称不能大写 可能报错 (jar包部署踩坑)")]),t._v(" "),a("li",[t._v("build 的路径不能错 (指定到项目的dockerfile目录下)")])]),t._v(" "),a("blockquote",[a("p",[t._v("Docker-Compose.yml")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker-Compose.yml 构建部署 jar包 服务(启动名称不能大写可能报错)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app-wx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wxgzhapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定上下文 和 dockerfile")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上下文: 注意Docker-Compose.yml路径开始指定到dockerfile目录下")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ../service/wxgzhapp\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Dockerfile 文件名称")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口映射 主机:容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1081:8004"')]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("Dockerfile 配置jar包部署文件")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("# 指定基础镜像，在其上进行定制 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FROM java"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" 弃用"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFROM openjdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jre"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("slim\n# 维护者信息\nMAINTAINER "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Your")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2386297795")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@QQ.com")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n# 设置环境变量\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ENV")]),t._v(" PARAMS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ENV")]),t._v(" TZ"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PRC\n# 设置时区\nRUN ln "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("snf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zoneinfo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$TZ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" echo $TZ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("timezone\n# 设置时区\nADD target"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("wxgzhapp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\n# 声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1081")]),t._v("\n# 指定容器启动程序及参数 ENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cmd命令"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--server.port=8004"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n# 备用"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CMD java "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jar $JAVA_OPTS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("$SERVER_PORT $PARAMS\n\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230703145632668.png",alt:"image-20230703145632668"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);