(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{532:function(a,t,s){"use strict";s.r(t);var n=s(65),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("Nacos  启动即为注册中心 无需创建项目 制作注册中心 只需将微服务注册即可")]),a._v(" "),s("p",[a._v("nacos 的默认服务端口是 "),s("strong",[a._v("8848")]),a._v(" ，启动完成之后通过浏览器访问 nacos：http://127.0.0.1:8848/nacos 。")]),a._v(" "),s("p",[a._v("默认的账号 密码: nacos")])]),a._v(" "),s("h2",{attrs:{id:"nacos-注册-步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-注册-步骤"}},[a._v("#")]),a._v(" Nacos 注册 步骤")]),a._v(" "),s("h3",{attrs:{id:"nacos-依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-依赖"}},[a._v("#")]),a._v(" Nacos  依赖")]),a._v(" "),s("p",[a._v("注意引入依赖时 选择 Nacos Service Discovery 且 还要对应的版本 可引入父项目")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!--Nacos 自动注册依赖--\x3e")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-discovery"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("h3",{attrs:{id:"nacos-注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-注解"}},[a._v("#")]),a._v(" Nacos  注解")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ---- 启动类 ----")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 启用 nacos 的服务发现")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableDiscoveryClient")]),a._v(" \n")])])]),s("h2",{attrs:{id:"nacos-配置中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-配置中心"}},[a._v("#")]),a._v(" Nacos  配置中心")]),a._v(" "),s("p",[a._v("Nacos 作为配置管理中心，实现的核心功能就是配置的统一管理。")]),a._v(" "),s("h3",{attrs:{id:"nacos-配置中心-注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-配置中心-注解"}},[a._v("#")]),a._v(" Nacos 配置中心 注解")]),a._v(" "),s("blockquote",[s("p",[a._v("添加 "),a._v(" 注解")])]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!--Nacos 配置文件存放注册中心--\x3e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-config"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("h3",{attrs:{id:"新建配置文件-bootstrap-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建配置文件-bootstrap-yml"}},[a._v("#")]),a._v(" 新建配置文件 bootstrap.yml")]),a._v(" "),s("p",[a._v("新增 "),s("strong",[a._v("spring.cloud.nacos.config")]),a._v(" 节点配置，将服务指向正确的 nacos 服务端。")]),a._v(" "),s("blockquote",[s("p",[a._v("注意:")]),a._v(" "),s("p",[a._v("Spring Cloud Config 一样，连接配置中心的配置信息『"),s("strong",[a._v("必须")]),a._v("』写在 "),s("strong",[a._v("bootstrap.yml")]),a._v(" 配置文件中，而不是 application 配置文件中。"),s("strong",[a._v("bootstrap")]),a._v(" 优先级高于apllication")]),a._v(" "),s("p",[a._v("配置文件中只保留 nacos 相关的配置即可，其他的配置放到 nacos 中统一管理。")])]),a._v(" "),s("p",[s("strong",[a._v("防坑指南")])]),a._v(" "),s("ul",[s("li",[a._v("端口 还是写在 项目的配置文件里 因为在 Nacos 里改变端口会动态更改 但是不会时项目重新启动")]),a._v(" "),s("li",[a._v("端口和数据库在进行动态修改时 项目是不会重启的 所有要使配置生效还是要重启项目")]),a._v(" "),s("li",[a._v("指定在不同环境下的配置 如: dev  在Nacos的配置文件的 ID 一定要规范")]),a._v(" "),s("li",[a._v("共同开发 在注册nacos的时候可能导致注册的ip地址被其他的代理而不是项目的ip 所以需指定ip前缀")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 服务名\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("profiles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定 Nacos 在不同环境下的配置")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置分组。未配置时，默认分组是 DEFAULT_GROUP")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" XXX_GROUP  \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("spring.cloud.nacos.discovery.server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nacos 配置文件后缀。注意是 yaml，不是 yml")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml\n        \n        \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 共同开发 在注册nacos的时候可能导致注册的ip地址被其他的代理而不是项目的ip 所以需指定ip前缀")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 192.172.0.18"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("spring.cloud.nacos.discovery.server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定注册到nacos的前缀")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("inetutils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("preferred-networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 192.168.10\n")])])]),s("h3",{attrs:{id:"在-nacos-添加配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在-nacos-添加配置"}},[a._v("#")]),a._v(" 在 Nacos 添加配置")]),a._v(" "),s("blockquote",[s("p",[a._v("通过配置列表右侧的 "),s("code",[a._v("+")]),a._v(" 按钮添加配置文件：")])]),a._v(" "),s("p",[s("strong",[a._v("防坑指南")])]),a._v(" "),s("ul",[s("li",[a._v("Data ID: 服务名-环境名.yaml")]),a._v(" "),s("li",[a._v("服务名名.yaml --\x3e  默认的 application.yml")]),a._v(" "),s("li",[a._v("服务名-dev.yaml  --\x3e  application-dev.yml  |  开发环境")]),a._v(" "),s("li",[a._v("服务名-test.yaml  --\x3e  application-test.yml    |  测试环境")]),a._v(" "),s("li",[a._v("服务名-proc.yaml  --\x3e  application-proc.yml  |  生产环境")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220721183911016.png",alt:"image-20220721183911016"}})]),a._v(" "),s("p",[s("code",[a._v("Data ID")]),a._v(" 是该配置文件在 Nacos 系统内的唯一标识。")]),a._v(" "),s("p",[a._v("在 Nacos Spring Cloud 中，dataId 的完整格式语法如下：")]),a._v(" "),s("div",{staticClass:"language-markup extra-class"},[s("pre",{pre:!0,attrs:{class:"language-markup"}},[s("code",[a._v("${prefix}-${spring.profile.active}.${file-extension}\n")])])]),s("ul",[s("li",[s("p",[s("strong",[a._v("prefix")]),a._v(" 的值默认与 "),s("code",[a._v("spring.application.name")]),a._v("  （即服务名）的值相同。也可以通过配置项 "),s("strong",[a._v("spring.cloud.nacos.config.prefix")]),a._v(" 来手动配置，指定一个与 spring.application.name 不一样的值，不过一般不会动它。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("spring.profile.active")]),a._v(" 即为当前环境对应的 profile ，如："),s("code",[a._v("xxx-service-dev.yml")]),a._v(" 中的 "),s("code",[a._v("dev")]),a._v(" 就是指开发环境。")]),a._v(" "),s("p",[a._v("**注意：**当 spring.profile.active 为空时，对应的环境定义字符部分将不存在，即为 "),s("strong",[a._v("xxx-service.yml")]),a._v("，而不是 "),s("em",[a._v("xxx-service-.yml")]),a._v(" 。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("file-exetension")]),a._v(" 为配置内容的数据格式，可以通过配置项 "),s("strong",[a._v("spring.cloud.nacos.config.file-extension")]),a._v(" 来配置。")]),a._v(" "),s("p",[a._v("注意，我们使用的『"),s("strong",[a._v("是 yaml 类型，不是 yml")]),a._v("』。虽然二者是一个意思，但是『"),s("strong",[a._v("nacos 只认 yaml")]),a._v("』。")])])]),a._v(" "),s("p",[s("code",[a._v("Group")]),a._v(" 的值同 spring.cloud.nacos.config.group 的配置，界面填写的内容与项目中的配置二者『"),s("strong",[a._v("一定要统一")]),a._v("』，否则无法正确读取配置，Group 起到配置『隔离』的作用。")]),a._v(" "),s("p",[s("strong",[a._v("数据库 基本配置")])]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("datasource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver-class-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" com.mysql.cj.jdbc.Driver\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hikari")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("idle-timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("60000")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("maximum-pool-size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("minimum-idle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" com.zaxxer.hikari.HikariDataSource\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3306/licaimoney"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("?")]),a._v("serverTimezone=UTC\n")])])]),s("h2",{attrs:{id:"微服务-group-分组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微服务-group-分组"}},[a._v("#")]),a._v(" 微服务 group 分组")]),a._v(" "),s("p",[a._v("Nacos 的微服务分组概念，有两层含义：")]),a._v(" "),s("ul",[s("li",[a._v("不同分组的微服务，彼此之间不能发现对方，也就不能进行远程服务调用。逻辑上，不同的分组意味着这是两个不同的独立项目。即，你（微服务）从配置中拉取到的注册表只有可能是你所在组的注册表。")]),a._v(" "),s("li",[a._v("将微服务分组，方便我们查看，以及方便配置管理分类。")])]),a._v(" "),s("p",[a._v("可以通过如下属性对微服务所属分组进行配置：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 组名\n")])])]),s("p",[a._v("由于多个项目可能、可以使用同一个 nacos 作为注册中心，这种情况下，"),s("code",[a._v("group")]),a._v(" 就是区分你我的标识，每个微服务从 nacos 上拉取的只有本组的注册表。 如果微服务没有指定组，默认分组是 default_group")]),a._v(" "),s("h2",{attrs:{id:"验证和动态刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证和动态刷新"}},[a._v("#")]),a._v(" 验证和动态刷新")]),a._v(" "),s("blockquote",[s("p",[a._v("在 表现层 有调用配置文件的数据时 加上 -  @RefreshScope  -  可进行既时刷新")])]),a._v(" "),s("p",[a._v("执行以下代码进行验证：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${xxx.yyy.zzz}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" zzz"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/demo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("demo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \n")])])]),s("p",[a._v("如果想要实现动态刷新功能，那么在 @Value 所在的 @Component（@Controller、@Service、@Repository）上加上 "),s("strong",[a._v("@RefreshScope")]),a._v(" 即可实现动态刷新。")]),a._v(" "),s("h2",{attrs:{id:"nacos-的数据存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-的数据存储"}},[a._v("#")]),a._v(" Nacos 的数据存储")]),a._v(" "),s("h3",{attrs:{id:"windos-数据库储存修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windos-数据库储存修改"}},[a._v("#")]),a._v(" windos 数据库储存修改")]),a._v(" "),s("p",[a._v("Nacos 的数据是存储在它自带的内嵌 derby 数据库中的，数据文件就在 Nacos 的解压目录下的 "),s("code",[a._v("data")]),a._v(" 文件夹中。")]),a._v(" "),s("p",[a._v("你也可以通过修改配置，让 Nacos 将它的数据存储在你指定的 mysql 数据库中。")]),a._v(" "),s("ul",[s("li",[a._v("Nacos 在它的 "),s("code",[a._v("conf")]),a._v(" 目录下已经为你准备好了建表脚本："),s("code",[a._v("nacos-mysql.sql")]),a._v(" 。不过脚本中没有建库语句，为了后续配置简单起见，建议创建的库命名为 nacos 。")])]),a._v(" "),s("ul",[s("li",[a._v("创建一个nacos数据库，然后在nacos的bin目录下找到nacos-mysql.sql文件，把该文件的建表语句拷贝mysql客户端下执行，注意要使用你刚才创建的nacos数据库下")])]),a._v(" "),s("div",{staticClass:"language-mysql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("create database nacos \n  DEFAULT CHARACTER SET utf8mb4 -- 乱码问题\n  DEFAULT COLLATE utf8mb4_bin -- 英文大小写不敏感问题\n;\n")])])]),s("ul",[s("li",[a._v("在 conf 文件夹下的 "),s("code",[a._v("application.properties")]),a._v(" 配置文件。从 31 行开始的一段配置就是数据库连接相关配置。把如下行数前面的注释去掉")])]),a._v(" "),s("div",{staticClass:"language-mysql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("spring.datasource.platform=mysql\n\n### Count of DB:\ndb.num=1\n\n### Connect URL of DB:\ndb.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC\ndb.user.0=root\ndb.password.0=root\n")])])]),s("p",[a._v("修改完 "),s("code",[a._v("application.properties")]),a._v(" 配置文件之后，重启 Nacos，Nacos 重新编程了一个『干净』的环境。")]),a._v(" "),s("p",[s("strong",[a._v("测试：")])]),a._v(" "),s("p",[a._v("登陆localhost：8848/nacos，在配置中心上新建一个配置，如：spring-service-provider-dev.yaml，发现这个配置保存到了我们自己创建的nacos数据库里面")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://apaiimages.oss-cn-guangzhou.aliyuncs.com/MD/image-20220721194326682.png",alt:"image-20220721194326682"}})]),a._v(" "),s("h3",{attrs:{id:"liunx-系统-修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#liunx-系统-修改"}},[a._v("#")]),a._v(" Liunx 系统 修改")]),a._v(" "),s("blockquote",[s("p",[a._v("镜像容器:  docker-compose.yml")])]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysql5.7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql57\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_DATABASE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 3306"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./docker/mysql/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/mysql/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./docker/conf/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/mysql/\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos/nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.4.1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" mysql5.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./docker/nacos/standalone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("logs/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/home/nacos/logs\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./docker/nacos/plugins/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/home/nacos/plugins\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./docker/nacos/conf/application.properties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/home/nacos/conf/application.properties\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("PREFER_HOST_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" hostname "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#如果支持主机名可以使用hostname,否则使用ip，默认也是ip")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SPRING_DATASOURCE_PLATFORM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#数据源平台 仅支持mysql或不保存empty")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" standalone\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_SERVICE_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql5.7\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_SERVICE_DB_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_SERVICE_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_SERVICE_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_SERVICE_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NACOS_APPLICATION_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9999")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("JVM_XMS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 512m\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("JVM_MMS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 320m\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9999:9999"')]),a._v("\n")])])]),s("h2",{attrs:{id:"nacos-集群配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-集群配置"}},[a._v("#")]),a._v(" nacos 集群配置")]),a._v(" "),s("p",[a._v("官网：https://nacos.io/zh-cn/ ，点击手册找到运维，拷贝cluster.conf.example文件，并改名为cluster.conf")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("127.0.0.1:8848\n127.0.0.1:8849\n127.0.0.1:8850\n")])])]),s("p",[a._v("直接双击启动启动脚本")]),a._v(" "),s("p",[a._v("微服务配置：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" spring"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" public\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8849")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8850")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);