(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{499:function(s,a,t){"use strict";t.r(a);var e=t(65),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"mysql-主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-主从复制"}},[s._v("#")]),s._v(" MySql 主从复制")]),s._v(" "),t("blockquote",[t("p",[s._v("MySql "),t("a",{attrs:{href:"https://blog.csdn.net/qq_46079815/article/details/127312040",target:"_blank",rel:"noopener noreferrer"}},[s._v("主从复制参考")]),s._v(" "),t("a",{attrs:{href:"https://blog.csdn.net/weixin_38530591/article/details/128719035",target:"_blank",rel:"noopener noreferrer"}},[s._v("模式架构详解")])])]),s._v(" "),t("h3",{attrs:{id:"基础原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础原理"}},[s._v("#")]),s._v(" 基础原理")]),s._v(" "),t("ul",[t("li",[s._v("复制是指将主数据库的DDL 和 DML 操作通过"),t("a",{attrs:{href:"https://so.csdn.net/so/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("二进制")]),s._v("日志传到从库服务器中，然后在从库上对这些日志重新执行（也叫重做），从而使得从库和主库的数据保持同步")])]),s._v(" "),t("h3",{attrs:{id:"复制三步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制三步"}},[s._v("#")]),s._v(" 复制三步")]),s._v(" "),t("ul",[t("li",[s._v("Master 主库在事务提交时，会把数据变更作为时间 Events 记录在二进制日志文件 Binlog中。")]),s._v(" "),t("li",[s._v("主库推送二进制日志文件 Binlog 中的日志事件到从库的中继日志 Relay Log 。")]),s._v(" "),t("li",[s._v("slave重做中继日志中的事件，将改变反映它自己的数据。")])]),s._v(" "),t("h3",{attrs:{id:"复制的优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制的优点"}},[s._v("#")]),s._v(" 复制的优点")]),s._v(" "),t("ul",[t("li",[s._v("主库出现问题，可以快速切换到从库提供服务。")]),s._v(" "),t("li",[s._v("可以在从库上执行查询操作，从主库中更新，实现读写分离，降低主库的访问压力。")]),s._v(" "),t("li",[s._v("可以在从库中执行备份，以避免备份期间影响主库的服务。")])]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）实时灾备\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）读写分离\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）高可用\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("）从库数据统计\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("）从库数据备份\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("）平滑升级\n")])])]),t("h3",{attrs:{id:"常见的几种架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见的几种架构"}},[s._v("#")]),s._v(" 常见的几种架构")]),s._v(" "),t("p",[s._v("1）单向主从模式：Master ——> Slave")]),s._v(" "),t("p",[s._v("2）双向主从模式：Master <====> Master")]),s._v(" "),t("p",[s._v("3）级联主从模式：Master ——> Slave1 ——> Slave2")]),s._v(" "),t("p",[s._v("4）一主多从模式")]),s._v(" "),t("p",[s._v("5）多主一从模式")]),s._v(" "),t("h2",{attrs:{id:"主从复制原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制原理"}},[s._v("#")]),s._v(" 主从复制原理")]),s._v(" "),t("h3",{attrs:{id:"_1-异步复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-异步复制"}},[s._v("#")]),s._v(" 1.异步复制")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 主从复制是异步复制过程")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" master开启bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log功能，日志文件用于记录数据库的读写增删\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 需要开启"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("个线程，master IO线程，slave开启 IO线程 SQL线程，\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Slave")]),s._v(" 通过IO线程连接master，并且请求某个bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log，position之后的内容。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v(" MASTER服务器收到slave IO线程发来的日志请求信息，io线程去将bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log内容，position返回给slave IO线程。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v(" slave服务器收到bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log日志内容，将bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log日志内容写入relay"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log中继日志，创建一个master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("info的文件，该文件记录了master ip 用户名 密码 master bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log名称，bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log position。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v(" slave端开启SQL线程，实时监控relay"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log日志内容是否有更新，解析文件中的SQL语句，在slave数据库中去执行。\n")])])]),t("h3",{attrs:{id:"_2-半同步复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-半同步复制"}},[s._v("#")]),s._v(" 2.半同步复制")]),s._v(" "),t("blockquote",[t("p",[s._v("MySQL默认的复制方式是异步复制，但是当主库宕机，在高可用架构坐准备切换，就会造成新的主库丢失数据的现象。")])]),s._v(" "),t("p",[s._v("MySQL5.5版本之后引入了半同步复制，但是主从服务器必须同时安装半同步复制插件。在该功能下，确保从库接收完成主库传递过来的binlog内容已经写入到自己的relay log后才会通知主库上面的等待线程。如果等待超时(超时参数：rpl_semi_sync_master_timeout)，则关闭半同步复制，并自动转换为异步复制模式，直到至少有一台从库通知主库已经接收到binlog信息为止。")]),s._v(" "),t("p",[s._v("半同步复制时，为了保证主库上的每一个Binlog事务都能够被可靠的复制到从库上，主库在每次事务成功提交时，并不及时反馈给前端应用用户，而是等待其中的一个从库也接收到Binlog事务并成功写入中继日志后，出库才返回commit操作成功给客户端。半同步复制保证了事务成功提交后，至少有两份日志记录，一份在主库的Binlog日志上，另一份在至少一个从库的中继日志Relay log上，从而更近一步保证了数据的完整性。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/59cca8c76d9e4fccb431d7dc794e53dc.png",alt:"img"}})]),s._v(" "),t("p",[s._v("在这个半同步复制模式下：第1、2、3中任何一个步骤中主库宕机，则事务并没有提交成功。从库也没有得到日志，此时的主从复制数据是一致的。")]),s._v(" "),t("p",[s._v("半同步复制提升了主从之间数据的一致性，让复制更加安全可靠，在5.7 版本中又增加了rpl_semi_sync_master_wait_point参数，用来控制半同步模式下主库返回给session事务成功之前的事务提交方式。")]),s._v(" "),t("h3",{attrs:{id:"_3-gtid复制-了解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-gtid复制-了解"}},[s._v("#")]),s._v(" 3.GTID复制（了解）")]),s._v(" "),t("blockquote",[t("p",[s._v("GTID又叫全局事务ID，是一个以提交事务的编号，并且是一个全局唯一的编号。GTID是由server_uuid和事务id组成的，即GTID=server_uuid:transaction_id。")])]),s._v(" "),t("p",[s._v("server_uuid是数据库启动自动生成的，保存在auto.cnf文件下，transaction_id是事务提交时由系统顺序分配的一个不会重复的序列行。")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// GTID存在的价值：")]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）GTID使用master_auto_position"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("代替了基于binlog和position号的主从复制方式，更便于主从复制的搭建。\n　　"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）GTID可以知道事务在最开始是哪个实例上提交的。\n　　"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）GTID方便实现主从之间的failover，无须找position和binlog。\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// GTID限制条件：")]),s._v("\n　　"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）不能使用create table table_name select "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" from table_name。\n　　"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）不支持CREATE TEMPORARY TABLE or DROP TEMPORARY TABLE语句操作。\n　　"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）不支持sql_slave_skip_counter。\n")])])]),t("h2",{attrs:{id:"mysql-单向主从模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-单向主从模式"}},[s._v("#")]),s._v(" MySql 单向主从模式")]),s._v(" "),t("p",[s._v("MySQL支持一台主库同时向多台从库进行复制， 从库同时也可以作为其他从服务器的主库，实现链状复制")]),s._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230713162155022.png",alt:"image-20230713162155022"}}),s._v(" "),t("blockquote",[t("p",[s._v("默认的 my.cnf 备份")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This program is free software; you can redistribute it and/or modify")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# it under the terms of the GNU General Public License as published by")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the Free Software Foundation; version 2 of the License.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This program is distributed in the hope that it will be useful,")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# but WITHOUT ANY WARRANTY; without even the implied warranty of")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GNU General Public License for more details.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You should have received a copy of the GNU General Public License")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# along with this program; if not, write to the Free Software")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The MySQL  Server configuration file.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For explanations see")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://dev.mysql.com/doc/mysql/en/server-system-variables.html")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/lib/mysql\nsecure-file-priv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NULL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Custom config should go here")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("includedir /etc/mysql/conf.d/\n")])])]),t("h3",{attrs:{id:"_1-数据库准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据库准备"}},[s._v("#")]),s._v(" 1.数据库准备")]),s._v(" "),t("blockquote",[t("p",[s._v("在主数据库数据产生变化时, 从数据库会去拉取主数据库的数据进行同步复制")])]),s._v(" "),t("p",[s._v("主数据库: 175.178.126.61:1001")]),s._v(" "),t("p",[s._v("从数据库: 175.178.126.61:1051")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230713155302871.png",alt:"image-20230713155302871"}})]),s._v(" "),t("h3",{attrs:{id:"_2-主数据库-my-cnf-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-主数据库-my-cnf-配置"}},[s._v("#")]),s._v(" 2.主数据库 my.cnf  配置")]),s._v(" "),t("ul",[t("li",[s._v("后期出现问题可根据上面备份的my.cnf 进行恢复")]),s._v(" "),t("li",[s._v("Docker 的mysql配置文件位置在: /etc/mysql/my.cnf")])]),s._v(" "),t("p",[t("strong",[s._v("2.1 增加my.cnf 的配置")])]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log-bin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("mysql-bin   #[必须]启用二进制日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1025       #[必须]服务器唯一ID(唯一即可)")]),s._v("\n")])])]),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token header"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("pid-file")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/run/mysqld/mysqld.pid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("socket")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/run/mysqld/mysqld.sock")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("datadir")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("secure-file-priv")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("NULL")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log-bin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("mysql-bin   #[必须]启用二进制日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1025       #[必须]服务器唯一ID(唯一即可)")]),s._v("\n")])])]),t("p",[t("strong",[s._v("2.2 重启Mysql服务")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行指令 / 或者重启Docker ")]),s._v("\nsystemctl restart mysqld\n")])])]),t("p",[t("strong",[s._v("2.3 设置复制主权限用户及获取配置信息 (后续从机需要这些配置)")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 上面SQL的作用是创建一个用户 apaipai，密码为 apaipai ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 并且给 apaipai 用户授予REPLICATION SLAVE权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 常用于建立复制时所需要用到的用户权限，也就是slave必须被master授权具有该权限的用户，才能通过该用户复制")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apaipai'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apaipai'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apaipai'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 记录下结果中File(mysql-bin.000001)和Position(657)的值 ")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230714101610551.png",alt:"image-20230714101610551"}})]),s._v(" "),t("h3",{attrs:{id:"_3-从数据库-my-cnf-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-从数据库-my-cnf-配置"}},[s._v("#")]),s._v(" 3.从数据库 my.cnf  配置")]),s._v(" "),t("p",[t("strong",[s._v("3.1 增加my.cnf 的配置")])]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1026       #[必须]服务器唯一ID(唯一即可)")]),s._v("\n")])])]),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token header"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("pid-file")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/run/mysqld/mysqld.pid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("socket")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/run/mysqld/mysqld.sock")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("datadir")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("secure-file-priv")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("NULL")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server-id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1026 \t#[必须]服务器唯一ID")]),s._v("\n")])])]),t("p",[t("strong",[s._v("3.2 重启Mysql服务")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行指令 / 或者重启Docker ")]),s._v("\nsystemctl restart mysqld\n")])])]),t("p",[t("strong",[s._v("3.3 设置主库IP地址端口及同步位置")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 参数说明：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_host : 主库的IP地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_port : 主库的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_user : 访问主库进行主从复制的用户名(上面在主库创建的)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_password : 访问主库进行主从复制的用户名对应的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_file : 从哪个日志文件开始同步(上述查询master状态中展示的有)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_pos : 从指定日志文件的哪个位置开始同步(上述查询master状态中展示的有)")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" change master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175.178.126.61'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'luapai'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'luapai@123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("655")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看从数据库的状态 (出现如下图YES表示成功)")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230713160717591.png",alt:"image-20230713160717591"}})]),s._v(" "),t("p",[t("strong",[s._v("3.4 重新配置主库 (非必须执行)")])]),s._v(" "),t("blockquote",[t("p",[s._v("在 MySQL 中修改从机的连接设置时，需要先停止正在运行的复制进程的IO线程")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 报错: This operation cannot be performed with a running slave io thread; run STOP SLAVE IO_THREAD FOR CHANNEL '' first.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 表示: 在 MySQL 中修改从机的连接设置时，需要先停止正在运行的复制进程的IO线程")]),s._v("\n")])])]),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 1. 连接到从机的MySQL服务器，请使用命令行输入以下命令：")]),s._v("\nmysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u your_username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 2.在MySQL提示符下执行以下命令，停止复制进程的IO线程：")]),s._v("\nSTOP SLAVE IO_THREAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 3.然后，您可以修改从机的连接设置。使用以下SQL语句，将 <master_ip>, <master_port>, <master_user> 和 <master_password> 替换为实际的值：")]),s._v("\nCHANGE MASTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" MASTER_HOST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<master_ip>'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MASTER_PORT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("master_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MASTER_USER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<master_user>'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MASTER_PASSWORD"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<master_password>'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 4.修改完连接设置后，再次启动IO线程以恢复复制过程：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" SLAVE IO_THREAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 5.您可以通过检查从机的状态来验证更改是否生效：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" SLAVE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" \\G \n\n确保 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Slave_IO_Running"')]),s._v(" 状态为 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Yes"')]),s._v("。\n请注意，在复制过程运行时修改复制设置需要谨慎操作。在进行任何更改之前，请确保已备份数据。\n")])])]),t("h3",{attrs:{id:"_4-验证主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-验证主从复制"}},[s._v("#")]),s._v(" 4.验证主从复制")]),s._v(" "),t("ul",[t("li",[s._v("主库一旦数据发生变化 从库则会拉取数据进行复制")]),s._v(" "),t("li",[s._v("数据的复制是从配置之后开始 之前的数据是不会被复制过去的")]),s._v(" "),t("li",[s._v("从库的数据发生变化 主库是不会去进行复制的 ( 手动对数据库进行数据修改会造成冲突停止复制 )")]),s._v(" "),t("li",[s._v("主从复制 --\x3e 读写分离 ( 主库写 / 从库读 )")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230713161652538.png",alt:"image-20230713161652538"}})]),s._v(" "),t("h2",{attrs:{id:"mysql-双向主从模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-双向主从模式"}},[s._v("#")]),s._v(" MySql 双向主从模式")]),s._v(" "),t("blockquote",[t("p",[s._v("即: 数据库进行双向链接  任意数据库进行了更新 另一个数据库都进行同步更新")])]),s._v(" "),t("h3",{attrs:{id:"_1-数据库准备-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据库准备-2"}},[s._v("#")]),s._v(" 1.数据库准备")]),s._v(" "),t("p",[t("strong",[s._v("主数据库: 175.178.126.61:1052")])]),s._v(" "),t("p",[t("strong",[s._v("从数据库: 175.178.126.61:1053")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230714112842484.png",alt:"image-20230714112842484"}})]),s._v(" "),t("h3",{attrs:{id:"_2-数据库一-my-cnf-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-数据库一-my-cnf-配置"}},[s._v("#")]),s._v(" 2.数据库一 my.cnf  配置")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("my.cnf  参数详解")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/lib/mysql\nsecure-file-priv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NULL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置如下:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置服务器的唯一标识，用于在主从复制中标识不同的服务器。每个服务器必须有一个唯一的 ID。")]),s._v("\nserver-id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用二进制日志，将所有的 SQL 语句都记录到二进制日志文件 mysql-bin 中。这个配置是 MySQL 复制的基础。")]),s._v("\nlog-bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是 MySQL 数据库的二进制日志格式")]),s._v("\nbinlog_format "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mixed\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置自增 ID 的起始值")]),s._v("\nauto_increment_offset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置自增 ID 的步长 一个表的自增 ID 为 1，步长为 2，自增 ID 的值将会是 1、3、5、7…… 确保了在主从复制环境中插入记录时，不会发生 ID 冲突。")]),s._v("\nauto_increment_increment "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将从库执行的 SQL 语句写入二进制日志，以便其他从库可以复制这些操作。这个配置在主从复制中非常重要，因为它确保了所有的从库都可以看到主库的更改，从而保证数据的一致性。如果一个服务器既做主库又做从库，那么这个选项必须要开启，否则从库将无法复制主库的更改。")]),s._v("\nlog-slave-updates "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   \n")])])]),t("blockquote",[t("p",[t("strong",[s._v("my.cnf  配置")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/lib/mysql\nsecure-file-priv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NULL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\nserver-id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nlog-bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql-bin\nbinlog_format "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mixed\nauto_increment_offset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nauto_increment_increment "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nlog-slave-updates "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Custom config should go here")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("includedir /etc/mysql/conf.d/\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("重启Mysql服务")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行指令 / 或者重启Docker ")]),s._v("\nsystemctl restart mysqld\n")])])]),t("h3",{attrs:{id:"_3-数据库二-my-cnf-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据库二-my-cnf-配置"}},[s._v("#")]),s._v(" 3.数据库二 my.cnf  配置")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("my.cnf  配置")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/lib/mysql\nsecure-file-priv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NULL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\nserver-id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nlog-bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql-bin\nbinlog_format "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mixed\nauto_increment_offset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nauto_increment_increment "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nlog-slave-updates "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Custom config should go here")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("includedir /etc/mysql/conf.d/\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("重启Mysql服务")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行指令 / 或者重启Docker ")]),s._v("\nsystemctl restart mysqld\n")])])]),t("h3",{attrs:{id:"_4-配置进行双向链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置进行双向链接"}},[s._v("#")]),s._v(" 4.配置进行双向链接")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("数据库一: 执行")])])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 执行一: 创建下方数据提供给另一个数据库链接使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 上面SQL的作用是创建一个用户 apai1052，密码为 apai1052 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 并且给 apai1052 用户授予REPLICATION SLAVE权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 常用于建立复制时所需要用到的用户权限，也就是slave必须被master授权具有该权限的用户，才能通过该用户复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1052'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1052'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1052'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 记录下结果中File(mysql-bin.000001)和Position(669)的值 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 执行二: 在另一个数据库执行一之后执行, 数据为另一个数据库的信息配置进行链接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 参数说明：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_host : 主库的IP地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_port : 主库的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_user : 访问主库进行主从复制的用户名(上面在主库创建的)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_password : 访问主库进行主从复制的用户名对应的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_file : 从哪个日志文件开始同步(上述查询master状态中展示的有)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_pos : 从指定日志文件的哪个位置开始同步(上述查询master状态中展示的有)")]),s._v("\nchange master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175.178.126.61'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1053")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("669")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('-- 查看数据库的状态 (出现"Slave_IO_Running"和"Slave_SQL_Running"用于描述从服务器的状态YES表示成功)')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("数据库二: 执行")])])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 执行一: 创建下方数据提供给另一个数据库链接使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 上面SQL的作用是创建一个用户 apai1053，密码为 apai1053 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 并且给 apai1053 用户授予REPLICATION SLAVE权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 常用于建立复制时所需要用到的用户权限，也就是slave必须被master授权具有该权限的用户，才能通过该用户复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 记录下结果中File(mysql-bin.000001)和Position(669)的值 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 执行二: 在另一个数据库执行一之后执行, 数据为另一个数据库的信息配置进行链接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 参数说明：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_host : 主库的IP地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_port : 主库的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_user : 访问主库进行主从复制的用户名(上面在主库创建的)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_password : 访问主库进行主从复制的用户名对应的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_file : 从哪个日志文件开始同步(上述查询master状态中展示的有)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_pos : 从指定日志文件的哪个位置开始同步(上述查询master状态中展示的有)")]),s._v("\nchange master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175.178.126.61'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1052")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1052'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1052'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("669")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('-- 查看数据库的状态 (出现"Slave_IO_Running"和"Slave_SQL_Running"用于描述从服务器的状态YES表示成功)')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"_5-验证双向复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-验证双向复制"}},[s._v("#")]),s._v(" 5.验证双向复制")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("数据库都在执行查看数据库的状态时 YES 即可表示链接成功")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230714114114754.png",alt:"image-20230714114114754"}})]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("任意表数据变化 另一张同步复制 实现双向复制")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230714114443557.png",alt:"image-20230714114443557"}})]),s._v(" "),t("h2",{attrs:{id:"mysql-多主一从模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-多主一从模式"}},[s._v("#")]),s._v(" MySql 多主一从模式")]),s._v(" "),t("blockquote",[t("p",[s._v("MySql 多主一从模式 即:")])]),s._v(" "),t("ul",[t("li",[s._v("多个主机进行-写 一个部分从机进行-读")]),s._v(" "),t("li",[s._v("多个主机直接都是双向数据链接  从机拉取主机的数据 主机不会拉取从机的数据")])]),s._v(" "),t("h3",{attrs:{id:"_1-主机配置-双向主从模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-主机配置-双向主从模式"}},[s._v("#")]),s._v(" 1.主机配置 双向主从模式")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("参考上方 "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySql")]),s._v(" 双向主从模式 进行主机互联数据\n")])])]),t("h3",{attrs:{id:"_2-配置从机-单向主从模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置从机-单向主从模式"}},[s._v("#")]),s._v(" 2.配置从机 单向主从模式")]),s._v(" "),t("blockquote",[t("p",[s._v("配置数据库 my.cnf  配置")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npid-file        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.pid\nsocket          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/mysqld/mysqld.sock\ndatadir         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/lib/mysql\nsecure-file-priv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NULL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\nserver-id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nlog-bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql-bin\nbinlog_format "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mixed\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Custom config should go here")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("includedir /etc/mysql/conf.d/\n")])])]),t("blockquote",[t("p",[s._v("配置从机 单向主从模式")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 停止数据库io链接 后续可重新配置链接")]),s._v("\nSTOP SLAVE IO_THREAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 执行二: 在另一个数据库执行一之后执行, 数据为另一个数据库的信息配置进行链接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 参数说明：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_host : 主库的IP地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_port : 主库的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_user : 访问主库进行主从复制的用户名(上面在主库创建的)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_password : 访问主库进行主从复制的用户名对应的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_file : 从哪个日志文件开始同步(上述查询master状态中展示的有)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ​ master_log_pos : 从指定日志文件的哪个位置开始同步(上述查询master状态中展示的有)")]),s._v("\nchange master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175.178.126.61'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1053")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apai1053'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("669")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('-- 查看数据库的状态 (出现"Slave_IO_Running"和"Slave_SQL_Running"用于描述从服务器的状态YES表示成功)')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"_3-验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-验证"}},[s._v("#")]),s._v(" 3.验证")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/LuJunandapai/ApaiImage@main/MaYun-PicGo/image-20230714143005784.png",alt:"image-20230714143005784"}})]),s._v(" "),t("h2",{attrs:{id:"主从复制总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制总结"}},[s._v("#")]),s._v(" 主从复制总结")]),s._v(" "),t("h3",{attrs:{id:"从机数据库的状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从机数据库的状态"}},[s._v("#")]),s._v(" 从机数据库的状态")]),s._v(" "),t("blockquote",[t("p",[s._v('"Slave_IO_Running"和"Slave_SQL_Running"用于描述从服务器的状态')])]),s._v(" "),t("p",[t("strong",[s._v('"Slave_IO_Running"')])]),s._v(" "),t("ul",[t("li",[s._v("描述了从服务器上的I/O线程状态，该线程负责从主服务器上读取二进制日志并将其复制到从服务器上。")]),s._v(" "),t("li",[s._v('如果该参数值为"YES"，表示I/O线程正在运行并且从主服务器上成功读取了二进制日志。')])]),s._v(" "),t("p",[t("strong",[s._v('"Slave_SQL_Running"')])]),s._v(" "),t("ul",[t("li",[s._v("描述了从服务器上的SQL线程状态，")]),s._v(" "),t("li",[s._v("该线程负责将从主服务器上复制的二进制日志应用到从服务器上的数据库中。")]),s._v(" "),t("li",[s._v('如果该参数值为"YES"，表示SQL线程正在运行并且成功将所有的二进制日志应用到从服务器上的数据库中。')])]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("如果这两个参数的值都为"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YES"')]),s._v("，则表示从服务器上的主从复制状态正常，并且从服务器上的数据与主服务器上的数据是同步的。如果其中任何一个参数的值为"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NO"')]),s._v("，则表示复制出现了问题，并且需要进行故障排除。\n")])])]),t("h3",{attrs:{id:"主从复制大致步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制大致步骤"}},[s._v("#")]),s._v(" 主从复制大致步骤")]),s._v(" "),t("blockquote",[t("p",[s._v("Linux MySQL主从复制架构是一种常见的数据库备份和数据同步方案。")])]),s._v(" "),t("p",[s._v("它可以通过将主数据库的数据同步到从数据库上，实现数据的备份和高可用性。具体步骤包括：")]),s._v(" "),t("ol",[t("li",[s._v("在主数据库上创建一个用于复制的用户，并授权给该用户复制权限。")]),s._v(" "),t("li",[s._v("在从数据库上创建一个与主数据库相同的数据库，并设置为串口模式。")]),s._v(" "),t("li",[s._v("在从数据库上配置主从复制，包括指定主数据库的IP地址和端口号，以及复制用户的用户名和密码。")]),s._v(" "),t("li",[s._v("启动从数据库的复制进程，等待数据同步完成。")]),s._v(" "),t("li",[s._v("在主数据库上进行数据更新操作，等待数据同步到从数据库。")]),s._v(" "),t("li",[s._v("在从数据库上进行查询操作，数据验证同步是否成功。")])]),s._v(" "),t("p",[s._v("总的来说，Linux MySQL主从复制架构是一种非常实用的数据库备份和数据同步方案，可以提高数据的可靠性和可用性。")]),s._v(" "),t("h3",{attrs:{id:"读写分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读写分离"}},[s._v("#")]),s._v(" 读写分离")]),s._v(" "),t("blockquote",[t("p",[s._v("在 MySQL 主从复制和读写分离架构中，从机主要用于处理读操作，而写操作通常由主机处理。")])]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("主从复制是一种数据复制技术，其中一个 "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" 服务器充当主服务器（"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Master")]),s._v("），负责接收和处理所有的写操作（INSERT、UPDATE、DELETE）。同时，主服务器将这些写操作的日志记录到二进制日志文件（"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Binary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),s._v("）中。其他的 "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" 服务器作为从服务器（"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Slave")]),s._v("），通过连接到主服务器并获取二进制日志文件，来复制主服务器上的写操作。从服务器会将这些写操作应用到自己的数据库中，以保持与主服务器的数据一致性。\n\n读写分离是在主从复制的基础上实现的一种架构模式。它通过将读操作分发给从服务器来减轻主服务器的负载，并提高整体系统的读取性能。在读写分离架构中，从服务器可以处理大部分的查询请求，包括 SELECT 查询等读操作。而写操作仍然由主服务器处理，以确保数据的一致性。\n\n因此，在主从复制和读写分离架构中，从机主要用于处理读操作，而写操作仍然由主机处理。\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);